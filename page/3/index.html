<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>刘鹏程</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="活着便是为了更好的活着">
<meta property="og:type" content="website">
<meta property="og:title" content="刘鹏程">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="刘鹏程">
<meta property="og:description" content="活着便是为了更好的活着">
<meta property="og:locale" content="中文">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="刘鹏程">
<meta name="twitter:description" content="活着便是为了更好的活着">
  
  
    <link rel="icon" href="/favicon.png">
  
  <!-- <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'> -->
  <!-- <link href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css"> -->
  <link href="//fonts.useso.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css">
  <link href='//fonts.useso.com/css?family=Open+Sans:300,600' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/css/style.css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <a href="/" class="logo">刘鹏程</a>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about/index.html">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
        </div>
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
        
        
          <a id="nav-github-link" class="nav-icon" href="https://github.com/ppoffice/hexo-theme-alex" title="Fork me on GitHub"></a>
        
      </nav>
    </div>
  </div>
</header>
      <nav id="mobile-nav" class="off">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about/index.html" class="mobile-nav-link">About</a>
  
  <div id="search-form-wrap-mobile">
    <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
  </div>
</nav>
      <div class="outer">
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JVM/">JVM</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/协议/">协议</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/并发/">并发</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/">数据结构</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/04/01/android-version-Q-storage/">Android Q 应用存储空间限制</a>
          </li>
        
          <li>
            <a href="/2019/01/09/android-Performance-optimization-Memory-jitter-md/">性能优化1 - 内存抖动</a>
          </li>
        
          <li>
            <a href="/2018/11/01/gradle-gradlew/">Android Gradlew编译相关命令</a>
          </li>
        
          <li>
            <a href="/2018/09/03/android-system-job/">Android O 后台限制解决方式</a>
          </li>
        
          <li>
            <a href="/2018/06/15/thread-tools-delayQueue/">线程延时队列DelayQueue</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/">JVM</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OutOfMemroy/">OutOfMemroy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gradlew/">gradlew</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/关于博主/">关于博主</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/协议/">协议</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/并发/">并发</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/性能优化/">性能优化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/控件/">控件</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/版本适配/">版本适配</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/绘图技巧/">绘图技巧</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/编译/">编译</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JVM/" style="font-size: 13.33px;">JVM</a> <a href="/tags/OutOfMemroy/" style="font-size: 10px;">OutOfMemroy</a> <a href="/tags/gradlew/" style="font-size: 10px;">gradlew</a> <a href="/tags/http/" style="font-size: 16.67px;">http</a> <a href="/tags/关于博主/" style="font-size: 10px;">关于博主</a> <a href="/tags/协议/" style="font-size: 16.67px;">协议</a> <a href="/tags/并发/" style="font-size: 20px;">并发</a> <a href="/tags/性能优化/" style="font-size: 10px;">性能优化</a> <a href="/tags/控件/" style="font-size: 16.67px;">控件</a> <a href="/tags/数据库/" style="font-size: 16.67px;">数据库</a> <a href="/tags/数据结构/" style="font-size: 13.33px;">数据结构</a> <a href="/tags/版本适配/" style="font-size: 13.33px;">版本适配</a> <a href="/tags/算法/" style="font-size: 13.33px;">算法</a> <a href="/tags/绘图技巧/" style="font-size: 16.67px;">绘图技巧</a> <a href="/tags/编译/" style="font-size: 10px;">编译</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">links</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://hexo.io">Hexo</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
        <section id="main">
  
    <article id="post-android-sqlite01" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/05/android-sqlite01/" class="article-date">
  <time datetime="2018-02-05T11:35:01.000Z" itemprop="datePublished">2018-02-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/05/android-sqlite01/">Android数据库（1）、SQLite数据库介绍</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="一、关系性数据库"><a href="#一、关系性数据库" class="headerlink" title="一、关系性数据库"></a>一、关系性数据库</h3><p>关系型数据库主要有以下三个特征，尤为明显，如果没有这个三个特征约束，当多个客户端使用数据的时候就会出现各种各样的错误，所以关系型数据库定义这些约束，让客户端程序只要遵守这个规则便可以规避很多的错误。</p>
<p><img src="/2018/02/05/android-sqlite01/android_sqlite001.png" alt="关系性数据库"></p>
<p>这三个特征主要是：</p>
<ul>
<li>强类型</li>
<li>引用完整性</li>
<li>事物</li>
</ul>
<h4 id="1、强类型："><a href="#1、强类型：" class="headerlink" title="1、强类型："></a>1、强类型：</h4><p>大多数的数据库都是强类型的，要求数据库引擎严格执行，引擎通常定义一些原生的数据类型，它描述可以存进数据库当中数据的具体类型，这些类型通常是各种长度的浮点数，字符串，整数等，特定的实现，这个类型不能让用户自己特定的去扩展，当引擎定义了关系，数据库当中将无法企图把错误的数据类型的数据存入列当中，</p>
<p>例如：尝试插入一个包含一个字符串作为第三个特性的元组到一个指定第三特性应该是一个浮点数的关系当中，通常引擎会报错，将插入失败。</p>
<h4 id="2、引用完整性"><a href="#2、引用完整性" class="headerlink" title="2、引用完整性"></a>2、引用完整性</h4><p>在关系型数据库当中，原生类型可以通过声明一个关系中的列到另一个关系的一个引用进行扩展，也就是我们常说的主外建关系，数据库架构师可以声明一个关系中一些列的内容是其他关系中类似类型列的一个引用，下图进行外建的演示：</p>
<p>上述就是最简单的主外建关系，通过表A当中的外建和表B进行连接，从而如果可以在表A当中获取到数据就可以在表B当中进行查询，</p>
<p>想要实现上述的要求，必须遵循数据库引擎提供的引用完整性，因为数据库引擎将会强制的去执行引用完整性约束，该约束主要分为以下的两种类型，</p>
<p>2.1 强制会去执行表B的主键约束，就如上述表B当中的主键。要保证在表B当中主键列当中主键的唯一性，也就是不可以重复，例如当表B当中的主键有A，B，C三个值，现在插入一行数据的主键列为A或B或C将会失败，因为破坏了主键约束的唯一性。</p>
<p>2.2、强调表A的引用完整性，所谓什么是引用完整性呢，就是表A当中的外键要么是null，要么该指就一定在表B的主键当中存在，下面有两种情况会破环引用的完整性，</p>
<ul>
<li>如果给表A当中插入一行数据，该数据的外键值在表B当中没有，那么该操作则失败。</li>
<li>如果删除表B当中的一条数据，并且该条数据被表A当中的外键所引用，那么该操作失败</li>
</ul>
<p>上述两种情况也是我们开发当中常常会用到情况，所以我们的解决方式便是，</p>
<ul>
<li>先插入表B当中的数据，然后插入表A当中的数据</li>
<li>先将表A当中引用表B的外键值置为null，然后删除表B当中数据</li>
</ul>
<h4 id="3、数据库事务"><a href="#3、数据库事务" class="headerlink" title="3、数据库事务"></a>3、数据库事务</h4><p>事务：对数据的一组操作当作为一个单位去执行，要么全部失败，要么全部成功。事物有以下几个特点，常常被开发者侃侃而谈，便是</p>
<ul>
<li>原子性：全部成功，全部失败，操作被视为一个单位，不能将操作分离</li>
<li>一致性：事务开启之前，数据库处于有效状态，那么事务开启之后，数据库仍然处于有效状态，不能因为事物导致数据约束被破坏</li>
<li>隔离性：执行完事物以后，数据库的状态可以通过依次执行事物中的命令达到同样的状态</li>
<li>持久性：事物一旦完毕，就不能丢失，比如电源故障等，物理环境都不能撼动。</li>
</ul>
<h3 id="二、SQL语言"><a href="#二、SQL语言" class="headerlink" title="二、SQL语言"></a>二、SQL语言</h3><p>什么是SQL语言呢，就是操作数据库以及数据库当中的数据的命令。称之为SQL语言，SQL语言是由数据库引擎解释并且执行的，SQL语言大多数开发者都或多或少的已经掌握，所以该部分内容为回顾内容，笔者并不打算详细讲解。如有不同，可以自行Google，Baidu。</p>
<p>SQL语言主要分为六大类，分别是DDL（date definition Language）数据定义语言、DML（Data Manipulation Language）数据操作语言、DQL（Data Query Language）数据查询语言，TPL事物处理语言，DCL数据控制语言、CCL指针控制语言。</p>
<p>其中最为常用的便是上述当中的前三类语言，而后面的三类用的不是很多，所以对前三类语言做详细介绍，而后面的三类简单了解就可以了。</p>
<h4 id="1、DDL（数据定义语言）"><a href="#1、DDL（数据定义语言）" class="headerlink" title="1、DDL（数据定义语言）"></a>1、DDL（数据定义语言）</h4><p>主要描述的是数据库当中所包含的数据结构，最常见的DDL语言就是用来定义一张表，包含列数、列类型、还有删除一张表，下面为创建一个User表的SQL语言描述。<br>删除表结构</p>
<blockquote>
<p>DROP TABLE users;</p>
</blockquote>
<p>创建一个新的表结构</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span>  <span class="keyword">TABLE</span> <span class="keyword">users</span>&#123;</span><br><span class="line">        _id <span class="built_in">INTEGER</span> PRIMARY <span class="keyword">KEY</span> AUTOINCREMENT,</span><br><span class="line">        name_raw_user_id <span class="built_in">INTEGER</span>  <span class="keyword">REFERENCES</span> raw_users(_id), </span><br><span class="line">        photo_id <span class="built_in">INTEGER</span>  <span class="keyword">REFERENCES</span> <span class="keyword">data</span>(_id),</span><br><span class="line">        photo_file_id <span class="built_in">INTEGER</span> <span class="keyword">REFERENCES</span> photo_files(_id),</span><br><span class="line">        custom_ringtone <span class="built_in">TEXT</span>,</span><br><span class="line">        send_to_voicemail <span class="built_in">INTEGER</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">        time_contacted <span class="built_in">INTEGER</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">        last_time_contacted <span class="built_in">INTEGER</span>,</span><br><span class="line">        starred <span class="built_in">INTEGER</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">        has_phone_number <span class="built_in">INTEGER</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">        lookup <span class="built_in">TEXT</span>,    </span><br><span class="line">        status_update_id <span class="built_in">INTEGER</span>  <span class="keyword">REFERENCES</span> <span class="keyword">data</span>(_id)</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这里需要注意的是：在定义一张表的时候，所有数据库语法的关键字大写，并且列名称是唯一的，这里不允许列名称之间相互重复。并且表的名称在同一个数据库当中也不能重复，通常使用的是一个复数名词</p>
<p>除了创建表以外，SQL的DDL允许创建其他标准的RDBMS的数据结构，而RDBMS当中常见的标准的数据结构除了相应的表以外，还有相应的视图（View）、触发器（trigger）、索引（index）。这里把定义一个给定数据库当中所有对象的DDL语句集合叫做这个数据库的模式（schema），其他的数据结构在什么场景下会用到呢？它们分别扮演着什么样子的角色呢，</p>
<ul>
<li>视图（View）：</li>
<li>触发器（trigger）：</li>
<li>索引（index）：</li>
</ul>
<h4 id="2、DML（数据库操作语言）"><a href="#2、DML（数据库操作语言）" class="headerlink" title="2、DML（数据库操作语言）"></a>2、DML（数据库操作语言）</h4><p>这类型语句主要操作的是数据库当中数据的变化，有三个类型，分别是插入语句（insert），删除语句（delete），修改语句（update）。下面我们对上述定义的表结构进行数据上面的操作</p>
<p>插入语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">users</span>(</span><br><span class="line">    name_raw_contact_id,photo_id,photo_file_id,</span><br><span class="line">    last_time_contacted,status_update_id)</span><br><span class="line">    <span class="keyword">VALUES</span>(<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>,<span class="number">18944658190</span>,<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<p>更新语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">users</span> <span class="keyword">SET</span> starred=<span class="number">1</span>, has_phone_number=<span class="number">1</span> <span class="keyword">WHERE</span> _id=<span class="number">3</span>;</span><br></pre></td></tr></table></figure>
<p>删除语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> _id=<span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<p>注意：插入数据的时候，一般要主要强类型的问题，而也要关注主键为NULL以及主键重复的问题（自增长可以解决），还有就是如果字段通过NOT NULL修饰的时候，一般会在定义表结构的时候会给出相应的默认值。</p>
<h4 id="3、DQL（数据库查询语句）"><a href="#3、DQL（数据库查询语句）" class="headerlink" title="3、DQL（数据库查询语句）"></a>3、DQL（数据库查询语句）</h4><p>查询语句是最难的，也是使用最为平凡的语句，在关系术语当中，查询创建一个新的关系（通过一个虚拟表），即就是一个或者多个表的叉积的投影约束，具体的查询语句该怎么写请各位看客自行Google，或者baidu，如下所示一个查询示例，</p>
<p>查询语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> rc.display_name, u.starred </span><br><span class="line">    <span class="keyword">FROM</span> <span class="keyword">users</span> u <span class="keyword">INNER</span> <span class="keyword">JOIN</span> raw_users ru</span><br><span class="line">        <span class="keyword">ON</span> u.name_raw_contact_id=rc._id</span><br><span class="line">    <span class="keyword">WHERE</span> <span class="keyword">NOT</span> ru.display_name <span class="keyword">IS</span> <span class="literal">NULL</span></span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> ru.display_name <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>
<p>连接是两个表的叉积的重要凭证。两个表的一个完整叉积把1个表的每一行于第二个表中每一行进行合拼，在上述的语句当中，users表于raw_contacts表进行连接。叉积的结果将有C（users）*C（raw_contacts）行。</p>
<p>完整的叉积有时候不是非常有用，在查询中 ON字句限制只有name_raw_contacts_id列的值和raw_contacts表中_id列的值相等的时候进行叉积，连接所产生的新的关系包含users表当中的行加上raw_contacts表当中的相应信息。这就非常有用了，下面有一个关于叉积理解的图，相信大家会理解什么是叉积的概念</p>
<p><img src="/2018/02/05/android-sqlite01/android_sqlite002.png" alt="叉积的概念"></p>
<p>根据上述的这个小示例，我们很快就会明白多表查询的原理是什么，主要就是通过条件去约束叉积，然后拿到我们想要的数据。到了这里，基本的SQL语言也就差不多了，剩下三种语言类型，我们可以仔细看我的XXXX博客仔细研究。</p>
<h3 id="三、SQLite入门"><a href="#三、SQLite入门" class="headerlink" title="三、SQLite入门"></a>三、SQLite入门</h3><p>Android端使用的数据库就是开源数据库SQLite，它是一个小型的无服务器的数据库，由于这种数据库的种种特性，让它成为了在手机端极具吸引力的数据库之一，大体说一下都有什么好处，让该数据库这么火热，</p>
<p>该数据库是2000年开发的，当初开发的初衷就是轻量级方式管理结构话数据，所以非常的轻便，具体的优点有以下几点</p>
<ul>
<li>存储在里面的数据持久化的跨进程和电源存在。</li>
<li>跨越系统软件升级和重新安装</li>
<li>处理多种异常情况，非常优雅，比如：低内存环境、磁盘错误、电池电量不足、都不足矣破坏已经持久化的数据</li>
</ul>
<p>当然缺点同时也是存在，关系数据库的几个重要特征部分丢失，SQLite当中没有强类型的支持，虽然有引用完整性的支持，但是默认是关闭的，唯独事务默认情况是开启的。</p>
<p>SQLite数据库其实就是一个文件。在Android设备当中大多数应用程序把数据库存储在文件系统沙箱当中，位于名为datebase的子目录当中，例如对于包是com.suansuan.application的应用程序，其数据库极有可能位于目录/data/data/com.suansuan.application/datebases中。</p>
<p>在以前人们想象能否将数据库放入到SD卡下，让其自己应用程序的数据库被多个程序所共享，但是相比于这么做Android提供了更好的解决思路。</p>
<h4 id="1、SQLite语法"><a href="#1、SQLite语法" class="headerlink" title="1、SQLite语法"></a>1、SQLite语法</h4><p>命令行当中是用sqlite3的时候，首先要记住每条命令必须以分号结束，就和我们写代码的时候一样。</p>
<p>当然还有一些命令，我们称之为元命令，这些命令不属于数据库所有，而是SQLite3去解释与执行，这些命令都是以,开头的命令，其中最常用的就是.help和.exit .schema命令</p>
<p>其余的就是常用的SQL命令了，当然也可以叫做SQL语句</p>
<h4 id="2、支持的数据类型"><a href="#2、支持的数据类型" class="headerlink" title="2、支持的数据类型"></a>2、支持的数据类型</h4><p>前文已经说过SQLite数据库当中没有强引用的支持，实际上列的类型仅仅只是注释，列的类型仅仅只是提示而已，以帮助SQL引擎为此刻存储在该列的数据选择高效的表示。SQL引擎使用一些简单的规则来调节“类型相似性”，从而决定内部存储类型。这些规则几乎不可见，我们开发能感觉到的是给定数据集占用的磁盘数量而已。</p>
<p>实际开发当中，Google开发人员限制自己只使用SQLite的4种基本类型，（integer、real、text、blob）并且显式的使用文本来表示时间戳，使用integer来表示boolean值。</p>
<p>我们通过一个例子，来了解SQLite当中的“类型弱化”</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table test(</span><br><span class="line">   ...&gt; c1 biginteger, c2 smalldatetime, c3 float(9,3));</span><br><span class="line">sqlite&gt; insert into test values("la","la","la");</span><br><span class="line">sqlite&gt; select * from test;</span><br><span class="line">la|la|la</span><br></pre></td></tr></table></figure>
<h4 id="3、关于约束"><a href="#3、关于约束" class="headerlink" title="3、关于约束"></a>3、关于约束</h4><h5 id="3-1、主键约束"><a href="#3-1、主键约束" class="headerlink" title="3.1、主键约束"></a>3.1、主键约束</h5><p>我们可以将列的约束定义在表结构当中，比如我们常常用来修饰主键的 PRIMARY KEY的约束，唯一，表示这一行。同时SQLite支持非整数主键、支持多列复合主键，这里需要注意一下，关于非整数主键，除了“唯一”约束以外，应该还存在“非空”约束。但是由于SQLite早期版本的疏忽，SQLite允许Null作为非整数主键。所以会出现很多行主键为NULL的情况（此NULL非彼NULL），从而我们需要使用代码给插入数据的主键做非空判断，要不然我们数据库当中就会出现无法通过其主键都无法区分的数据，笔者这里把这些数据叫做“脏数据”</p>
<p>通过上述的问题，很多开发人员都使用integer来做为主键列，同时将主键设置为自增长，PRIMARY KEY AUTOINCREMENT。并且SQL引擎为了解决上述问题，会默认的在表当中加入一个隐式的id， </p>
<p>关于自增长，我们可以通过下面示例来了解</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table test(</span><br><span class="line">   ...&gt; key integer primary key,</span><br><span class="line">   ...&gt; val text);</span><br><span class="line">sqlite&gt; insert into test(val) values("something");           </span><br><span class="line">sqlite&gt; insert into test(val) values("liusuansuan");</span><br><span class="line">sqlite&gt; select * from test;</span><br><span class="line">1|something</span><br><span class="line">2|liusuansuan</span><br><span class="line">sqlite&gt;</span><br></pre></td></tr></table></figure>
<p>自增长非常好用，可以唯一表示我们的数据，并且我们都不用去关心，但是正是因为我们的不关心将导致大量丑陋且愚蠢的代码存在，比如我们添加一个新行，并且需要将新行的id存储在SP当中，以便下次快速访问，这种情况下，各位看客想想该如何实现呢。其实笨办法确实有，并且笔者只想到了一种，如果看客有好的想法可以下方留言，那就是再查一遍，</p>
<h5 id="3-2、外键约束"><a href="#3-2、外键约束" class="headerlink" title="3.2、外键约束"></a>3.2、外键约束</h5><p>上文提到过外键约束，SQLite不强制执行外键约束，其实和SQLite列类型类似相似本质上都是注释，但是可以通过修改相应的属性来让SQLite强制执行外键约束</p>
<blockquote>
<p> pragma FOREIGN_KEYS=true </p>
</blockquote>
<p>通过上述指令开启外键的引用完整性。</p>
<p>下面我们来看一下关于外键注释：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; creaet table people(</span><br><span class="line">   ...&gt; name text, address integer references addresses(id));</span><br><span class="line">Error: near "creaet": syntax error</span><br><span class="line">sqlite&gt; create table people(</span><br><span class="line">   ...&gt; name text, address integer references addresses(id));</span><br><span class="line">sqlite&gt; create table addresses(</span><br><span class="line">   ...&gt; id integer primary key, street text);</span><br><span class="line">sqlite&gt; insert into people values("liupengcheng",99);</span><br><span class="line">sqlite&gt; insert into addresses(street) values("shahe");</span><br><span class="line">sqlite&gt; select * from people;</span><br><span class="line">liupengcheng|99</span><br><span class="line">sqlite&gt; select * from addresses;</span><br><span class="line">1|shahe</span><br><span class="line">sqlite&gt; select * from people, addresses where address=id;</span><br><span class="line">sqlite&gt;</span><br></pre></td></tr></table></figure>
<p>上述语句，如果是在支持引用完整性的数据库当中，第一个insert将失败，并且第一个create table people也将失败，因为找不到addresses这个外键表，很显然上述我们的试验都成功了，也就意味这SQLite数据库不会去强制执行外键约束。</p>
<p>但是SQLite的优点就是灵活方便，如果我们需要设计一个复杂类型的、并且多个表通过外键所连接，像这种时候，易于修改和高效的数据存储反而成为了SQLite的闪光点，Google官方文档中描述，鼓励开发人员使用标准范式，然后让开发这自己编写代码的时候自己规划引用完整约束，而不是依赖数据库去实现。</p>
<p>下面我们来模拟一个简单的连接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table people(</span><br><span class="line">   ...&gt; name text, address integer references addresses(id));</span><br><span class="line">sqlite&gt; create table addresses(id integer primary key, street text);</span><br><span class="line">sqlite&gt; insert into addresses(street) values("北京");</span><br><span class="line">sqlite&gt; insert into addresses(street) values("上海");</span><br><span class="line">sqlite&gt; insert into people values("张飞“,1);</span><br><span class="line">sqlite&gt; insert into people values("张飞",1);</span><br><span class="line">sqlite&gt; insert into people values("关羽",2);</span><br><span class="line">sqlite&gt; insert into people values("刘备",2);</span><br><span class="line">sqlite&gt; select name,street from people,addresses where address=id;</span><br><span class="line">张飞|北京</span><br><span class="line">关羽|上海</span><br><span class="line">刘备|上海</span><br></pre></td></tr></table></figure>
<p>SQLite中还支持一些其他的约束，比如：</p>
<ul>
<li>unique：该约束表示SQLite将拒绝任何试图在表中添加将导致该列出现重复值的一行。</li>
<li>not null：该约束表述SQLite将拒绝任何试图将表中数据置为NULL的所有操纵。</li>
<li>check(expression):当次约束修饰列时，每当一个新行添加到表中时，或当修改现有的行时，都会对表达式求值，如果求值的结果转化整数为0时，该操作将失败，操作将取消。如果表达式的计算结果为NULL或者任何其他非零值，则操作成功</li>
</ul>
<p>下面展示一个列约束：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table test(</span><br><span class="line">   ...&gt; c1 text unique, c2 text not null, c3 text check(c3 in ("OK","Dandy")));</span><br><span class="line">sqlite&gt; insert into test values("dandy","dandy","dandy");</span><br><span class="line">Error: <span class="keyword">CHECK</span> <span class="keyword">constraint</span> <span class="keyword">failed</span>: <span class="keyword">test</span></span><br><span class="line">sqlite&gt; <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">test</span> <span class="keyword">values</span>(<span class="string">"dandy"</span>,<span class="string">"dandy"</span>,<span class="string">"Dandy"</span>);        </span><br><span class="line">sqlite&gt; insert into test values("dandy","dandy","Dandy");</span><br><span class="line">Error: UNIQUE constraint failed: test.c1</span><br><span class="line">sqlite&gt; insert into test values("dandy",null,"Dandy");   </span><br><span class="line">Error: NOT NULL constraint failed: test.c2</span><br></pre></td></tr></table></figure>
<h4 id="4、SQLite数据库示例"><a href="#4、SQLite数据库示例" class="headerlink" title="4、SQLite数据库示例"></a>4、SQLite数据库示例</h4><p>在开始我们的程序示例之前，我们需要对我们数据库当中的数据进行一些格式化，好方便我们之后的查看数据。使用SQLite的元命令来进行数据库数据展示的格式化。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt;.header on</span><br><span class="line">sqlite&gt;.mode column</span><br><span class="line">sqlite&gt;.timer on</span><br></pre></td></tr></table></figure>
<p>具体详细内容，可以参考SQLite元命令<a href="http://www.runoob.com/sqlite/sqlite-commands.html" target="_blank" rel="noopener">http://www.runoob.com/sqlite/sqlite-commands.html</a></p>
<p>我们来尝试去创建一个完整的User的数据库。</p>
<h5 id="1、创建User表"><a href="#1、创建User表" class="headerlink" title="1、创建User表"></a>1、创建User表</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table users(</span><br><span class="line">   ...&gt; _id integer primary key autoincrement,</span><br><span class="line">   ...&gt; name text not null);</span><br><span class="line">sqlite&gt;</span><br></pre></td></tr></table></figure>
<p>我们需要一个字段是用来记录这条记录是什么时候被修改的，好方便我们以后对数据的修改</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; alter table users add last_modified_time text;</span><br><span class="line">Run Time: real 0.003 user 0.000000 sys 0.000000</span><br></pre></td></tr></table></figure>
<h5 id="2、创建触发器"><a href="#2、创建触发器" class="headerlink" title="2、创建触发器"></a>2、创建触发器</h5><p>我们让刚刚我们定义完的字段，可以根据我们插入数据，或者是添加数据跟随我们插入数据和更新数据取当前最新的时间。这里定义两个触发器，一个是跟随insert所进行触发，一个根据update进行触发。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; create trigger t_users_audit_i</span><br><span class="line">   ...&gt; after insert </span><br><span class="line">   ...&gt; on users</span><br><span class="line">   ...&gt; begin</span><br><span class="line">   ...&gt; update users set last_modified_time=datetime('now','utc')</span><br><span class="line">   ...&gt; where rowid=new.rowid; end;</span><br><span class="line">Run Time: real 0.003 user 0.000000 sys 0.000000</span><br><span class="line"></span><br><span class="line">sqlite&gt; create trigger t_users_audit_u</span><br><span class="line">   ...&gt; after update </span><br><span class="line">   ...&gt; on users </span><br><span class="line">   ...&gt; begin</span><br><span class="line">   ...&gt; update users set last_modified=datetime('now','utc')</span><br><span class="line">   ...&gt; where rowid=new.rowid;</span><br><span class="line">   ...&gt; end;</span><br><span class="line"></span><br><span class="line">Run Time: real 0.003 user 0.000000 sys 0.000000</span><br></pre></td></tr></table></figure>
<p>上述触发器创建的时候用到了datetime数据库内置和日期相关的函数。具体内容可以查看<a href="http://www.runoob.com/sqlite/sqlite-date-time.html" target="_blank" rel="noopener">http://www.runoob.com/sqlite/sqlite-date-time.html</a></p>
<p>现在我们插入一条数据来验证我们刚刚创建的结构是否正确。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; insert into users(name) values("liupengcheng");</span><br><span class="line"></span><br><span class="line">Run Time: real 0.003 user 0.000000 sys 0.004000</span><br><span class="line"></span><br><span class="line">sqlite&gt; select * from users;</span><br><span class="line"></span><br><span class="line">_id         name          last_modified_time </span><br><span class="line"><span class="comment">----------  ------------  -------------------</span></span><br><span class="line">2           liupengcheng  2018-03-09 09:50:40</span><br><span class="line"></span><br><span class="line">Run Time: real 0.000 user 0.000000 sys 0.000000</span><br></pre></td></tr></table></figure>
<p>我们的User可能需要地址，比如客户的收货地址，所以我们创建一个地址表，</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table addresses(</span><br><span class="line">   ...&gt; _id integer primary key autoincrement,</span><br><span class="line">   ...&gt; number integer not null,</span><br><span class="line">   ...&gt; unit text,</span><br><span class="line">   ...&gt; street text not null,</span><br><span class="line">   ...&gt; city integer references cities);</span><br><span class="line"></span><br><span class="line">Run Time: real 0.004 user 0.000000 sys 0.000000</span><br></pre></td></tr></table></figure>
<p>如果我们引用完整性的支持已经开启的话，这个表的定义肯定会导致一个错误，因为这里cities这张表是不存在的。不过在SQLite数据库的默认配置当中，是没有问题的，我们可以稍后去定义cities这张表。</p>
<p>现在我们的用户存在了，地址表也存在了，这里分析得到，一个用户可以有多个收货地址，一个收货地址可以被多个人多共有，所以这里的关系是多对多，一般的主外键支持一对多，如果是多对多的关系的话，我们就需要建立第三张表专门的让上述两张表进行对应了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; create table users_addresses(</span><br><span class="line">   ...&gt; users integer references users,</span><br><span class="line">   ...&gt; address integer references addresses);</span><br><span class="line"></span><br><span class="line">Run Time: real 0.004 user 0.000000 sys 0.004000</span><br></pre></td></tr></table></figure>
<p>现在我们来我们创建的数据库添加数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span>(<span class="keyword">name</span>) <span class="keyword">values</span>(<span class="string">"wangyiqi"</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span>(<span class="keyword">name</span>) <span class="keyword">values</span>(<span class="string">"wwangpeng"</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span>(<span class="keyword">name</span>) <span class="keyword">values</span>(<span class="string">"liuna"</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span>(<span class="keyword">name</span>) <span class="keyword">values</span>(<span class="string">"yangqiqi"</span>);</span><br><span class="line">sqlite&gt; select * from users;</span><br><span class="line"></span><br><span class="line">_id         name          last_modified_time </span><br><span class="line"><span class="comment">----------  ------------  -------------------</span></span><br><span class="line">2           liupengcheng  2018-03-09 09:50:40</span><br><span class="line">3           wangyiqi      2018-03-09 10:18:42</span><br><span class="line">4           wwangpeng     2018-03-09 10:18:42</span><br><span class="line">5           liuna         2018-03-09 10:18:42</span><br><span class="line">6           yangqiqi      2018-03-09 10:19:01</span><br><span class="line">Run Time: real 0.003 user 0.000000 sys 0.000000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> addresses(<span class="built_in">number</span>,street) <span class="keyword">values</span>(<span class="number">651</span>, <span class="string">"北京昌平"</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> addresses(<span class="built_in">number</span>,street) <span class="keyword">values</span>(<span class="number">1600</span>, <span class="string">"上海浦东"</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> addresses(<span class="built_in">number</span>,street) <span class="keyword">values</span>(<span class="number">259</span>, <span class="string">"哈尔滨江北"</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> addresses(<span class="built_in">number</span>,street) <span class="keyword">values</span>(<span class="number">693</span>, <span class="string">"甘肃天水"</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> addresses(<span class="built_in">number</span>,street) <span class="keyword">values</span>(<span class="number">1658</span>, <span class="string">"北京朝阳"</span>);</span><br><span class="line">sqlite&gt; select * from addresses;</span><br><span class="line"></span><br><span class="line">_id         number      unit        street        city      </span><br><span class="line"><span class="comment">----------  ----------  ----------  ------------  ----------</span></span><br><span class="line">1           651                     北京昌平            </span><br><span class="line">2           1600                    上海浦东            </span><br><span class="line">3           259                     哈尔滨江            </span><br><span class="line">4           693                     甘肃天水            </span><br><span class="line">5           1658                    北京朝阳            </span><br><span class="line">Run Time: real 0.000 user 0.000000 sys 0.000000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> users_addresses(<span class="keyword">users</span>,address) <span class="keyword">values</span>(<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> users_addresses(<span class="keyword">users</span>,address) <span class="keyword">values</span>(<span class="number">3</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> users_addresses(<span class="keyword">users</span>,address) <span class="keyword">values</span>(<span class="number">4</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> users_addresses(<span class="keyword">users</span>,address) <span class="keyword">values</span>(<span class="number">5</span>,<span class="number">4</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> users_addresses(<span class="keyword">users</span>,address) <span class="keyword">values</span>(<span class="number">6</span>,<span class="number">5</span>);</span><br><span class="line">sqlite&gt; select * from users_addresses;</span><br><span class="line"></span><br><span class="line">users       address   </span><br><span class="line"><span class="comment">----------  ----------</span></span><br><span class="line">2           1         </span><br><span class="line">3           2         </span><br><span class="line">4           3         </span><br><span class="line">5           4         </span><br><span class="line">6           5         </span><br><span class="line">Run Time: real 0.000 user 0.000000 sys 0.000000</span><br></pre></td></tr></table></figure>
<p>现在数据也有了，关系也键全了，现在可以使用关联关系进行查看我们之前所编辑的数据实体了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sqlite&gt; select name,street,number from users,addresses,users_addresses where users._id = users_addresses.users and addresses._id = users_addresses.address;</span><br><span class="line"></span><br><span class="line">name          street        number    </span><br><span class="line"><span class="comment">------------  ------------  ----------</span></span><br><span class="line">liupengcheng  北京昌平  651       </span><br><span class="line">wangyiqi      上海浦东  1600      </span><br><span class="line">wwangpeng     哈尔滨江  259       </span><br><span class="line">liuna         甘肃天水  693       </span><br><span class="line">yangqiqi      北京朝阳  1658      </span><br><span class="line"></span><br><span class="line">Run Time: real 0.000 user 0.000000 sys 0.000000</span><br></pre></td></tr></table></figure>
<p>如果我们想确定一个地址下面有多少用户，我们可以使用count函数和group by字句来实现。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="keyword">name</span>),<span class="built_in">number</span>,street </span><br><span class="line"><span class="keyword">from</span> <span class="keyword">users</span>,addresses,users_addresses </span><br><span class="line"><span class="keyword">where</span> users._id=users_addresses.users </span><br><span class="line"><span class="keyword">and</span> addresses._id=users_addresses.address </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="built_in">number</span>,street;</span><br><span class="line"></span><br><span class="line">count(name)  number      street         </span><br><span class="line"><span class="comment">-----------  ----------  ---------------</span></span><br><span class="line">1            259         哈尔滨江北</span><br><span class="line">1            651         北京昌平   </span><br><span class="line">1            693         甘肃天水   </span><br><span class="line">1            1600        上海浦东   </span><br><span class="line">1            1658        北京朝阳   </span><br><span class="line"></span><br><span class="line">Run Time: real 0.000 user 0.000000 sys 0.000000</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/02/05/android-sqlite01/" data-id="ck2opn4ks00350mewbnyd0lsu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库/">数据库</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android-UI-drawing-bitmap-01" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/05/android-UI-drawing-bitmap-01/" class="article-date">
  <time datetime="2017-08-05T04:34:35.000Z" itemprop="datePublished">2017-08-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/05/android-UI-drawing-bitmap-01/">Bitmap的基础用法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1、前言"><a href="#1、前言" class="headerlink" title="1、前言"></a>1、前言</h3><p>在前面的两讲当中，我们研究了Drawable是什么东西，我们今天一块来探讨一下什么是Bitmap，首先我们要明白，Drawable是Android当中所有可以绘制事物的一个抽象的概念，而Bitmap是可以绘制的，所以Bitmap属于Drawable的一种，所以Drawable是大的范围，而Bitmap是小的范围，如果是这样的话，就会衍生出，一个Bitmap是Drawable，而Drawable不一定是Bitmap。这也是两者的区别所在，我们在前两讲当中提过对Bitmap进行的一个封装就是BitmapDrawable而BitmapDrawable是Drawable的一个子类，想想我们当时定义的Xml文件，我相信大家会理解这两者的区别。</p>
<h3 id="2、正文"><a href="#2、正文" class="headerlink" title="2、正文"></a>2、正文</h3><p>今天的内容我先给大家看一幅图片，大家应该就明白了</p>
<p><img src="/2017/08/05/android-UI-drawing-bitmap-01/01.png" alt="Bitmap知识导航"></p>
<p>今天的重点是关于Bitmap，至于关于如何绘制，以后会讲解的，下面我们就上述三点来开始今天的博客，不过在开始之前我们一定到明白，Drawable和Bitmap的区别。</p>
<p>Bitmap是一张位图，扩展名为.bmp.dip，为什么说它是位图呢，因为它将图像定义为由点（像素）组成，每个点可以由多种色彩表示，包括2、4、8、16、24和32位色彩，例如一幅1024×768分辨率的32位真彩图片，其所占存储字节数为：1024×768×32/8=3072KB。位图文件图像效果好，但是非压缩格式的，需要占用较大存储空间，所以我们遇到的OOM大部分都是由Bitmap的造成的</p>
<p>如果还是不太清楚Bitmap和Drawable的区别的话，那我们现在就理解为，Drawable实际上就是一个空的架子，里面可以以装载各式各样的图像，而bitmap就是其中的一幅图像，这种图像图像质量比较好。而前者重行为，而后者重数据（图像数据）像一般的移动架子之类的我们就会对其封装到Drawable当中，而如果我们要去改动画本身的属性，就去修改Bitmap，或者其他的画。</p>
<p>3、Bitmap怎么来的（怎么创建一个Bitmap，或者通过资源生成一个Bitmap）</p>
<p>Bitmap是不能New出来的，因为它的构造器私有，并且它的实例化是JNI做的，所以只有去实例化了JNI我们才能去创建Bitmap，既然是JNI做的，那么必然Google会给我提供使用的方法，不错那就Bitmap.createBitmap()；通过这个方法我们就能得到一个Bitmap。</p>
<p>在我们创建Bitmap的时候，涉及到一个名为Bitmap.Config的这个类，这个类的具体的作用就是在我们构建自己新的Bitmap的时候来告诉系统，构建一个什么质量的Bitmap。好的   还是坏的，点进去我们看</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Config &#123;</span><br><span class="line">    ALPHA_8     (<span class="number">1</span>),</span><br><span class="line">    RGB_565     (<span class="number">3</span>),</span><br><span class="line">    <span class="meta">@Deprecated</span></span><br><span class="line">    ARGB_4444   (<span class="number">4</span>),</span><br><span class="line">    ARGB_8888   (<span class="number">5</span>)，</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> nativeInt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Config sConfigs[] = &#123;</span><br><span class="line">        <span class="keyword">null</span>, ALPHA_8, <span class="keyword">null</span>, RGB_565, ARGB_4444, ARGB_8888</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    Config(<span class="keyword">int</span> ni) &#123;</span><br><span class="line">        <span class="keyword">this</span>.nativeInt = ni;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> Config <span class="title">nativeToConfig</span><span class="params">(<span class="keyword">int</span> ni)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sConfigs[ni];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Config &#123;</span><br><span class="line">    ALPHA_8     (<span class="number">1</span>),</span><br><span class="line">    RGB_565     (<span class="number">3</span>),</span><br><span class="line">    <span class="meta">@Deprecated</span></span><br><span class="line">    ARGB_4444   (<span class="number">4</span>),</span><br><span class="line">    ARGB_8888   (<span class="number">5</span>)，</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> nativeInt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Config sConfigs[] = &#123;</span><br><span class="line">        <span class="keyword">null</span>, ALPHA_8, <span class="keyword">null</span>, RGB_565, ARGB_4444, ARGB_8888</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    Config(<span class="keyword">int</span> ni) &#123;</span><br><span class="line">        <span class="keyword">this</span>.nativeInt = ni;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> Config <span class="title">nativeToConfig</span><span class="params">(<span class="keyword">int</span> ni)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sConfigs[ni];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>大家也看到了在这其中主要维护了4个变量，来表示图片质量的高低，分别是：</p>
<ul>
<li>ALPHA_8 Alpha：由8位组成</li>
<li>ARGB_4444：由4个4位组成即16位，</li>
<li>ARGB_8888：由4个8位组成即32位，</li>
<li>RGB_565：R为5位，G为6位，B为5位共16位，</li>
</ul>
<p>当然位数越高代表的图片的质量就越高</p>
<p>createBitmap(Bitmap source)：根据原有的Bitmap去创建一个新的bitmap</p>
<ul>
<li><p>createBitmap(Bitmap source, int x, int y, int width, int height)：根据原有的bitmap去创建一个从原有bitmap的(x, y)这个点起，宽为width,高为height的bitmap一般使用这个方法去裁剪原有的bitmap</p>
</li>
<li><p>createBitmap(Bitmap source, int x, int y, int width, int height, Matrix matrix, boolean) ：根据原有的bitmap创建一个从原有bitmap的(x, y)这个点起，宽为width,高为height的bitmap，并且对该bitmap进行matrix的矩阵变换，最后一个参数是：当进行的不仅仅是平移变换时，filter为true的情况下会进行滤波处理，意思就是说让新生成的bitmap的图像质量好点，为false，就没有滤波处理</p>
</li>
<li><p>createBitmap(int width, int height, Config config)：创建一个宽为width，高为height，图片质量为config的bitmap</p>
</li>
<li><p>createBitmap(DisplayMetrics displayMetrics, int width, int height, Config config)：根据屏幕信息displayMetrics创建一个宽为width，高为height，图片质量为config的bitmap</p>
</li>
<li><p>createBitmap(DisplayMetrics displayMetrics, int[] color, int width, int height, Config onfig)：根据屏幕信息displayMetrice创建一个宽为width,高为heighe，图片质量为config，并且使用颜色数组color从上而下，从左到右进行填充</p>
</li>
<li><p>createBitmap(DisplayMetrics, int[], int, int, int, int, Config)： 这个方法和上述方法功能相近，但是有两个参数博主不知道什么意思，Android官方文档上的解释居然和上述方法相近</p>
</li>
<li><p>createBitmap(int[], int, int, int, int, Config)：创建一个宽为width,高为heighe，图片质量为config，并且使用颜色数组color从上而下，从左到右进行填充</p>
</li>
<li><p>createBitmap(int[], int, int, Config)：创建一个宽为width,高为heighe，图片质量为config，并且使用颜色数组color从上而下，从左到右进行填充</p>
</li>
<li><p>createScaledBitmap(Bitmap src, int dstWidth, int dstHeight, boolean filter)：对原始的Bitmap进行缩放，最后一个参数的意思就是bitmap边缘抗锯齿。<br>上述就是我们自己去创建一个一个新的Bitmap，在这里我们得说说 在我们使用裁剪Bitmap的时候createBitmap(Bitmap source, int x, int y, int width, int height)我们得记住我们开始的点x+width&lt;=source.getWidth(),要不然会报异常。</p>
</li>
</ul>
<p>下面我们去看看如何在资源文件当中去解析出我们的Bitmap，在我们开始解析之前，我们要在这里再次为大家介绍一个帮助类，那么这个帮助类是BitmapFactory，这个类有一个decodeXXXXX();的静态方法，通过这个方法我们就可以得到一个Bitmap对象，decodeXXXXX();主要分为四种，分别是读取文件，资源，流，byte[]数组，当中的Bitmap，而在读取的时候会有一些配置需要我们去选择，Google也给我们封装在BitmapFactory的静态内部类Options类当中，我们点进去看一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Options</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Options</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        inDither = <span class="keyword">false</span>;</span><br><span class="line">        inScaled = <span class="keyword">true</span>;</span><br><span class="line">        inPremultiplied = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 维护了一个Bitmap位图对象，如果更改解码方式则，重用这个位图加载内容。  */</span></span><br><span class="line">    <span class="keyword">public</span> Bitmap inBitmap;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置Bitmap是否可以更改，比如：在Bitmap上隔几个像素加一条线段</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"UnusedDeclaration"</span>&#125;) <span class="comment">// used in native code</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> inMutable;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 如果设置为true，不获取图片，不分配内存，但会返回图片的高度宽度信息。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> inJustDecodeBounds;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 图片缩放的倍数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> inSampleSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置解码图片质量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Bitmap.Config inPreferredConfig = Bitmap.Config.ARGB_8888;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 为true，产生的位图将它的颜色通道pre-multipled alpha通道。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> inPremultiplied;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 如果为true,解码器尝试抖动解码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> inDither;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用于位图的像素压缩比</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> inDensity;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用于目标位图的像素压缩比（要生成的位图）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> inTargetDensity;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当前屏幕的像素密度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> inScreenDensity;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置为true时进行图片压缩，从inDensity到inTargetDensity</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> inScaled;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当存储Pixel的内存空间在系统内存不足时是否可以被回收</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Deprecated</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> inPurgeable;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * inPurgeable为true情况下才生效，是否可以共享一个InputStream</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Deprecated</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> inInputShareable;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 为true则优先保证Bitmap质量其次是解码速度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> inPreferQualityOverSpeed;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取图片的宽度值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> outWidth;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取图片的高度值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> outHeight;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置解码图像</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String outMimeType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建临时文件，将图片存储</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] inTempStorage;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * mCancel为true取消当前Decode</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> mCancel;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>读取文件当中的bitmap文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">decodeFile</span><span class="params">(String pathName, Options opts)</span> <span class="comment">//从文件读取图片 </span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">decodeFile</span><span class="params">(String pathName)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">decodeFileDescriptor</span><span class="params">(FileDescriptor fd)</span><span class="comment">//从文件读取文件 与decodeFile不同的是这个直接调用JNI函数进行读取 效率比较高</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">decodeFileDescriptor</span><span class="params">(FileDescriptor fd, Rect outPadding, Options opts)</span></span></span><br></pre></td></tr></table></figure>
<p>读取bitmap资源文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">decodeResource</span><span class="params">(Resources res, <span class="keyword">int</span> id)</span> <span class="comment">//从资源文件读取图片</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">decodeResource</span><span class="params">(Resources res, <span class="keyword">int</span> id, Options opts)</span></span></span><br></pre></td></tr></table></figure>
<p>读取流中bitmap</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public static Bitmap decodeStream(InputStream is) //从输入流读取图片</span><br><span class="line"></span><br><span class="line">public static Bitmap decodeStream(InputStream is, Rect outPadding, Options opts)</span><br></pre></td></tr></table></figure>
<p>读取byte[]数组中的Bitmap</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">decodeByteArray</span><span class="params">(<span class="keyword">byte</span>[] data, <span class="keyword">int</span> offset, <span class="keyword">int</span> length)</span> <span class="comment">//从数组读取图片</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">decodeByteArray</span><span class="params">(<span class="keyword">byte</span>[] data, <span class="keyword">int</span> offset, <span class="keyword">int</span> length, Options opts)</span></span></span><br></pre></td></tr></table></figure>
<p>以上就是如何创建一个Bitmap文件</p>
<h3 id="4、如何显示到屏幕上面，"><a href="#4、如何显示到屏幕上面，" class="headerlink" title="4、如何显示到屏幕上面，"></a>4、如何显示到屏幕上面，</h3><p>如果我们要把我们的Bitmap显示到屏幕上我们必须要依赖View通过View进行显示，其实每一个View都是可以显示图片的，用作背景的情况下都是可以的，但是显示的是一个Drawable对象，所以有时候我们要去研究Drawable和Bitmap之间的转换问题，</p>
<p>注意：（这里考虑View，ViewGroup，ImagView，ImageButton等个别可以直接显示的等会再说）</p>
<h4 id="1、Bitmap转换成为Drawable，"><a href="#1、Bitmap转换成为Drawable，" class="headerlink" title="1、Bitmap转换成为Drawable，"></a>1、Bitmap转换成为Drawable，</h4><p>我们说过Bitmap是Drawable的一个子类，所以我们只需要通过中间BitmapDrawable去封装一下Bitmap即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** bitmap ---&gt; Drawable */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Drawable <span class="title">bitmap2Drawable</span><span class="params">(Bitmap bitmap)</span></span>&#123;</span><br><span class="line">    BitmapDrawable bitmapDrawable = <span class="keyword">new</span> BitmapDrawable(bitmap);</span><br><span class="line">    <span class="keyword">return</span> bitmapDrawable;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** bitmap ---&gt; Drawable */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Drawable <span class="title">bitmap2Drawable</span><span class="params">(Resources res, Bitmap bitmap)</span></span>&#123;</span><br><span class="line">    BitmapDrawable bitmapDrawable = <span class="keyword">new</span> BitmapDrawable(res, bitmap);</span><br><span class="line">    <span class="keyword">return</span> bitmapDrawable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2、Drawable转换成为Bitmap"><a href="#2、Drawable转换成为Bitmap" class="headerlink" title="2、Drawable转换成为Bitmap"></a>2、Drawable转换成为Bitmap</h4><p>我们说过Bitmap保存的是图像的数据，通过这个我们可以使用Canvas把Drawable的图像数据画到bitmap</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Drawable --- &gt; Bitmap */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Bitmap <span class="title">bitmap2Drawable</span><span class="params">(Drawable drawable)</span></span>&#123;</span><br><span class="line">      Bitmap bitmap = Bitmap.createBitmap(drawable.getIntrinsicWidth(), drawable.getIntrinsicHeight(),</span><br><span class="line">              drawable.getOpacity() != PixelFormat.OPAQUE ? Bitmap.Config.ARGB_8888 : Bitmap.Config.RGB_565);</span><br><span class="line">      Canvas canvas = <span class="keyword">new</span> Canvas(bitmap);</span><br><span class="line">      drawable.setBounds(<span class="number">0</span>, <span class="number">0</span>, drawable.getIntrinsicWidth(), drawable.getIntrinsicHeight());</span><br><span class="line">      drawable.draw(canvas);</span><br><span class="line">      <span class="keyword">return</span> bitmap;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>转换成为Drawable以后我们就可以轻松设置到随便一个View的背景显示出来了，至于ImageView，ImageButton，它则提供了直接设置Bitmap的方法，直接调用即可。</p>
<h3 id="5、怎么保存我们的Bitmap文件呢！"><a href="#5、怎么保存我们的Bitmap文件呢！" class="headerlink" title="5、怎么保存我们的Bitmap文件呢！"></a>5、怎么保存我们的Bitmap文件呢！</h3><p>我们先来看一下这个方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public boolean compress(CompressFormat format, int quality, OutputStream stream)//按指定的图片格式以及画质，将图片转换为输出流。</span><br><span class="line">format：Bitmap.CompressFormat.PNG或Bitmap.CompressFormat.JPEG</span><br><span class="line">quality：画质，0-100.0表示最低画质压缩，100以最高画质压缩。对于PNG等无损格式的图片，会忽略此项设置。</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 把Bitmap图片保存在本地 */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeBitmapToFile</span><span class="params">(String filePath, Bitmap b, <span class="keyword">int</span> quality)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        File desFile = <span class="keyword">new</span> File(filePath);</span><br><span class="line">        FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(desFile);</span><br><span class="line">        BufferedOutputStream bos = <span class="keyword">new</span> BufferedOutputStream(fos);</span><br><span class="line">        b.compress(Bitmap.CompressFormat.JPEG, quality, bos);</span><br><span class="line">        bos.flush();</span><br><span class="line">        bos.close();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过上述方法不仅仅是可以保存，它是可以压缩的，我们来看看这个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 以quality画质对Bitmap进行压缩 */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Bitmap <span class="title">compressImage</span><span class="params">(Bitmap image, <span class="keyword">int</span> quality)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (image == <span class="keyword">null</span> || quality &lt; <span class="number">0</span> || quality &gt; <span class="number">100</span>) &#123; <span class="keyword">return</span> <span class="keyword">null</span>; &#125;</span><br><span class="line">    ByteArrayOutputStream baos = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        baos = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        image.compress(Bitmap.CompressFormat.JPEG, quality, baos);</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = baos.toByteArray();</span><br><span class="line">        ByteArrayInputStream isBm = <span class="keyword">new</span> ByteArrayInputStream(bytes);</span><br><span class="line">        Bitmap bitmap = BitmapFactory.decodeStream(isBm);</span><br><span class="line">        <span class="keyword">return</span> bitmap;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (OutOfMemoryError e) &#123;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (baos != <span class="keyword">null</span>) &#123;</span><br><span class="line">                baos.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于优化的问题，后面博客说吧，毕竟这篇是介绍篇，好了我们接下来看看我们的今天的测试Demo，其实我们学习关于Bitmap的各种操作方法，大多数的情况不是说是为了某种目的去操作它。而是由于OOM异常，被迫的去压缩，去裁剪，去降低图片质量，已达到最优的情况，最优的情况包括，首先程序不能崩，速度最快，用户体验不能卡之类的。所以我打算我的这个Demo就主要去对这一方面去写点东西。</p>
<p>首先我们来看一下效果吧</p>
<p><img src="/2017/08/05/android-UI-drawing-bitmap-01/02.png" alt="高斯模糊"></p>
<p>生成一种毛玻璃的效果，在这里我要说的是每一种毛玻璃的效果都有一种模糊算法在支持，有的模糊算法是C写的，有的是用Java写的，这里面有很大的学问，这里就不要深究啦总之通过原图的Bitmap生成模糊的Bitmap很吃内存，没办法，我们首先对Bitmap缩小  去生成模糊bitmap 然后再去放大，有可能还会用到压缩Bitmap，最后以ImageView为载体显示出来，所作的一切都是被迫的，这种情况会在以后发生很多，好了看代码吧！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过Java去实现的模糊算法 不是博主写的，</span></span><br><span class="line"><span class="comment"> * Created by jay on 11/7/15.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FastBlurUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">doBlur</span><span class="params">(Bitmap sentBitmap, <span class="keyword">int</span> radius, <span class="keyword">boolean</span> canReuseInBitmap)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Bitmap bitmap;</span><br><span class="line">        <span class="keyword">if</span> (canReuseInBitmap) &#123;</span><br><span class="line">            bitmap = sentBitmap;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            bitmap = sentBitmap.copy(sentBitmap.getConfig(), <span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (radius &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> w = bitmap.getWidth();</span><br><span class="line">        <span class="keyword">int</span> h = bitmap.getHeight();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span>[] pix = <span class="keyword">new</span> <span class="keyword">int</span>[w * h];</span><br><span class="line">        bitmap.getPixels(pix, <span class="number">0</span>, w, <span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> wm = w - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> hm = h - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> wh = w * h;</span><br><span class="line">        <span class="keyword">int</span> div = radius + radius + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> r[] = <span class="keyword">new</span> <span class="keyword">int</span>[wh];</span><br><span class="line">        <span class="keyword">int</span> g[] = <span class="keyword">new</span> <span class="keyword">int</span>[wh];</span><br><span class="line">        <span class="keyword">int</span> b[] = <span class="keyword">new</span> <span class="keyword">int</span>[wh];</span><br><span class="line">        <span class="keyword">int</span> rsum, gsum, bsum, x, y, i, p, yp, yi, yw;</span><br><span class="line">        <span class="keyword">int</span> vmin[] = <span class="keyword">new</span> <span class="keyword">int</span>[Math.max(w, h)];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> divsum = (div + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        divsum *= divsum;</span><br><span class="line">        <span class="keyword">int</span> dv[] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span> * divsum];</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span> * divsum; i++) &#123;</span><br><span class="line">            dv[i] = (i / divsum);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        yw = yi = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span>[][] stack = <span class="keyword">new</span> <span class="keyword">int</span>[div][<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">int</span> stackpointer;</span><br><span class="line">        <span class="keyword">int</span> stackstart;</span><br><span class="line">        <span class="keyword">int</span>[] sir;</span><br><span class="line">        <span class="keyword">int</span> rbs;</span><br><span class="line">        <span class="keyword">int</span> r1 = radius + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> routsum, goutsum, boutsum;</span><br><span class="line">        <span class="keyword">int</span> rinsum, ginsum, binsum;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; h; y++) &#123;</span><br><span class="line">            rinsum = ginsum = binsum = routsum = goutsum = boutsum = rsum = gsum = bsum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (i = -radius; i &lt;= radius; i++) &#123;</span><br><span class="line">                p = pix[yi + Math.min(wm, Math.max(i, <span class="number">0</span>))];</span><br><span class="line">                sir = stack[i + radius];</span><br><span class="line">                sir[<span class="number">0</span>] = (p &amp; <span class="number">0xff0000</span>) &gt;&gt; <span class="number">16</span>;</span><br><span class="line">                sir[<span class="number">1</span>] = (p &amp; <span class="number">0x00ff00</span>) &gt;&gt; <span class="number">8</span>;</span><br><span class="line">                sir[<span class="number">2</span>] = (p &amp; <span class="number">0x0000ff</span>);</span><br><span class="line">                rbs = r1 - Math.abs(i);</span><br><span class="line">                rsum += sir[<span class="number">0</span>] * rbs;</span><br><span class="line">                gsum += sir[<span class="number">1</span>] * rbs;</span><br><span class="line">                bsum += sir[<span class="number">2</span>] * rbs;</span><br><span class="line">                <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    rinsum += sir[<span class="number">0</span>];</span><br><span class="line">                    ginsum += sir[<span class="number">1</span>];</span><br><span class="line">                    binsum += sir[<span class="number">2</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    routsum += sir[<span class="number">0</span>];</span><br><span class="line">                    goutsum += sir[<span class="number">1</span>];</span><br><span class="line">                    boutsum += sir[<span class="number">2</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            stackpointer = radius;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; w; x++) &#123;</span><br><span class="line"></span><br><span class="line">                r[yi] = dv[rsum];</span><br><span class="line">                g[yi] = dv[gsum];</span><br><span class="line">                b[yi] = dv[bsum];</span><br><span class="line"></span><br><span class="line">                rsum -= routsum;</span><br><span class="line">                gsum -= goutsum;</span><br><span class="line">                bsum -= boutsum;</span><br><span class="line"></span><br><span class="line">                stackstart = stackpointer - radius + div;</span><br><span class="line">                sir = stack[stackstart % div];</span><br><span class="line"></span><br><span class="line">                routsum -= sir[<span class="number">0</span>];</span><br><span class="line">                goutsum -= sir[<span class="number">1</span>];</span><br><span class="line">                boutsum -= sir[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (y == <span class="number">0</span>) &#123;</span><br><span class="line">                    vmin[x] = Math.min(x + radius + <span class="number">1</span>, wm);</span><br><span class="line">                &#125;</span><br><span class="line">                p = pix[yw + vmin[x]];</span><br><span class="line"></span><br><span class="line">                sir[<span class="number">0</span>] = (p &amp; <span class="number">0xff0000</span>) &gt;&gt; <span class="number">16</span>;</span><br><span class="line">                sir[<span class="number">1</span>] = (p &amp; <span class="number">0x00ff00</span>) &gt;&gt; <span class="number">8</span>;</span><br><span class="line">                sir[<span class="number">2</span>] = (p &amp; <span class="number">0x0000ff</span>);</span><br><span class="line"></span><br><span class="line">                rinsum += sir[<span class="number">0</span>];</span><br><span class="line">                ginsum += sir[<span class="number">1</span>];</span><br><span class="line">                binsum += sir[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">                rsum += rinsum;</span><br><span class="line">                gsum += ginsum;</span><br><span class="line">                bsum += binsum;</span><br><span class="line"></span><br><span class="line">                stackpointer = (stackpointer + <span class="number">1</span>) % div;</span><br><span class="line">                sir = stack[(stackpointer) % div];</span><br><span class="line"></span><br><span class="line">                routsum += sir[<span class="number">0</span>];</span><br><span class="line">                goutsum += sir[<span class="number">1</span>];</span><br><span class="line">                boutsum += sir[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">                rinsum -= sir[<span class="number">0</span>];</span><br><span class="line">                ginsum -= sir[<span class="number">1</span>];</span><br><span class="line">                binsum -= sir[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">                yi++;</span><br><span class="line">            &#125;</span><br><span class="line">            yw += w;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; w; x++) &#123;</span><br><span class="line">            rinsum = ginsum = binsum = routsum = goutsum = boutsum = rsum = gsum = bsum = <span class="number">0</span>;</span><br><span class="line">            yp = -radius * w;</span><br><span class="line">            <span class="keyword">for</span> (i = -radius; i &lt;= radius; i++) &#123;</span><br><span class="line">                yi = Math.max(<span class="number">0</span>, yp) + x;</span><br><span class="line"></span><br><span class="line">                sir = stack[i + radius];</span><br><span class="line"></span><br><span class="line">                sir[<span class="number">0</span>] = r[yi];</span><br><span class="line">                sir[<span class="number">1</span>] = g[yi];</span><br><span class="line">                sir[<span class="number">2</span>] = b[yi];</span><br><span class="line"></span><br><span class="line">                rbs = r1 - Math.abs(i);</span><br><span class="line"></span><br><span class="line">                rsum += r[yi] * rbs;</span><br><span class="line">                gsum += g[yi] * rbs;</span><br><span class="line">                bsum += b[yi] * rbs;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (i &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    rinsum += sir[<span class="number">0</span>];</span><br><span class="line">                    ginsum += sir[<span class="number">1</span>];</span><br><span class="line">                    binsum += sir[<span class="number">2</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    routsum += sir[<span class="number">0</span>];</span><br><span class="line">                    goutsum += sir[<span class="number">1</span>];</span><br><span class="line">                    boutsum += sir[<span class="number">2</span>];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (i &lt; hm) &#123;</span><br><span class="line">                    yp += w;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            yi = x;</span><br><span class="line">            stackpointer = radius;</span><br><span class="line">            <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; h; y++) &#123;</span><br><span class="line">                <span class="comment">// Preserve alpha channel: ( 0xff000000 &amp; pix[yi] )</span></span><br><span class="line">                pix[yi] = (<span class="number">0xff000000</span> &amp; pix[yi]) | (dv[rsum] &lt;&lt; <span class="number">16</span>) | (dv[gsum] &lt;&lt; <span class="number">8</span>) | dv[bsum];</span><br><span class="line"></span><br><span class="line">                rsum -= routsum;</span><br><span class="line">                gsum -= goutsum;</span><br><span class="line">                bsum -= boutsum;</span><br><span class="line"></span><br><span class="line">                stackstart = stackpointer - radius + div;</span><br><span class="line">                sir = stack[stackstart % div];</span><br><span class="line"></span><br><span class="line">                routsum -= sir[<span class="number">0</span>];</span><br><span class="line">                goutsum -= sir[<span class="number">1</span>];</span><br><span class="line">                boutsum -= sir[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (x == <span class="number">0</span>) &#123;</span><br><span class="line">                    vmin[y] = Math.min(y + r1, hm) * w;</span><br><span class="line">                &#125;</span><br><span class="line">                p = x + vmin[y];</span><br><span class="line"></span><br><span class="line">                sir[<span class="number">0</span>] = r[p];</span><br><span class="line">                sir[<span class="number">1</span>] = g[p];</span><br><span class="line">                sir[<span class="number">2</span>] = b[p];</span><br><span class="line"></span><br><span class="line">                rinsum += sir[<span class="number">0</span>];</span><br><span class="line">                ginsum += sir[<span class="number">1</span>];</span><br><span class="line">                binsum += sir[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">                rsum += rinsum;</span><br><span class="line">                gsum += ginsum;</span><br><span class="line">                bsum += binsum;</span><br><span class="line"></span><br><span class="line">                stackpointer = (stackpointer + <span class="number">1</span>) % div;</span><br><span class="line">                sir = stack[stackpointer];</span><br><span class="line"></span><br><span class="line">                routsum += sir[<span class="number">0</span>];</span><br><span class="line">                goutsum += sir[<span class="number">1</span>];</span><br><span class="line">                boutsum += sir[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">                rinsum -= sir[<span class="number">0</span>];</span><br><span class="line">                ginsum -= sir[<span class="number">1</span>];</span><br><span class="line">                binsum -= sir[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">                yi += w;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        bitmap.setPixels(pix, <span class="number">0</span>, w, <span class="number">0</span>, <span class="number">0</span>, w, h);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (bitmap);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>来看看我们的Layout：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;</span><br><span class="line">&lt;LinearLayout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    android:id=<span class="string">"@+id/activity_main"</span></span><br><span class="line">    android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">    android:orientation=<span class="string">"vertical"</span></span><br><span class="line">    android:layout_height=<span class="string">"match_parent"</span></span><br><span class="line">    &gt;</span><br><span class="line"></span><br><span class="line">    &lt;ImageView</span><br><span class="line">        android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">        android:layout_weight=<span class="string">"1"</span></span><br><span class="line">        android:src=<span class="string">"@mipmap/index"</span></span><br><span class="line">        android:layout_margin=<span class="string">"20dip"</span></span><br><span class="line">        android:layout_height=<span class="string">"0dip"</span></span><br><span class="line">        /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;ImageView</span><br><span class="line">        android:id=<span class="string">"@+id/iv_content"</span></span><br><span class="line">        android:layout_margin=<span class="string">"20dip"</span></span><br><span class="line">        android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">        android:layout_weight=<span class="string">"1"</span></span><br><span class="line">        android:layout_height=<span class="string">"0dip"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure>
<p>和以前一样，上面的为原始图，下面的为模糊图</p>
<p>activity：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        initView();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 初始化View */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ImageView mImage = (ImageView) findViewById(R.id.iv_content);</span><br><span class="line">        Bitmap bitmap = BitmapFactory.decodeResource(getResources(), R.mipmap.index).</span><br><span class="line">                                                       copy(Bitmap.Config.ARGB_4444, <span class="keyword">true</span>);</span><br><span class="line">        mImage.setImageBitmap(getBitmapBlur(bitmap, <span class="number">10</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 对Bitmap进行处理 */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Bitmap <span class="title">initBitmap</span><span class="params">(Bitmap bitmap, <span class="keyword">boolean</span> isup)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> width;</span><br><span class="line">        <span class="keyword">int</span> height;</span><br><span class="line">        <span class="keyword">if</span>(isup)&#123;</span><br><span class="line">            width = bitmap.getWidth() * <span class="number">6</span>;</span><br><span class="line">            height = bitmap.getHeight() * <span class="number">6</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            width = bitmap.getWidth() / <span class="number">6</span>;</span><br><span class="line">            height = bitmap.getHeight() / <span class="number">6</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  Bitmap.createScaledBitmap(bitmap, width, height, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 初始化Bitmap */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Bitmap <span class="title">getBitmapBlur</span><span class="params">(Bitmap bitmap, <span class="keyword">int</span> level)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(level &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            Bitmap bitmap1 = FastBlurUtil.doBlur(initBitmap(bitmap, <span class="keyword">false</span>), level, <span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">return</span> initBitmap(bitmap1, <span class="keyword">true</span>) ;</span><br><span class="line">        &#125;</span><br><span class="line">       <span class="keyword">return</span> initBitmap(bitmap, <span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>
<p>效果就是上述，关于内存的东西，后面会提到，</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/05/android-UI-drawing-bitmap-01/" data-id="ck2opn4kr00340mewgh39n90b" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/绘图技巧/">绘图技巧</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android-UI-drawing-drawable-02" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/04/android-UI-drawing-drawable-02/" class="article-date">
  <time datetime="2017-08-04T04:34:35.000Z" itemprop="datePublished">2017-08-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/04/android-UI-drawing-drawable-02/">Drawable的进阶用法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1、前言"><a href="#1、前言" class="headerlink" title="1、前言"></a>1、前言</h3><p>在前一篇博客当中提到关于Drawable的一些常用的用法，和使用系统自身的提供Drawable子类，来实现一定的具有功能性的Drawable，那么在今天的博客当中，我们就去自己定义Drawable的子类去实现我们自己功能的Drawable，</p>
<h3 id="2、正文"><a href="#2、正文" class="headerlink" title="2、正文"></a>2、正文</h3><p>首先我们去自己考虑一下，自定义Drawable是什么，先不着急，我们思考一下Android系统为我们提供的Drawable的子类实现，我们明确是对我们原有的图片进行一定的封装，然后进行一定的处理，让它和原来的最根本的res资源Drawable有某一种小功能，比如我们的ClipDrawable，ScaleDrawable，RotateDrawable，第一个是对原有的res资源Drawable有裁剪的功能，第二ScaleDrawable，是对原有的的res下的根本Drawable有一定的缩放功能，而第三个RotateDrawable就是对原来最原始的Drawable有一定的旋转功能。我们自定义Drawable首先我们要明确我们自定义的Drawable去实现什么功能，在这里我们去实现一个百叶窗的动画效果，百叶窗效果：为了和原图作比较，我们把原图和百叶窗的效果一起展示出来，</p>
<p><img src="/2017/08/04/android-UI-drawing-drawable-02/01.gif" alt="百叶窗效果"></p>
<p>首先来看我们的自定义Drawable，我们起名为ShuttersDrawable</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Canvas;</span><br><span class="line"><span class="keyword">import</span> android.graphics.ColorFilter;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Paint;</span><br><span class="line"><span class="keyword">import</span> android.graphics.PixelFormat;</span><br><span class="line"><span class="keyword">import</span> android.graphics.drawable.Drawable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义百叶窗的Drawable对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liusuansuan</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//TODO(suansuan)：由于创建Bitmap的时候，我们的宽度不能是0，</span></span><br><span class="line"><span class="comment">//TODO(suansuan): 所以在做动画的时候我们不能通过ValueAnimator从0开始</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShuttersDrawable</span> <span class="keyword">extends</span> <span class="title">Drawable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 在这里定义一下我们所要 */</span></span><br><span class="line">    <span class="keyword">private</span> Bitmap mBitmap;		<span class="comment">//原图的Bitmap的对象</span></span><br><span class="line">    <span class="keyword">private</span> Bitmap[] mBitmaps;	<span class="comment">//对原图进行分割以后百叶窗，叶片的Bitmap对象数组</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mWidth;		    <span class="comment">//原图的宽度。</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mHeight;		<span class="comment">//原图的高度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCellWidth;		<span class="comment">//单个叶片的宽度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCount;		    <span class="comment">//叶片总数</span></span><br><span class="line">    <span class="keyword">private</span> Paint mPaint;		<span class="comment">//画笔</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> scale = <span class="number">1f</span>;	<span class="comment">//比例，当前绘制的比例，主要通过该属性去控制整个百叶窗动画</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 初始化操作 */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ShuttersDrawable</span><span class="params">(Bitmap bitmap, <span class="keyword">int</span> count)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mBitmap = bitmap;</span><br><span class="line">        <span class="keyword">this</span>.mPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        <span class="keyword">this</span>.mCount = count;</span><br><span class="line">        initBitmap();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 初始化Bitmap */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initBitmap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mHeight = mBitmap.getHeight();</span><br><span class="line">        <span class="keyword">this</span>.mWidth = mBitmap.getWidth();</span><br><span class="line">        mCellWidth = mWidth / mCount;</span><br><span class="line">        mBitmaps = <span class="keyword">new</span> Bitmap[mCount];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 绘制方法 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">        canvas.save();</span><br><span class="line">        <span class="keyword">float</span> width = (mCellWidth * scale) + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(width &gt;= mCellWidth)&#123;</span><br><span class="line">            width = mCellWidth;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; mBitmaps.length; i++)&#123;</span><br><span class="line">            mBitmaps[i] = Bitmap.createBitmap(mBitmap, i * mCellWidth, <span class="number">0</span>,(<span class="keyword">int</span>)width, mHeight);</span><br><span class="line">            canvas.drawBitmap(mBitmaps[i], i * mCellWidth, <span class="number">0</span>, mPaint);</span><br><span class="line">        &#125;</span><br><span class="line">        canvas.restore();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 设置比例 */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setScale</span><span class="params">(<span class="keyword">float</span> mScale)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.scale = mScale;</span><br><span class="line">        invalidateSelf();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 主要是给以后使用到该Drawable，可以得到该Drawable的宽度 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIntrinsicWidth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mBitmap.getWidth();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 主要是给以后使用到该Drawable，可以得到该Drawable的高度 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIntrinsicHeight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mBitmap.getHeight();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOpacity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> PixelFormat.TRANSLUCENT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAlpha</span><span class="params">(<span class="keyword">int</span> alpha)</span> </span>&#123;</span><br><span class="line">        mPaint.setAlpha(alpha);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setColorFilter</span><span class="params">(ColorFilter cf)</span> </span>&#123;</span><br><span class="line">        mPaint.setColorFilter(cf);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>自定义Drawable我们首先需要继承Drawable，有几个方法我们是必须所要实现的那就是</p>
<ul>
<li>1、draw(Canvas canvas)：就是使用参数Canvas画布对象，给该Drawable画上内容的方法。</li>
<li>getOpacity()：</li>
<li>setAlpha(int alpha)：设置透明度</li>
<li>setColorFilter(ColorFilter cf):设置颜色过滤。</li>
</ul>
<p>其余我写的都比较简单，大家应该都能看懂是什么意思，我也就不献丑了。说一下具体的思路。就是我们把Bitmap分成一个个的叶片对象，然后对叶片对象进行绘制，然后通过sclae比例去控制绘制叶片的宽度，</p>
<p>activity_main.xml layout：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:gravity</span>=<span class="string">"center_horizontal"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">     <span class="comment">&lt;!-- 用来放至原来的Drawable对象 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"0dip"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"#F00"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">"@drawable/pressed"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 用来放至现在的ShuttersDrawable对象的载体  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/iv_imageView"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"#0F0"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"0dip"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:text</span>=<span class="string">"click me start Animator"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">android:onClick</span>=<span class="string">"click"</span>/&gt;</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用Button来控制开启动画，<br>再来我们就看看在Activity中的实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> suansuan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">private</span> ShuttersDrawable mShuttersDrawable;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        initImageView();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	  <span class="comment">/** 初始化ImageView */</span></span><br><span class="line">	  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initImageView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		  ImageView iv = (ImageView) findViewById(R.id.iv_imageView);</span><br><span class="line">	      Bitmap decodeResource = BitmapFactory.decodeResource(getResources(), </span><br><span class="line">                                                                      R.drawable.pressed);</span><br><span class="line">	      mShuttersDrawable = <span class="keyword">new</span> ShuttersDrawable(decodeResource, <span class="number">5</span>);</span><br><span class="line">	      iv.setImageDrawable(mShuttersDrawable);</span><br><span class="line">	  &#125;</span><br><span class="line"></span><br><span class="line">	  <span class="comment">/** Button的点击事件 */</span></span><br><span class="line">	  <span class="meta">@SuppressLint</span>(<span class="string">"NewApi"</span>)</span><br><span class="line">	  <span class="comment">//TODO(suansuan):在这里，博主建议大家还是使用V7包下面的Animator，</span></span><br><span class="line">          <span class="comment">//TODO(suansuan):博主是因为个人原因没用使用，为了更好的适配，大家请不要这样</span></span><br><span class="line">	  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">click</span><span class="params">(View view)</span></span>&#123;</span><br><span class="line">	     ValueAnimator mValueAnimation = ValueAnimator.ofFloat(<span class="number">0f</span>, <span class="number">1f</span>).</span><br><span class="line">                                                                         setDuration(<span class="number">10000</span>);</span><br><span class="line">	     mValueAnimation.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;  </span><br><span class="line">	           <span class="meta">@SuppressLint</span>(<span class="string">"NewApi"</span>) <span class="meta">@Override</span>  </span><br><span class="line">	           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;  </span><br><span class="line">	               <span class="keyword">float</span> animatedValue = (Float) animation.getAnimatedValue();  </span><br><span class="line">	               mShuttersDrawable.setScale(animatedValue);  </span><br><span class="line">	           &#125;  </span><br><span class="line">	       &#125;); </span><br><span class="line">	       mValueAnimation.start();</span><br><span class="line">	  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果呢就如开头那样所示。</p>
<p>上述就是如何通过自定义Drawable去实现百叶窗的效果，</p>
<h3 id="2、通过自定义View去实现一些关于画图"><a href="#2、通过自定义View去实现一些关于画图" class="headerlink" title="2、通过自定义View去实现一些关于画图"></a>2、通过自定义View去实现一些关于画图</h3><p>接下来我们去探讨第二个问题，我们以前会去通过自定义View去实现一些关于画图的东西其实都可以通过自定义Drawable去实现，比如鸿洋大神可以通过自定义Drawable去实现圆角图片一样，这个时候我们想到的也许就是去自定义Imageview去实现，大家应该发现了，自定义Drawable就可以看做是自定义View的一种轻量级实现，下面我们看看一种效果，然后我们去自定义这种效果，这种效果叫什么呢，我也不知，总之我们看吧！</p>
<p><img src="/2017/08/04/android-UI-drawing-drawable-02/02.png" alt="专辑盒子"></p>
<p>这种类似于专辑盒的Icon，在各大音乐平台多的是，相信大家也都做过，我们可以类似于这样的专辑盒去做一个自定义Drawable，好了废话少说，我们开始干活。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> vadsdk.testdrawable.drawable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.annotation.SuppressLint;</span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Canvas;</span><br><span class="line"><span class="keyword">import</span> android.graphics.ColorFilter;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Matrix;</span><br><span class="line"><span class="keyword">import</span> android.graphics.Paint;</span><br><span class="line"><span class="keyword">import</span> android.graphics.PixelFormat;</span><br><span class="line"><span class="keyword">import</span> android.graphics.drawable.Drawable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> vadsdk.testdrawable.R;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AlbumDrawable</span> <span class="keyword">extends</span> <span class="title">Drawable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 画笔对象 */</span></span><br><span class="line">	<span class="keyword">private</span> Paint mPaint;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 右侧图片对象 */</span></span><br><span class="line">	<span class="keyword">private</span> Bitmap mLeftDrawable;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 背景阴影图片 */</span></span><br><span class="line">	<span class="keyword">private</span> Bitmap mBackgoundDrawable;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 内容图片 */</span></span><br><span class="line">	<span class="keyword">private</span> Bitmap mContentBitmap;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 上下文环境 */</span></span><br><span class="line">	<span class="keyword">private</span> Context mContext;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 构造方法 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">AlbumDrawable</span><span class="params">(Bitmap bitmap, Context context)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.mContentBitmap = bitmap;</span><br><span class="line">		<span class="keyword">this</span>.mContext = context;</span><br><span class="line">		init();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 初始化操作 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		mPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">		mLeftDrawable = BitmapFactory.decodeResource(mContext.getResources(), R.drawable.album_chart_left);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">		onDrawLeftDrawable(canvas);</span><br><span class="line">		onDrawLeftBitmap(canvas);</span><br><span class="line">		onDrawDrawable(canvas);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 绘制小图片 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onDrawLeftDrawable</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">		canvas.save();</span><br><span class="line">		canvas.translate(mLeftDrawable.getWidth()/<span class="number">2f</span>, mLeftDrawable.getWidth() * <span class="number">3f</span>/<span class="number">5f</span>);</span><br><span class="line">		Bitmap zoomBitmap = zoomBitmap(mContentBitmap, <span class="number">1</span>/<span class="number">6f</span>);</span><br><span class="line">		canvas.drawBitmap(zoomBitmap, <span class="number">0</span>, <span class="number">0</span>, mPaint);</span><br><span class="line">		canvas.restore();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 绘制海报Drawable */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onDrawDrawable</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">		canvas.save();</span><br><span class="line">		canvas.translate(mLeftDrawable.getWidth(), <span class="number">0</span>);</span><br><span class="line">		Bitmap zoomBitmap = zoomBitmap(mContentBitmap , mLeftDrawable.getHeight()-<span class="number">3</span>);</span><br><span class="line">		canvas.drawBitmap(zoomBitmap, <span class="number">0</span>, <span class="number">0</span>, mPaint);</span><br><span class="line">		canvas.restore();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 绘制左侧的图片 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onDrawLeftBitmap</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">		canvas.save();</span><br><span class="line">		canvas.drawBitmap(mLeftDrawable, <span class="number">0</span>, <span class="number">0</span>, mPaint);</span><br><span class="line">		canvas.restore();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 按照比例获取Bitmap */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Bitmap <span class="title">zoomBitmap</span><span class="params">(Bitmap bitmap, <span class="keyword">int</span> h)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> width = bitmap.getWidth();</span><br><span class="line">		<span class="keyword">int</span> height = bitmap.getHeight();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">float</span> scaleHeight = ((<span class="keyword">float</span>)h)/height;</span><br><span class="line"></span><br><span class="line">		Matrix matrix = <span class="keyword">new</span> Matrix();    <span class="comment">// 计算缩放比例</span></span><br><span class="line">		matrix.postScale(scaleHeight, scaleHeight);</span><br><span class="line">		<span class="keyword">return</span> Bitmap.createBitmap(bitmap, <span class="number">0</span>, <span class="number">0</span>, width, height, matrix, <span class="keyword">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 按照比例获取Bitmap */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Bitmap <span class="title">zoomBitmap</span><span class="params">(Bitmap bitmap, <span class="keyword">float</span> scale)</span></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> width = bitmap.getWidth();</span><br><span class="line">		<span class="keyword">int</span> height = bitmap.getHeight();</span><br><span class="line">		Matrix matrix = <span class="keyword">new</span> Matrix();    <span class="comment">// 计算缩放比例</span></span><br><span class="line">		matrix.postScale(scale, scale);</span><br><span class="line">		<span class="keyword">return</span> Bitmap.createBitmap(bitmap, <span class="number">0</span>, <span class="number">0</span>, width, height, matrix, <span class="keyword">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOpacity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> PixelFormat.TRANSLUCENT;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAlpha</span><span class="params">(<span class="keyword">int</span> alpha)</span> </span>&#123;</span><br><span class="line">		mPaint.setAlpha(alpha);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setColorFilter</span><span class="params">(ColorFilter cf)</span> </span>&#123;</span><br><span class="line">		mPaint.setColorFilter(cf);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们现在自己定义了一个Drawable，我说一下思路，大体的思路就是对Bitmap做一定的操作，然后根据宽高去摆放，使用Bitmap去缩放小的海报，然后使用左侧的图片去盖住右侧的图片，主要就是计算方面，博主写的计算方法也有偏差，可以自己明确计算规则写自己的逻辑。</p>
<p>下来在我们的Activity当中使用我们定义的Drawable</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ImageView iv;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        iv = (ImageView) findViewById(R.id.iv_imageView);</span><br><span class="line">        Bitmap bitmap = BitmapFactory.decodeResource(getResources(), R.drawable.album);</span><br><span class="line">        AlbumDrawable albumDrawable = <span class="keyword">new</span> AlbumDrawable(bitmap, <span class="keyword">this</span>);</span><br><span class="line">        iv.setImageDrawable(albumDrawable);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="/2017/08/04/android-UI-drawing-drawable-02/03.png" alt="专辑盒子"></p>
<p>以上就是自定义Drawable</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/04/android-UI-drawing-drawable-02/" data-id="ck2opn4jq00200mewj8m06mt5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/绘图技巧/">绘图技巧</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android-UI-drawing-drawable-01" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/01/android-UI-drawing-drawable-01/" class="article-date">
  <time datetime="2017-08-01T04:34:35.000Z" itemprop="datePublished">2017-08-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/01/android-UI-drawing-drawable-01/">Drawable的基础用法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1、前言"><a href="#1、前言" class="headerlink" title="1、前言"></a>1、前言</h2><p>今天来跟大家聊一聊关于Android当中的绘图技巧，绘图技巧，不管是自定义控件，还是在我们去做自定义商业动画，都会常常的使用到，所以在这里和大家聊一聊关于绘图技巧的问题，如果那里有错误，希望各位大神指出。</p>
<h2 id="2、正文"><a href="#2、正文" class="headerlink" title="2、正文"></a>2、正文</h2><p>我们知道绘图的话，关于画布，画笔，这些Goolge提供的类有很大的关联，但是我们今天着重不是这些，而是从我们要给什么地方画图，这个是今天的重点，至于画图的细节我们以后会说的。</p>
<p>Android系统当中把我们所有的关于可以绘制的对象抽象出来，叫做Drawable对象，相信这个对象大家一定都不会陌生，在我们的实际开发当中我们基本天天都能遇到，今天就和大家聊一聊关于Drawable的各种用法。</p>
<p>我们想一想在我们的实际开发当中我们是怎么样去运用我们的Drawable的，我们会在res/drawable这个资源文件下面定义各种各样的Xml的文件，我们的Xml有不同的节点，其实我们这里的一个Xml的节点，就对应我们的Drawable的实现类，也就是说我们我们创建出来的Xml的文件，会被SDK自动的根据你的节点去创建相应的一个Drawable实现来，从而去实现我们所要的效果，在这里我们可以去类比一下我们的View，我们View当中的控件貌似也是这么定义的，在Xml当中去设定我们View控件所要的属性。但是我们的View可以在代码当中New出来，我们在这里试想一下，我们的Drawable也是可以在代码当中去new出来的，然后通过代码去给他去添加属性，答案是可以的，但是我们又想了想，我们new一个View有用么，我们一般不是new一个Button，一个ImageVeiw的么，我们可以去new一个Drawable的实现类，然后通过Drawable去进行管理，就像我们可以去用我们的View，ViewGroup去管理我们的控件和布局。</p>
<p>那么我们来看看Drawable的哪些节点对应的哪些实现类呢！然后会给大家详细的去做介绍。为了让各位看的更加的清楚，相信大家就非常的清楚了</p>
<ul>
<li>selector : StateListDrawable</li>
<li>layer-list : LayerDrawable</li>
<li>transition : TransitionDrawable</li>
<li>color : ColorDrawable</li>
<li>shape : GradientDrawable</li>
<li>scale : ScaleDrawable</li>
<li>clip : ClipDrawable</li>
<li>rotate : RotateDrawable</li>
<li>animation-list : AnimationDrawable:</li>
<li>insert : InsetDrawable:</li>
<li>bitmap : BitmapDrawable</li>
<li>nine-patch : NinePatchDrawable:</li>
</ul>
<h3 id="1-selector-StateListDrawable"><a href="#1-selector-StateListDrawable" class="headerlink" title="1 selector StateListDrawable"></a>1 selector StateListDrawable</h3><p>这个叫做状态的选择器，首先我们需要明白一点，就是StateListDrawable里面维护了不止一个Drawable对象，就是一组Drawable对象。既然它叫做状态选择器，说白了就是可以去根据不同的状态去返回不同的Drawable对象，而这些状态是由系统去进行提供的，至于都有哪些状态，按下状态、选中状态、默认状态、禁用状态等等，如果想了解更加全面，请大家参考Google的API，我们的Button的背景一般都使用这个Drawable，还有就是TV的海报也是用它，基本我们去和用户做交互的控件的背景都会使用到它</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- state_pressed：代表用户按下状态  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_pressed</span>=<span class="string">"true"</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/press"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 如果状态什么都不写，代表默认状态，就是什么都不触发的时候 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/normal"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 没有焦点时的背景图片 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;item android:state_window_focused="false" android:drawable="@drawable/pic1" /&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 非触摸模式下获得焦点并单击时的背景图片 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;item android:state_focused="true" android:state_pressed="true"   android:drawable= "@drawable/pic2" /&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 触摸模式下单击时的背景图片--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;item android:state_focused="false" android:state_pressed="true"   android:drawable="@drawable/pic3" /&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--选中时的图片背景--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;item android:state_selected="true"   android:drawable="@drawable/pic4" /&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--获得焦点时的图片背景--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;item android:state_focused="true"   android:drawable="@drawable/pic5" /&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--设置是否响应事件,指所有事件--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;item android:android:state_enabled="true"   android:drawable="@drawable/pic5" /&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在我们的Layout当中只需要引入一下我们刚刚用Xml定义的Drawable，就OK了</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:gravity</span>=<span class="string">"center"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"@drawable/selector_bg"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果图如下，当我点击的按下的时候会发生改变，当我抬起的时候会变为原来的，这只是一种状态，还有别的状态，笔者这里就不一一列举了</p>
<p><img src="/2017/08/01/android-UI-drawing-drawable-01/01.gif" alt="StateListDrawable"></p>
<h3 id="2、level-list-LevelListDrawable"><a href="#2、level-list-LevelListDrawable" class="headerlink" title="2、level-list LevelListDrawable"></a>2、level-list LevelListDrawable</h3><p>这个我的理解是自定义选择器，首先在LevelListDrawable里面和我们StateListDrawable一样，维护了一组的Drawable的对象，同时维护了每一个Drawable要显示的Level范围，不同的是上述是通过系统发出的状态去做出一个处理去显示我们的Drawable对象，而这个是自己定义一个范围去匹配响应的Drawable去显示。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">level-list</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/fm_vehicle_linking_1"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:maxLevel</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/fm_vehicle_linking_2"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:maxLevel</span>=<span class="string">"2"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/fm_vehicle_linking_3"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:maxLevel</span>=<span class="string">"3"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/fm_vehicle_linking_4"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:maxLevel</span>=<span class="string">"4"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/fm_vehicle_linking_5"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:maxLevel</span>=<span class="string">"5"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/fm_vehicle_linking_6"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:maxLevel</span>=<span class="string">"6"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/fm_vehicle_linking_7"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:maxLevel</span>=<span class="string">"7"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/fm_vehicle_linking_8"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:maxLevel</span>=<span class="string">"8"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/fm_vehicle_linking_9"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:maxLevel</span>=<span class="string">"9"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/fm_vehicle_linking_10"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:maxLevel</span>=<span class="string">"10"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/fm_vehicle_linking_11"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:maxLevel</span>=<span class="string">"11"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/fm_vehicle_linking_12"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:maxLevel</span>=<span class="string">"12"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/fm_vehicle_linking_13"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:maxLevel</span>=<span class="string">"13"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/fm_vehicle_linking_14"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:maxLevel</span>=<span class="string">"14"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">level-list</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们的Layout使用一个seekBar 和一个ImageView去展示我们的图片，相当于一个载体。没有什么难度，楼主在这里就不去贴图片了我们直接来看看我们的Activity的代码，在我们的seekBar上面增加一个监听器，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 初始化View */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ImageView image = (ImageView) findViewById(R.id.iv);</span><br><span class="line">    <span class="keyword">final</span> Drawable drawable = getResources().getDrawable(R.drawable.levellist);</span><br><span class="line">    SeekBar seekBar = (SeekBar) findViewById(R.id.seekBar);</span><br><span class="line">    seekBar.setMax(<span class="number">14</span>);</span><br><span class="line">    seekBar.setOnSeekBarChangeListener(<span class="keyword">new</span> SeekBar.OnSeekBarChangeListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onProgressChanged</span><span class="params">(SeekBar seekBar, <span class="keyword">int</span> progress, <span class="keyword">boolean</span> fromUser)</span> </span>&#123;</span><br><span class="line">            drawable.setLevel(progress);</span><br><span class="line">            image.setImageDrawable(drawable);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStartTrackingTouch</span><span class="params">(SeekBar seekBar)</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStopTrackingTouch</span><span class="params">(SeekBar seekBar)</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果呢！就是如下这样啦</p>
<p><img src="/2017/08/01/android-UI-drawing-drawable-01/02.gif" alt="LevelListDrawable"></p>
<h3 id="3、layer-list-LayerDrawable"><a href="#3、layer-list-LayerDrawable" class="headerlink" title="3、layer-list LayerDrawable"></a>3、layer-list LayerDrawable</h3><p>这个是图层的Drawable，它同样是维护了一组的Drawable，但是会根据我们在XML当中定义的顺序去给它做一个顺序显示，列表的最后一个drawable绘制在最上层。每一个Drawable处于一个不同的图层，也许会出现重叠，交叉的现象，但是不会首到另外Drawable的影响。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">layer-list</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/live_color_2"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- android:top - Integer。与top的距离，单位像素</span></span><br><span class="line"><span class="comment">         android:right - Integer。与right的距离，单位像素</span></span><br><span class="line"><span class="comment">         android:bottom - Integer。与bottom的距离，单位像素</span></span><br><span class="line"><span class="comment">         android:left - Integer。与left的距离，单位像素</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        在默认的情况下，所有的drawable item都会缩放到合适的大小来适应视图。</span></span><br><span class="line"><span class="comment">        因此,在一个layer-list中定义不同的位置可能会增加视图的尺寸和被自动缩放。</span></span><br><span class="line"><span class="comment">        为了避免被缩放，可以再&lt;item&gt;节点里加上&lt;bitmap&gt;元素来指定一个drawable，</span></span><br><span class="line"><span class="comment">        并且定义一些不会被拉伸的gravity属性，例如center。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        &lt;item&gt;</span></span><br><span class="line"><span class="comment">            &lt;bitmap android:src="@drawable/image"</span></span><br><span class="line"><span class="comment">                    android:gravity="center" /&gt;</span></span><br><span class="line"><span class="comment">        &lt;/item&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/live_color_3"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:top</span>=<span class="string">"30dip"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:left</span>=<span class="string">"30dip"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:right</span>=<span class="string">"30dip"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:bottom</span>=<span class="string">"30dip"</span></span></span><br><span class="line"><span class="tag">       /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/live_color_4"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:top</span>=<span class="string">"60dip"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:left</span>=<span class="string">"60dip"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:right</span>=<span class="string">"60dip"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:bottom</span>=<span class="string">"60dip"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们的Layout同第一个一样，直接去引用一下就OK</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/iv"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_centerInParent</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:src</span>=<span class="string">"@drawable/layerlist"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果呢，如下，但是请注意上述注释里面所说的情况</p>
<p><img src="/2017/08/01/android-UI-drawing-drawable-01/03.png" alt="LayerDrawable"></p>
<h3 id="4、transition-TransitionDrawable"><a href="#4、transition-TransitionDrawable" class="headerlink" title="4、transition TransitionDrawable"></a>4、transition TransitionDrawable</h3><p>这是一个LayerDrawable子类，那么它涉及到的也将会是图层的知识，但是他只涉及到了两个图层的变化，就是把上面和下面的图层进行交替显示，通过改变他们的透明度，为维护了一个平滑的透明度变化的动画效果，开启动画调用startTransition()。可以反向开启调用 reverseTransition()。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transition</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 一个青色的小圆 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/live_color_2"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 一个黄色的小圆 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/live_color_4"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Activity里面去设置一下这个Drawable，比如什么时候开启过度透明度动画，设置动画时长之类的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        ImageView image = (ImageView) findViewById(R.id.iv);</span><br><span class="line"></span><br><span class="line">        Resources res = getResources();</span><br><span class="line">        TransitionDrawable transition = (TransitionDrawable)res.getDrawable(R.drawable.transition);</span><br><span class="line"></span><br><span class="line">        image.setImageDrawable(transition);</span><br><span class="line">        transition.startTransition(<span class="number">2000</span>);</span><br><span class="line"><span class="comment">//      这个是反向开启动画</span></span><br><span class="line"><span class="comment">//      transition.reverseTransition(2000);</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="/2017/08/01/android-UI-drawing-drawable-01/04.gif" alt="TransitionDrawable"></p>
<h3 id="5、color-ColorDrawable"><a href="#5、color-ColorDrawable" class="headerlink" title="5、color ColorDrawable"></a>5、color ColorDrawable</h3><p>这个Drawable对象，描述的不像上面的，它描述一个单个Drawable，在其内部定义颜色属性，当要绘制的时候，会读取到里面的颜色值，把这个颜色设置给将要绘制的Paint对象上面，注意这个Drawable一旦绘制，就不好修改了。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">color</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:color</span>=<span class="string">"#FF0000"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>颜色是怎么归类的 6位 ARGB 这个楼主就默认大家都会了，也就不浪费时间了</p>
<h3 id="6、shape-GradientDrawable"><a href="#6、shape-GradientDrawable" class="headerlink" title="6、shape GradientDrawable"></a>6、shape GradientDrawable</h3><p>这个Drawable大家可以理解为上述ColorDrawable的加强版，在这个Drawable中维护了很多属性，好方便我们来使用，使用这个Drawable，我们可以实现是一个区域内的颜色渐变，其中主要分为线性渐变，发散渐变，平铺渐变，下面我们来研究一下，在它的内部定义了什么属性来达到我们实现炫酷的效果</p>
<ul>
<li>1、size：定义区域的大小</li>
<li>2、gradient：设置区域背景的渐变效果</li>
<li>3、solid：设置区域的背景颜色，如果设置了solid会覆盖gradient的效果</li>
<li>4、stroke：设置区域的边框效果</li>
<li>5、padding：设置区域的内边距，</li>
</ul>
<p>这个Drawable很常用，同时也很重要，所以楼主会详细一点</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        rectangle 长方形 /默认</span></span><br><span class="line"><span class="comment">        oval 椭圆</span></span><br><span class="line"><span class="comment">        line 线</span></span><br><span class="line"><span class="comment">        ring 环形</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:shape</span>=<span class="string">"rectangle"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 用来描述渐变的类型，线性渐变，发散渐变，平铺渐变，还有渐变开始颜色，渐变结束颜色 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        angle 是颜色变换的角度, 默认是0, 取值必须是45的 倍数. 0: 是颜色从左边到右边, 90: 是颜色从底部到顶部,</span></span><br><span class="line"><span class="comment">        startColor centerColor endColor 一起使用: 开始的颜色, 中间的颜色, 结束的颜色</span></span><br><span class="line"><span class="comment">        centerX centerY是指定位置坐标, 取值是0.0f ~ 1.0f 之间, 例如: android:centerX="0.5f"  表示X方向的中间位置</span></span><br><span class="line"><span class="comment">        gradientRadius 和android:type="radial"一起连用,</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        android:type:</span></span><br><span class="line"><span class="comment">                radial 平铺渐变, 例如: 从一个圆中心到圆的边缘变化</span></span><br><span class="line"><span class="comment">                sweep 发散渐变, 类似雷达扫描的那种图形</span></span><br><span class="line"><span class="comment">                linear 线性渐变, 就是颜色从左往右, 从下往上</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">gradient</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:startColor</span>=<span class="string">"#FF0000"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:centerColor</span>=<span class="string">"#00FF00"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:endColor</span>=<span class="string">"#0000FF"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:type</span>=<span class="string">"linear"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 用来定义显示区域的大小 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            这里一般不用设置, 它的优先级没有控件的优先级大,</span></span><br><span class="line"><span class="comment">            他指定控件的宽高就好, shape图形会随控件拉伸</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        &lt;size</span></span><br><span class="line"><span class="comment">        android:width="100dp"</span></span><br><span class="line"><span class="comment">        android:height="100dp"</span></span><br><span class="line"><span class="comment">        /&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 用来定义圆角 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        bottomLeftRadius 左下角</span></span><br><span class="line"><span class="comment">        bottomRightRadius 右下角</span></span><br><span class="line"><span class="comment">        topLeftRadius 左上角</span></span><br><span class="line"><span class="comment">        topRightRadius 右上角</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        radius 是四个角, 设置了这个就不需要设置上面的四个了, PS:它的优先级比较低, 会被其他参数覆盖</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">corners</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:bottomLeftRadius</span>=<span class="string">"10dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:bottomRightRadius</span>=<span class="string">"10dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:topLeftRadius</span>=<span class="string">"10dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:topRightRadius</span>=<span class="string">"10dp"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- padding标签: 这里的padding是控件中间内容与shape图形图片的距离 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">padding</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:bottom</span>=<span class="string">"5dip"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:left</span>=<span class="string">"5dip"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:right</span>=<span class="string">"5dip"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:top</span>=<span class="string">"15dip"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--solid标签: shape图形背景色, 这个和上面的gradient标签会互斥, 一个是设置背景色, 一个是设置渐变色, 上述也说过这个问题 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        &lt;solid</span></span><br><span class="line"><span class="comment">            android:color="@android:color/white"/&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 边框的颜色宽度的设置 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">         width 边框的宽度</span></span><br><span class="line"><span class="comment">         color 边框的颜色</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        边框的样式：</span></span><br><span class="line"><span class="comment">            dashGap 虚线中空格的长度</span></span><br><span class="line"><span class="comment">            dashWidth 虚线中实线的长度</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">stroke</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:width</span>=<span class="string">"5dip"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:color</span>=<span class="string">"#0000FF"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:dashGap</span>=<span class="string">"2dip"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:dashWidth</span>=<span class="string">"1dip"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="/2017/08/01/android-UI-drawing-drawable-01/05.png" alt="GradientDrawable"></p>
<h3 id="7、scale-ScaleDrawable"><a href="#7、scale-ScaleDrawable" class="headerlink" title="7、scale ScaleDrawable"></a>7、scale ScaleDrawable</h3><p>这个Drawable主要就是对原有的Drawable去进行一定百分比的缩放，我们可以选取不同的缩放中心对这个Drawable进行控制</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        drawable Drawable 资源。必须的。引用一个drawable资源。</span></span><br><span class="line"><span class="comment">        scaleHeight 缩放的高度，以百分比的方式表示drawable的缩放。形式例如：100%，12.5%。</span></span><br><span class="line"><span class="comment">        scaleWidth 缩放的宽度，以百分比的方式表示drawable的缩放。形式例如：100%，12.5%。</span></span><br><span class="line"><span class="comment">        scaleGravity 指定缩放后的gravity的位置。必须是下面的一个或多个值（多个值之间用”|”分隔）</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">scale</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:drawable</span>=<span class="string">"@drawable/press"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:scaleGravity</span>=<span class="string">"center_vertical|center_horizontal"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:scaleHeight</span>=<span class="string">"50%"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:scaleWidth</span>=<span class="string">"50%"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>准备好以后，我们来运行一下，但是我们发现并没有显示图片，查看ScaleDrawable的源码，发现draw()方法有判断getLevel() != 0才绘制。而我们在没有setLevel()时，默认getLevel()都是0。<br>那我们先设置10000吧，我们再次运行，发现没有按照我们50%的比例进行缩放，然后我们去看官方文档</p>
<ul>
<li>A Drawable that changes the size of another Drawable based on its current level value，</li>
</ul>
<p>我们发现ScaleDrawable的缩放，并不是自动的建立在原有Drawable尺寸的基础上的。而是，需要给原有的Drawable指定一个Level，然后ScaleDrawable是在这个Level的基础上进行缩放的！<br>注意：设置的值是缩小的比例。也就是说，设置0.5，意为缩小50%！！而不是原始大小的50%<br>那么我们在我们的Activity里面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">    ScaleDrawable drawable = (ScaleDrawable) getResources().getDrawable(R.drawable.scale);</span><br><span class="line"></span><br><span class="line">    ImageView image = (ImageView) findViewById(R.id.iv);</span><br><span class="line">    image.setImageDrawable(drawable);</span><br><span class="line">    <span class="comment">//在这个地方设置Level</span></span><br><span class="line">   image.setImageLevel(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">    ScaleDrawable drawable = (ScaleDrawable) getResources().getDrawable(R.drawable.scale);</span><br><span class="line"></span><br><span class="line">    ImageView image = (ImageView) findViewById(R.id.iv);</span><br><span class="line">    image.setImageDrawable(drawable);</span><br><span class="line">    <span class="comment">//在这个地方设置Level</span></span><br><span class="line">   image.setImageLevel(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果呢  如下：</p>
<p><img src="/2017/08/01/android-UI-drawing-drawable-01/06.gif" alt="ScaleDrawable"></p>
<h3 id="8、clip-ClipDrawable"><a href="#8、clip-ClipDrawable" class="headerlink" title="8、clip ClipDrawable"></a>8、clip ClipDrawable</h3><p>这个Drawable主要就是对原有的Drawable进行一个裁剪，我们会有gravity选择在父容器的对齐方式，然后通过Drawable提供的level去设置我们去裁剪的大小，裁剪是从0到10000，0代表完全不显示，10000代表完全显示。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    drawable:所需要的Drawable资源</span></span><br><span class="line"><span class="comment">    clipOrientation：裁剪的方向，垂直，水平</span></span><br><span class="line"><span class="comment">    gravity：对齐方式</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">clip</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:drawable</span>=<span class="string">"@drawable/press"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:clipOrientation</span>=<span class="string">"horizontal"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:gravity</span>=<span class="string">"center"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>定义出了我们自已要的Drawable，然后在我们的Activity进行应用就OK了</p>
<p>下面看Activity的代码实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">    initView();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 初始化View */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ImageView image = (ImageView) findViewById(R.id.iv);</span><br><span class="line">    <span class="keyword">final</span>  ClipDrawable drawable = (ClipDrawable) getResources().getDrawable(R.drawable.clip);</span><br><span class="line">    SeekBar seekBar = (SeekBar) findViewById(R.id.seekBar);</span><br><span class="line">    seekBar.setMax(<span class="number">10000</span>);</span><br><span class="line">    seekBar.setOnSeekBarChangeListener(<span class="keyword">new</span> SeekBar.OnSeekBarChangeListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onProgressChanged</span><span class="params">(SeekBar seekBar, <span class="keyword">int</span> progress, <span class="keyword">boolean</span> fromUser)</span> </span>&#123;</span><br><span class="line">            drawable.setLevel(progress);</span><br><span class="line">            image.setImageDrawable(drawable);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStartTrackingTouch</span><span class="params">(SeekBar seekBar)</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStopTrackingTouch</span><span class="params">(SeekBar seekBar)</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面贴出效果图</p>
<p><img src="/2017/08/01/android-UI-drawing-drawable-01/07.gif" alt="ClipDrawable"></p>
<h3 id="9、rotate-RotateDrawable"><a href="#9、rotate-RotateDrawable" class="headerlink" title="9、rotate RotateDrawable"></a>9、rotate RotateDrawable</h3><p>这个Drawable主要就是对原有的Drawable进行一定角度的旋转，基于当前的level，进行旋转的drawable。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="comment">&lt;!--drawable: Drawable 资源。必须的。引用一个drawable资源。</span></span><br><span class="line"><span class="comment">    visible:Boolean。是否可见。</span></span><br><span class="line"><span class="comment">    fromDegrees:整形。  从多少的角度开始旋转</span></span><br><span class="line"><span class="comment">    toDegrees:整形。  到多少的角度结束旋转</span></span><br><span class="line"><span class="comment">    pivotX:百分比。  旋转的中心在图片X轴的百分比</span></span><br><span class="line"><span class="comment">    pivotY:百分比。  旋转的中心在图片Y轴的百分比--&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">rotate</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:drawable</span>=<span class="string">"@drawable/press"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:visible</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:fromDegrees</span>=<span class="string">"0"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:toDegrees</span>=<span class="string">"360"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:pivotX</span>=<span class="string">"50%"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:pivotY</span>=<span class="string">"50%"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">rotate</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在这里我们对旋转度数做一个详细的介绍，</p>
<p>图片将从0到360进行旋转。level值为10000，也就是说level每加1000，即顺时针旋转360/10000*1000=36度。<br>可以根据显示看出来效果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">    initView();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 初始化View */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ImageView image = (ImageView) findViewById(R.id.iv);</span><br><span class="line">    <span class="keyword">final</span> RotateDrawable drawable = (RotateDrawable) getResources().getDrawable(R.drawable.rotate);</span><br><span class="line">    SeekBar seekBar = (SeekBar) findViewById(R.id.seekBar);</span><br><span class="line">    seekBar.setMax(<span class="number">10000</span>);</span><br><span class="line">    seekBar.setOnSeekBarChangeListener(<span class="keyword">new</span> SeekBar.OnSeekBarChangeListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onProgressChanged</span><span class="params">(SeekBar seekBar, <span class="keyword">int</span> progress, <span class="keyword">boolean</span> fromUser)</span> </span>&#123;</span><br><span class="line">            drawable.setLevel(progress);</span><br><span class="line">            image.setImageDrawable(drawable);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStartTrackingTouch</span><span class="params">(SeekBar seekBar)</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStopTrackingTouch</span><span class="params">(SeekBar seekBar)</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果呢，如下：</p>
<p><img src="/2017/08/01/android-UI-drawing-drawable-01/08.gif" alt="RotateDrawable"></p>
<h3 id="10、animation-list-AnimationDrawable"><a href="#10、animation-list-AnimationDrawable" class="headerlink" title="10、animation-list AnimationDrawable"></a>10、animation-list AnimationDrawable</h3><p>这个Drawable里面维护了一组Drawable，通过一定的顺序，一定的显示时长去做一个Drawable的逐个显示，那么这么就会形成一个动画，也就是说每一个Drawable就是这个动画当中的一个帧，你可以通过oneshot属性来控制该动画播放完毕以后是否重新播放，主动调用AnimationDrawable的start播放动画，关于AnimationDrawable这个动画大家可以去看一下我的关于动画专题的博客。</p>
<h3 id="11、inset-InsetDrawable"><a href="#11、inset-InsetDrawable" class="headerlink" title="11、inset InsetDrawable"></a>11、inset InsetDrawable</h3><p>这个Drawable主要是说可以把一个Drawable插入到另外一个Drawable的内部，并且在内部留一些间距</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        drawable: Drawable 资源。必须的。引用一个drawable资源。</span></span><br><span class="line"><span class="comment">        insetBottom:整形。  底边距的大小</span></span><br><span class="line"><span class="comment">        insetLeft:整形。  左边距的大小</span></span><br><span class="line"><span class="comment">        insetRight:整形。 右边距的大小</span></span><br><span class="line"><span class="comment">        insetTop:整形。  上边距的大小</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">inset</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:drawable</span>=<span class="string">"@drawable/press"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:insetBottom</span>=<span class="string">"30dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:insetLeft</span>=<span class="string">"30dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:insetRight</span>=<span class="string">"30dp"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:insetTop</span>=<span class="string">"30dp"</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">inset</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>layout：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:clipChildren</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:gravity</span>=<span class="string">"center"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/iv"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_centerInParent</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"#aaa"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">"@drawable/insert"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果如下</p>
<p><img src="/2017/08/01/android-UI-drawing-drawable-01/09.png" alt="InsetDrawable"></p>
<h3 id="12、bitmap-BitmapDrawable"><a href="#12、bitmap-BitmapDrawable" class="headerlink" title="12、bitmap BitmapDrawable"></a>12、bitmap BitmapDrawable</h3><p>这个Drawable主要是对Bitmap的一种封装，可以设置它包装的bitmap在BitmapDrawable区域内的绘制方式，如平铺填充、拉伸填充或者保持图片原始大小，也可以在BitmapDrawable区域内部使用gravity指定的对齐方式。<br>BitmapDrawable就是封装了一个位图。以文件的方式，封装一个原始的位图。以Xml方式，可以对原始的位图进行一系列的处理，比如说抗锯齿，拉伸，对齐等等。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    src(Drawable) resource:必需。 引用一个drawableResource.</span></span><br><span class="line"><span class="comment">    antialias (Boolean): 是否开启抗锯齿。</span></span><br><span class="line"><span class="comment">    dither (Boolean): 如果位图与屏幕的像素配置不同时，是否允许抖动.（例如：一个位图的像素设置是 ARGB 8888，但屏幕的设置是RGB 565）</span></span><br><span class="line"><span class="comment">    filter (Boolean): 是否允许对位图进行滤波。对位图进行收缩或者延展使用滤波可以获得平滑的外观效果。</span></span><br><span class="line"><span class="comment">    gravity: 定义位图的重力（gravity），如果位图小于其容器，使用重力指明在何处绘制</span></span><br><span class="line"><span class="comment">    tileMode:</span></span><br><span class="line"><span class="comment">            "disabled" :默认值，什么也没有</span></span><br><span class="line"><span class="comment">            "clamp" :复制图片边缘的颜色来填充容器剩下的空白部分，比如引入的图片如果是白色的边缘，那么图片所在的容器里除了图片，剩下的空间都会被填充成白色</span></span><br><span class="line"><span class="comment">            "repeat" :平铺</span></span><br><span class="line"><span class="comment">            "mirror":镜面</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bitmap</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:alpha</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:antialias</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:dither</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:filter</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:gravity</span>=<span class="string">"clip_vertical"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:src</span>=<span class="string">"@drawable/press"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:tileMode</span>=<span class="string">"disabled"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br></pre></td></tr></table></figure>
<p>layout：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:clipChildren</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/iv"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"400dip"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"400dip"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">"@drawable/bitmap"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果：</p>
<p><img src="/2017/08/01/android-UI-drawing-drawable-01/10.png" alt="BitmapDrawable"></p>
<h3 id="13、nine-patch"><a href="#13、nine-patch" class="headerlink" title="13、nine-patch"></a>13、nine-patch</h3><p>NinePatchDrawable:这个就是我们知道的点九图片，也就是.9.png，会根据内容的大小对其内容进行拉伸，注意：但是不能压缩，这也就是我们看到的切图为什么一开始都会做得很小，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">nine-patch</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:src</span>=<span class="string">"@drawable/list_tag_clear"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:dither</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们要明白src对应的应该是一个.9图片,<br>dither 是否图像抖动处理，当每个颜色值以低于8位表示时，对应图像做抖动处理可以实现在可显示颜色总数比较低(比如256色)时还保持较好的显示效果。</p>
<p>layout:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:clipChildren</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"assssssssssssssssssssssssssssssssssssssssss"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"@drawable/nine"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意：有可能会出Error:java.lang.RuntimeException: Some file crunching failed, see logs for details</p>
<p>意思就是说</p>
<ul>
<li>1.构建Gradle的时候，Gradle会去检查一下是否修改过文件的后缀名；</li>
<li>2.一般大多数是出现在图片上，.jpg修改成了.png就会出现这个问题；</li>
<li>3.9patch图片也可能出现这个问题。</li>
</ul>
<p>很明显我们可能是第三种情况</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/01/android-UI-drawing-drawable-01/" data-id="ck2opn4ll003j0mewij28nhv4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/绘图技巧/">绘图技巧</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-dataType-adt-02" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/29/dataType-adt-02/" class="article-date">
  <time datetime="2017-07-29T04:34:35.000Z" itemprop="datePublished">2017-07-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/数据结构/">数据结构</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/29/dataType-adt-02/">数据结构表（ADT）解析(下)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1、前言"><a href="#1、前言" class="headerlink" title="1、前言"></a>1、前言</h2><p>这部分的内容是根据之前的ADT讲解所遗留下来的内容，如果有什么不太明确，可以看之前的博客。</p>
<h2 id="2、LinkedList的简单实现。"><a href="#2、LinkedList的简单实现。" class="headerlink" title="2、LinkedList的简单实现。"></a>2、LinkedList的简单实现。</h2><p>ArrayList底层是由数组实现的，而LinkedList底层是通过链表实现的，但是在Java当中是没有链表这种数据结构的。所以我们要通过自定义来进行。</p>
<h3 id="2-1、分析"><a href="#2-1、分析" class="headerlink" title="2.1、分析"></a>2.1、分析</h3><p>我们上述已经知道我们需要通过自定义底层节点，来实现双向链表，所以定义一个Node&lt; T &gt;是必须的，关于链我们直接通过Java当中的索引来做，我们还需要对当前双向链表进行简单的改造，通过标记节点来完成。还需要对该集合的操作进行定义，在这里提供出三个核心方法，其与的方法都是建立在这三个核心方法之上的。最后为了可以通过Iterable进行遍历，提供一个LinkedListIterator。我们可以把我们要完成的在下方总结一下：</p>
<ul>
<li>自定义Node&lt; T &gt;。</li>
<li>添加头节点和尾节点。</li>
<li>对外提供操作。</li>
<li>对外提供LinkedListIterator 好进行遍历。</li>
</ul>
<h3 id="2-2、节点和链"><a href="#2-2、节点和链" class="headerlink" title="2.2、节点和链"></a>2.2、节点和链</h3><p>我们知道一个节点，应该包含有三个部分，第一个部分应该是指上一个节点的索引，第二部分应该是该节点所含有的数据，第三部分应该是指向下一个节点的索引。</p>
<p><img src="/2017/07/29/dataType-adt-02/01.png" alt="note的内容"></p>
<p>具体实现如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 节点类，用来表示链表当中的一个节点。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> pengchengliu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;AnyType&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//TODO : 问题一：为什么选择是private。</span></span><br><span class="line"><span class="comment">//TODO : 问题二：为什么选择是static。</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">AnyType</span>&gt;</span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//TODO ：为什么内部属性选用public 。</span></span><br><span class="line">	<span class="keyword">public</span> AnyType data ;</span><br><span class="line">	<span class="keyword">public</span> Node&lt;AnyType&gt; prev ;</span><br><span class="line">	<span class="keyword">public</span> Node&lt;AnyType&gt; next ;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(AnyType data, Node&lt;AnyType&gt; prev, Node&lt;AnyType&gt; next)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.data = data ;</span><br><span class="line">		<span class="keyword">this</span>.prev = prev ;</span><br><span class="line">		<span class="keyword">this</span>.next = next ;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上述代码当中，笔者提到了三个问题。这这里简单的说一下。</p>
<p>第一个问题：为什么选择是private。</p>
<p>答案 ： 应该这个内部类没有必要暴露给外部，外部只要默默的使用该类就Ok，不需要知道内部实现细节，注意这里的外部是指使用LinkedList的外部的类，而不是LinkedList。</p>
<p>第二个问题：为什么选择是static。</p>
<p>答案：这里应该是静态内部类和内部类的区别。想深入理解一下的看客可以去输入了解一下。这里笔者简单的说一下，Node这个类是独立于LinkedList的，也就是Node这个类没有使用到LinkedList这个类的实例，并且Node不依赖于LinkedList实例被实例化。所以选择static了。</p>
<p>第三个问题：为什么内部属性选用public</p>
<p>答案：这个问题好回答，既然整个类都是private，内部是用public也就无所谓了。</p>
<h3 id="2-3、标记节点"><a href="#2-3、标记节点" class="headerlink" title="2.3、标记节点"></a>2.3、标记节点</h3><p>了解了上述Node类以后，这里特别说明一下有两个比较特殊的位置，就是第一个元素和最后一个元素，我们第一个元素的第一部分应该是null，而最后一个节点的第三部分应该是null，当我们检测到了最后一个节点的第三部分是null，则代表遍历结束，这是基本的链表结构，但是为了省去不必要的麻烦，我们使用标记节点。代替第一个元素和最后一个元素。为什么选择标记节点。</p>
<p><img src="/2017/07/29/dataType-adt-02/02.png" alt="标记节点"></p>
<p>需要注意的是由于第一个元素和最后一个元素都比较特殊，所以通过标记节点头节点和尾节点。</p>
<p>为什么使用标记节点呢？</p>
<p>如果我们不使用标记节点，我们会存在特殊情况，比如删除或者添加第一个元素，这样就会存在一种可能，那就是我们需要改变第一个元素的位置，而如果有标记节点的话，第一个元素的位置和最后一个元素的位置就是一定的，我们规避了这一种特殊情况。</p>
<h3 id="2-4、主要操作"><a href="#2-4、主要操作" class="headerlink" title="2.4、主要操作"></a>2.4、主要操作</h3><p>我们知道数据结构重要的地方有两点，第一个比较重要的地方就是集合内的元素，而第二个重要的地方就是操作。</p>
<h4 id="2-4-1、清空集合"><a href="#2-4-1、清空集合" class="headerlink" title="2.4.1、清空集合"></a>2.4.1、清空集合</h4><p>因为我们有标记节点，所以我们清空集合只需要，让头节点指向尾节点，尾节点指向头节点，然后让size为0即可。效果图如下所示</p>
<p><img src="/2017/07/29/dataType-adt-02/03.png" alt="head节点"></p>
<p>代码如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 清空当前的容器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	beginMarker = <span class="keyword">new</span> Node&lt;AnyType&gt;(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">	endMarker = <span class="keyword">new</span> Node&lt;AnyType&gt;(<span class="keyword">null</span>, beginMarker, <span class="keyword">null</span>);</span><br><span class="line">	beginMarker.next = endMarker ;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//	重置计数器。</span></span><br><span class="line">	theSize = <span class="number">0</span> ;</span><br><span class="line">	modCount++ ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-4-2、插入元素"><a href="#2-4-2、插入元素" class="headerlink" title="2.4.2、插入元素"></a>2.4.2、插入元素</h4><p>在固定的位置插入一个元素，也就是说，改变该位置上面前后节点的链即可，具体的步骤如下图所示：</p>
<p><img src="/2017/07/29/dataType-adt-02/04.png" alt="插入元素"></p>
<p>代码如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加一个元素，将元素item添加到node之前。此方法为其他方法的服务方法，所以不需要暴露给外部类调用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addBefore</span><span class="params">(Node&lt;AnyType&gt; node, AnyType item)</span></span>&#123;</span><br><span class="line">	Node&lt;AnyType&gt; itemNode = <span class="keyword">new</span> Node&lt;AnyType&gt;(item, node.prev, node);</span><br><span class="line">	itemNode.prev.next = itemNode ;</span><br><span class="line">	node.prev = itemNode ;</span><br><span class="line">	<span class="comment">//更新计数器。</span></span><br><span class="line">	theSize ++ ;</span><br><span class="line">	modCount ++ ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-4-3、移除元素"><a href="#2-4-3、移除元素" class="headerlink" title="2.4.3、移除元素"></a>2.4.3、移除元素</h4><p>这个操作方法和上述插入元素，没有什么区别，也是改变前后节点的链的问题。</p>
<p><img src="/2017/07/29/dataType-adt-02/05.png" alt="移除元素"></p>
<p>代码实现如下所示：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 移除一个元素，将oldNode在原有的集合当前删除。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> oldNode</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> AnyType <span class="title">remove</span><span class="params">(Node&lt;AnyType&gt; oldNode)</span></span>&#123;</span><br><span class="line">	oldNode.next.prev = oldNode.prev ;</span><br><span class="line">	oldNode.prev.next = oldNode.next ;</span><br><span class="line">	<span class="comment">//更新计数器</span></span><br><span class="line">	theSize-- ;</span><br><span class="line">	modCount++ ;</span><br><span class="line">	<span class="keyword">return</span> oldNode.data ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="2-4-4、得到节点"><a href="#2-4-4、得到节点" class="headerlink" title="2.4.4、得到节点"></a>2.4.4、得到节点</h4><p>通过下标得到相应的Node，具体的代码实现如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 得到一个元素，根据index下表值，得到一个元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> index 下表值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 得到的元素。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> Node&lt;AnyType&gt; <span class="title">getNode</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">	Node&lt;AnyType&gt; tempNode ;</span><br><span class="line">	<span class="comment">//下标合法性验证</span></span><br><span class="line">	<span class="keyword">if</span>(index &lt; <span class="number">0</span> || index &gt; <span class="keyword">this</span>.size())&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//由于是双向列表，所以根据index的值不同在两端获取。使得效率更加的高效，O(N/2)的时间复杂度。</span></span><br><span class="line">	<span class="keyword">if</span>(index &lt; <span class="keyword">this</span>.size() / <span class="number">2</span>)&#123;</span><br><span class="line">		<span class="comment">//从开头开始找,获取第一个元素</span></span><br><span class="line">		tempNode = beginMarker.next ;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i ++)&#123;</span><br><span class="line">			tempNode = tempNode.next ;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">//从结尾开始找,获取最后一个元素。</span></span><br><span class="line">		tempNode = endMarker.prev ;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="keyword">this</span>.size(); i &gt; index; i--)&#123;</span><br><span class="line">			tempNode = tempNode.prev ;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> tempNode ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-5、LinkedListIterator的实现。"><a href="#2-5、LinkedListIterator的实现。" class="headerlink" title="2.5、LinkedListIterator的实现。"></a>2.5、LinkedListIterator的实现。</h3><p>代码实现如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment">	 * LinkedList的迭代器。</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@author</span> pengchengliu</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedListIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">AnyType</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//当前的位置，默认指向第一个元素。</span></span><br><span class="line">		<span class="keyword">private</span> Node&lt;AnyType&gt; current = beginMarker.next ;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">int</span> expectedModCount = modCount ;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">boolean</span> okToRemove = <span class="keyword">false</span> ;</span><br><span class="line">		</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> current != endMarker;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> AnyType <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="comment">//TODO : 为什么需要做这么一步判断呢？</span></span><br><span class="line">			<span class="keyword">if</span>(modCount == expectedModCount)&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//TODO ：为什么需要这个判断</span></span><br><span class="line">			<span class="keyword">if</span>(!hasNext())&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException() ;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			AnyType data = current.data;</span><br><span class="line">			current = current.next ;</span><br><span class="line">			okToRemove = <span class="keyword">true</span> ;</span><br><span class="line">			<span class="keyword">return</span> data;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(modCount != expectedModCount)&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//TODO ：为什么需要这个判断</span></span><br><span class="line">			<span class="keyword">if</span>(!okToRemove)&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			MyLinkedList.<span class="keyword">this</span>.remove(current.prev);</span><br><span class="line">			okToRemove = <span class="keyword">false</span> ;</span><br><span class="line">			expectedModCount++ ;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>在上述代码当中笔者提出了三个问题，在这里笔者简单的说一下。</p>
<p>第一个问题：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(modCount == expectedModCount)&#123;</span><br><span class="line">             <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">         &#125;</span><br></pre></td></tr></table></figure>
<p>这个判断存在的必要。在遍历阶段，防止对表结构进行改变，</p>
<p>第二个问题：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!hasNext())&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException() ;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<p>也就是我们常说的越界吧。</p>
<p>第三个问题</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!okToRemove)&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<p>就是没有使用遍历就是调用remove方法。</p>
<h3 id="2-6总体实现"><a href="#2-6总体实现" class="headerlink" title="2.6总体实现"></a>2.6总体实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> list;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ConcurrentModificationException;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.NoSuchElementException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义LinkedList .</span></span><br><span class="line"><span class="comment"> * 实现选择是选用头节点和尾节点。可以极大简便很多的特殊情况，例如：删除头节点。额外的调整整个链表的头节点。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> pengchengliu</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLinkedList</span>&lt;<span class="title">AnyType</span>&gt; <span class="keyword">implements</span> <span class="title">Iterable</span>&lt;<span class="title">AnyType</span>&gt;</span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Node&lt;AnyType&gt; beginMarker ;</span><br><span class="line">	<span class="keyword">private</span> Node&lt;AnyType&gt; endMarker ;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//TODO ：为什么会存在modCount计数器呢？</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> theSize ;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> modCount ;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyLinkedList</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.clear();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 清空当前的容器</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		beginMarker = <span class="keyword">new</span> Node&lt;AnyType&gt;(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">		endMarker = <span class="keyword">new</span> Node&lt;AnyType&gt;(<span class="keyword">null</span>, beginMarker, <span class="keyword">null</span>);</span><br><span class="line">		beginMarker.next = endMarker ;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//	重置计数器。</span></span><br><span class="line">		theSize = <span class="number">0</span> ;</span><br><span class="line">		modCount++ ;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取当前容器的长度。</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 当前容器的长度 。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> theSize ;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 判断当前集合是否为空</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 当前容器是否为空</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.size() == <span class="number">0</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 添加一个节点，到整个集合的最后面。</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(AnyType node)</span></span>&#123;</span><br><span class="line">		add(size(), node);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 添加一个一个节点，在index的位置上面添加一个元素。</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> index ：</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> newVaule ：</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, AnyType newVaule)</span></span>&#123;</span><br><span class="line">		addBefore(getNode(index), newVaule);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 得到集合当中的一个元素，通过索引得到集合当中的一个元素。</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> index </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> AnyType <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> getNode(index).data;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 替换一个元素，替换位置在index上面的元素为newValue</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> index 原有的位置</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> newValue 新元素的值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 以前index位置的元素值。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> AnyType <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, AnyType newValue)</span></span>&#123;</span><br><span class="line">		Node&lt;AnyType&gt; node = getNode(index);</span><br><span class="line">		AnyType oldValue = node.data;</span><br><span class="line">		node.data = newValue ;</span><br><span class="line">		<span class="keyword">return</span> oldValue ;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 移除一个元素，移除index位置的元素并且把给元素返回</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> index ： 指定的位置。</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> ： 要移除的元素。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> AnyType <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> remove(getNode(index));</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 添加一个元素，将元素item添加到node之前。此方法为其他方法的服务方法，所以不需要暴露给外部类调用</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addBefore</span><span class="params">(Node&lt;AnyType&gt; node, AnyType item)</span></span>&#123;</span><br><span class="line">		Node&lt;AnyType&gt; itemNode = <span class="keyword">new</span> Node&lt;AnyType&gt;(item, node.prev, node);</span><br><span class="line">		itemNode.prev.next = itemNode ;</span><br><span class="line">		node.prev = itemNode ;</span><br><span class="line">		<span class="comment">//更新计数器。</span></span><br><span class="line">		theSize ++ ;</span><br><span class="line">		modCount ++ ;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 移除一个元素，将oldNode在原有的集合当前删除。</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> oldNode</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> AnyType <span class="title">remove</span><span class="params">(Node&lt;AnyType&gt; oldNode)</span></span>&#123;</span><br><span class="line">		oldNode.next.prev = oldNode.prev ;</span><br><span class="line">		oldNode.prev.next = oldNode.next ;</span><br><span class="line">		<span class="comment">//更新计数器</span></span><br><span class="line">		theSize-- ;</span><br><span class="line">		modCount++ ;</span><br><span class="line">		<span class="keyword">return</span> oldNode.data ;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 得到一个元素，根据index下表值，得到一个元素</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> index 下表值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 得到的元素。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> Node&lt;AnyType&gt; <span class="title">getNode</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">		Node&lt;AnyType&gt; tempNode ;</span><br><span class="line">		<span class="comment">//下标合法性验证</span></span><br><span class="line">		<span class="keyword">if</span>(index &lt; <span class="number">0</span> || index &gt; <span class="keyword">this</span>.size())&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfBoundsException();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//由于是双向列表，所以根据index的值不同在两端获取。使得效率更加的高效，O(N/2)的时间复杂度。</span></span><br><span class="line">		<span class="keyword">if</span>(index &lt; <span class="keyword">this</span>.size() / <span class="number">2</span>)&#123;</span><br><span class="line">			<span class="comment">//从开头开始找,获取第一个元素</span></span><br><span class="line">			tempNode = beginMarker.next ;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i ++)&#123;</span><br><span class="line">				tempNode = tempNode.next ;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">//从结尾开始找,获取最后一个元素。</span></span><br><span class="line">			tempNode = endMarker.prev ;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="keyword">this</span>.size(); i &gt; index; i--)&#123;</span><br><span class="line">				tempNode = tempNode.prev ;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> tempNode ;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Iterator&lt;AnyType&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> LinkedListIterator();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/***</span></span><br><span class="line"><span class="comment">	 * LinkedList的迭代器。</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@author</span> pengchengliu</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedListIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">AnyType</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//当前的位置，默认指向第一个元素。</span></span><br><span class="line">		<span class="comment">//TODO : 下面两个变量存在的意义。</span></span><br><span class="line">		<span class="keyword">private</span> Node&lt;AnyType&gt; current = beginMarker.next ;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">int</span> expectedModCount = modCount ;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">boolean</span> okToRemove = <span class="keyword">false</span> ;</span><br><span class="line">		</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> current != endMarker;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> AnyType <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="comment">//TODO : 为什么需要做这么一步判断呢？</span></span><br><span class="line">			<span class="keyword">if</span>(modCount == expectedModCount)&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//TODO ：为什么需要这个判断</span></span><br><span class="line">			<span class="keyword">if</span>(!hasNext())&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException() ;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			AnyType data = current.data;</span><br><span class="line">			current = current.next ;</span><br><span class="line">			okToRemove = <span class="keyword">true</span> ;</span><br><span class="line">			<span class="keyword">return</span> data;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(modCount != expectedModCount)&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//TODO ：为什么需要这个判断</span></span><br><span class="line">			<span class="keyword">if</span>(!okToRemove)&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			MyLinkedList.<span class="keyword">this</span>.remove(current.prev);</span><br><span class="line">			okToRemove = <span class="keyword">false</span> ;</span><br><span class="line">			expectedModCount++ ;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 节点类，用来表示链表当中的一个节点。</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@author</span> pengchengliu</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> &lt;AnyType&gt;</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="comment">//TODO : 问题一：为什么选择是private。</span></span><br><span class="line">	<span class="comment">//TODO : 问题二：为什么选择是static。</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">AnyType</span>&gt;</span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//TODO ：为什么内部属性选用public 。</span></span><br><span class="line">		<span class="keyword">private</span> AnyType data ;</span><br><span class="line">		<span class="keyword">public</span> Node&lt;AnyType&gt; prev ;</span><br><span class="line">		<span class="keyword">public</span> Node&lt;AnyType&gt; next ;</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(AnyType data, Node&lt;AnyType&gt; prev, Node&lt;AnyType&gt; next)</span></span>&#123;</span><br><span class="line">			<span class="keyword">this</span>.data = data ;</span><br><span class="line">			<span class="keyword">this</span>.prev = prev ;</span><br><span class="line">			<span class="keyword">this</span>.next = next ;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>##3、两者实现方式在效率上面的差别</p>
<p>我们知道了ArrayList适合读，而插入和删除还是选择LinkedList，具体的要看两者之间的差别，还是需要通过一个例子来看。</p>
<p>例子：删除一个List当中为偶数的元素。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testDome</span><span class="params">(List&lt;Integer&gt; list)</span></span>&#123;</span><br><span class="line">	Iterator&lt;Integer&gt; its = list.iterator();</span><br><span class="line">	<span class="keyword">while</span>(its.hasNext())&#123;</span><br><span class="line">		<span class="keyword">if</span>(itr.next() % <span class="number">2</span> == <span class="number">0</span>)&#123;</span><br><span class="line">			itr.remove();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果是LinkedList，40万条数据，大概时间是0.031秒，而如果是ArrayList大概是2.5分钟，而如果是80万数据的话，LinkedList大概是0.062秒，ArrayList则是10分钟。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/07/29/dataType-adt-02/" data-id="ck2opn4jx002d0mewkhrgmhqb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据结构/">数据结构</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-dataType-adt-01" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/28/dataType-adt-01/" class="article-date">
  <time datetime="2017-07-28T04:34:35.000Z" itemprop="datePublished">2017-07-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/数据结构/">数据结构</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/28/dataType-adt-01/">数据结构表（ADT）解析(上)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1、前言"><a href="#1、前言" class="headerlink" title="1、前言"></a>1、前言</h2><p>自工作以来，越来越觉得数据结构的重要性，类似于网络上面拉去下来的数据进行分类，还是自定义View画图的x，y还是滑动的距离。滑动距离的判断种种。感觉自己很是欠缺火候，所以开始恶补数据结构、算法的知识，让自己可以提高。</p>
<p>之前在知乎上面看了一个帖子，在讨论数据结构的重要性，有一句话说的很好，也是笔者开始写一系列数据结构算法的动力，在这里送给给位看客，</p>
<ul>
<li>对于一个程序员来说，算法的高度决定程序员的高度，而一个程序员将来成就的高度取决于算法的高度</li>
</ul>
<p>看完以后热情满满，打算从最基本的开始学习，如果各位看客发现在什么地方说的不对，希望指出。谢谢各位。</p>
<h2 id="2、抽象数据类型（ADT）"><a href="#2、抽象数据类型（ADT）" class="headerlink" title="2、抽象数据类型（ADT）"></a>2、抽象数据类型（ADT）</h2><p>学习数据结构之前，我们需要明白什么是抽象数据类型，</p>
<p>抽象数据类型（abstract data type）:是带有一组操作的一些对象的集合，抽象数据类型是数学方面的抽象。在抽象数据类型定义中没有地方提到关于这组操作时如何实现的任何解释。这里有两个比较重要的地方，首先第一个是一组操作。然后是一些对象的集合，</p>
<p>在这里笔者的理解是有一个装篮球的箱子，箱子上面有各种各样的按钮，每一个按钮都可以操作箱子里面篮球，比如让箱子将所有的篮球全部吐出来，等等，这里这个装篮球的箱子以及里面的篮球和按钮就是抽象数据类型。</p>
<p>常见的抽象数据类型有表、栈、队列、树、图、散列 等，将在后面篇章详细讨论，这里只对表进行说明。</p>
<h2 id="3、表（ADT）"><a href="#3、表（ADT）" class="headerlink" title="3、表（ADT）"></a>3、表（ADT）</h2><h3 id="3-1-表当中的元素"><a href="#3-1-表当中的元素" class="headerlink" title="3.1 表当中的元素"></a>3.1 表当中的元素</h3><p>我们将处理 $A_{0}$、 $A_{1}$、 $A_{2}$、 $A_{3}$、 $A_{4}$、·····  $A_{N-1}$的一般的表。我们就说这个表的长度是N。我们将长度为0的表叫做空表（empty list）</p>
<p>对于一个不为空的表，我们说 $A_{i}$后继 $A_{i-1}$（i &lt; N, i &gt; 0）并且$A_{i-1}$ 前驱 $A_{i}$。$A_{0}$为表当中的第一个元素，没有前驱元，而$A_{N-1}$为表当中的最后一个元素，没有后继元。</p>
<h3 id="3-2-表当中的操作"><a href="#3-2-表当中的操作" class="headerlink" title="3.2 表当中的操作"></a>3.2 表当中的操作</h3><p>对于每种ADT并不存在什么固定的操作，而为每种ADT提供合理的操作，一般取决于程序的设计者。对于表这种ADT，笔者在这里提出比较常用的操作。为 ：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">printList : 按照表的顺序打印各个位置的对象，如是对象打印地址。</span><br><span class="line">makeEmpty : 将该表置空</span><br><span class="line"></span><br><span class="line">find : 返回某一项第一次返回的位置。</span><br><span class="line">findValueForIndex : 通过index查找value </span><br><span class="line">findIndexForValue : 通过value查找index</span><br><span class="line"></span><br><span class="line">insert : 在表的末尾插入</span><br><span class="line">insertForIndex : 在指定位置插入</span><br><span class="line"></span><br><span class="line">remove : 通过value删除元素</span><br><span class="line">remmoveForIndex : 通过index删除元素</span><br></pre></td></tr></table></figure>
<h2 id="4、表的实现"><a href="#4、表的实现" class="headerlink" title="4、表的实现"></a>4、表的实现</h2><h3 id="4-1、数组实现简单的表。"><a href="#4-1、数组实现简单的表。" class="headerlink" title="4.1、数组实现简单的表。"></a>4.1、数组实现简单的表。</h3><p>我们把通过数组实现的表接口叫做顺序表。顺序表的所有操作都可以通过使用数组来实现，但是这里会涉及到一个问题就是，就是数组应该是固定长度的，我们的表应该让上层用户感觉不到容量，及当用户想要去添加的时候，我们可以让用户无限添加。这就是数组实现表里面的一个通用问题，这里的解决方式是让数组扩容，什么是扩容呢？ 就是通过大于旧数组的长度去定义一个新的数组，然后把旧的数组里面的所有元素全部拷贝到新数组。</p>
<p>关于新数组的长度应该是多少呢？笔者在这里给出</p>
<ul>
<li>新数组长度 =  旧数组的长度 +（ 旧数组的长度 * 2）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> [] arr = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line">···</span><br><span class="line">···</span><br><span class="line"><span class="comment">//开始扩容</span></span><br><span class="line"><span class="keyword">int</span> newSize = arr.length + ( arr.length * <span class="number">2</span> );</span><br><span class="line"><span class="keyword">int</span>[] newArray = <span class="keyword">new</span> <span class="keyword">int</span>[newSize];</span><br><span class="line"></span><br><span class="line"><span class="comment">//扩容完成，下面开始拷贝</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; arr.length; k++)&#123;</span><br><span class="line">	newArray[k] = arr[k]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//归还引用</span></span><br><span class="line">arr = newArray ;</span><br></pre></td></tr></table></figure>
<p>这种数据结构的优点在于，查找，基本消耗的时间都是线性时间，而上述提供的findValueForIndex操作，常数时间就可以很轻松的完成。</p>
<p>缺点就是，如果我们需要对顺序表当中的表结构（数据）进行改变呢？我们不妨设想一下，如果我们需要在第2位插入一个元素，那么就代表着，表里面的原先2位置的元素下表变化称为第3，而第3变为第4，以此类推，直到表中元素结束。删除也是同样的道理。当然如果我们在最后一位插入，我们的时间也是常数值。在这里我们考虑最坏情况，那就是在第一位插入活着删除，那么我们的时间就是$o(N)$。</p>
<p>总结：就是如果对于该表数据为只读权限（完全访问），而没有写权限，那么这种表结构的实现无一就是完美的，但是对插入删除操作比较多的话。笔者在这里不推荐使用这种表，而推荐下述的这种表结构（链表），后续会比较两表的效率问题，</p>
<h3 id="4-2、简单链表"><a href="#4-2、简单链表" class="headerlink" title="4.2、简单链表"></a>4.2、简单链表</h3><p>为了解决上述问题，人们开始思考，如果我们将表不进行连续存储，可以避免插入和删除的线性开销，下图为链表的一般想法</p>
<p><img src="/2017/07/28/dataType-adt-01/01.png" alt="简单链表"></p>
<p>上图可知，链表是一系列节点组成的，我们称之为Node，这些Node在内存当中是不连续的。每一个Node都有一条链，我们称之为next链，直向下一个Node，最后一个元素的next链为空。</p>
<p>我们如果打印全部，或者便利的话，通过第一个元素找到第二个元素以此类推，直到找到最后一个元素。时间是线性的，这个数组实现是一样的，不过其中的常数可能会比使用数组要大，findValueForIndex操作确实没有数组效率高，需要通过第一个开始找，直到遍历到index，所以时间复杂度为 $O(i)$ 。</p>
<p>如果是删除和插入操作，我们只需要修改两个链也就是引用，我们就可以完成插入操作和删除操作，不需要移动项，所以对比上述数组实现确实是简便了一些。下图为删除和插入的实现链表</p>
<p><img src="/2017/07/28/dataType-adt-01/02.png" alt="简单链表"></p>
<p>这里如果要插入的话，就把A3指向A4的引用变为A3指向x，然后把x的指向变为A4即可。不需要移动项，所以在这里时间复杂度是常数时间。</p>
<p><img src="/2017/07/28/dataType-adt-01/03.png" alt="简单链表"></p>
<p>如果要删除A4节点的话，这里我们直接把A3的链指向A5，然后把A4原本指向A5的链制空。就完成了A4的删除。时间复杂度也是常数时间。</p>
<p>使用上述链表的话，删除最后一个节点，我们得先找到指向最后一个节点的项，但是在上述链表当中，每一个节点不会提供前驱节点的任何信息。所以对上述链表进行改造，得出双向链表，即一个节点会提供下一个节点和上一个节点的信息，结构图如下所示。</p>
<p><img src="/2017/07/28/dataType-adt-01/04.png" alt="简单链表"></p>
<hr>
<h2 id="5、Java中的表（ADT）List"><a href="#5、Java中的表（ADT）List" class="headerlink" title="5、Java中的表（ADT）List"></a>5、Java中的表（ADT）List</h2><p>Java语言中，提供了一些普通数据结构的实现。该语言的这一部分叫做Collection API。表（ADT）是在Collection中实现的数据结构之一。</p>
<p>Java当中由java.util包中的List接口指定。根据上述表的实现思想，Java当中由ArrayList类提供了List ADT的一种可增长数组的实现。使用该数据结构的优点在于，get和set的调用花费常数时间。但是插入操作和删除操作代价昂贵（在于移动其与项）。</p>
<p>Java当中由LinkedList类提供了List ADT的双向链表的实现，优点在于新项的插入和删除开销比较小，这里假设变动项的位置是已知的，这意味着，在表的前端和末尾都是常数时间。使用LinkedList的缺点在于get的调用是昂贵的，除非调用的项非常的接近端点</p>
<h3 id="5-1-Java当中Iterable接口"><a href="#5-1-Java当中Iterable接口" class="headerlink" title="5.1 Java当中Iterable接口"></a>5.1 Java当中Iterable接口</h3><p>实现了Iterable接口的那些类，可以拥有增强For的循环，该循环施于这些类之上从而观察它们的所有项。</p>
<p>Collection接口当中扩展了Iterable接口。实现Iterable接口的类，必须提供了一个名叫iterator的方法。该方法返回一个实现了Iterator接口类。下面我们看看Iterator接口是干嘛的？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Iterator</span>&lt;<span class="title">AnyType</span>&gt;</span>&#123;</span><br><span class="line">	<span class="comment">// 是否还有下一项？</span></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 得到当前的项</span></span><br><span class="line">	<span class="function">AnyType <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 移除当前的项</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>具体每个方法是干嘛的，上述注释说的很清楚了。Iterator接口的思路就是，通过iterator方法，每个集合都可以创建一个实现Iterator接口的对象，并且将当前的位置概念在对象内部保存下来。</p>
<p>1、 使用iterator进行遍历。</p>
<p>获取当前对象的iterator，然后调用hasNext（）方法，next（）方法进行遍历。具体模拟入下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line">Iterator&lt;AnyType&gt; iterator = collection.iterator();</span><br><span class="line"><span class="keyword">while</span>(iterator.hasNext())&#123;</span><br><span class="line">	AnyType item = iterator.next();</span><br><span class="line">	System.out.println(item.toString());</span><br><span class="line">&#125;</span><br><span class="line">···</span><br></pre></td></tr></table></figure>
<p>在Iterator接口里面我们看到一个remove方法，这个方法主要是删除由next方法返回的最新的项，在Collection当中同样也提供了remove方法，两者到底有什么不同呢？</p>
<p>这里笔者推荐的是如果可以使用Iterator接口里面的remove，尽量使用。为什么这么说呢？原因有以下两点</p>
<p>1、因为我们知道collection当中的remove是先要找到删除的项，然后进行删除。而Iterator接口里面的remove是已经找到项的，在这里会节省一部分的时间。</p>
<p>2、如果直接使用Iterator的时候。如果对正在被遍历的集合进行结构上面的改变，那么迭代器将不再合法会跑出ConcurrentModificationException异常。如果直接使用Iterator内部的remove则不会抛出异常。</p>
<h3 id="5-2-ArrayList的实现"><a href="#5-2-ArrayList的实现" class="headerlink" title="5.2 ArrayList的实现"></a>5.2 ArrayList的实现</h3><p>笔者在这里模拟ArrayList的实现，具体实现如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义ArrayList的实现方式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 刘酸酸</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;AnyType&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyArrayList</span>&lt;<span class="title">AnyType</span>&gt; <span class="keyword">implements</span> <span class="title">Iterable</span>&lt;<span class="title">AnyType</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 默认扩容长度 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CAPACITY = <span class="number">10</span> ;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 当前数据结构的长度 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> mSize ;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 内部使用的数据来存储数据 */</span></span><br><span class="line">	<span class="keyword">private</span> AnyType[] mArray ;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MyArrayList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		initMyArray();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 初始化数组 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initMyArray</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		mSize = <span class="number">0</span> ;</span><br><span class="line">		ensureCapacity(DEFAULT_CAPACITY) ;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 返回当前元素的长度 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mSize ;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 当前表是否为空 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> size() == <span class="number">0</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 根据下表返回元素 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> AnyType <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">		checkIndex(index);</span><br><span class="line">		<span class="keyword">return</span> mArray[index];</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 在index的位置替换newValue，然后返回index位置以前的Vaule */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> AnyType <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, AnyType newValue)</span></span>&#123;</span><br><span class="line">		checkIndex(index);</span><br><span class="line">		AnyType oldValue = mArray[index];</span><br><span class="line">		mArray[index] = newValue ;</span><br><span class="line">		<span class="keyword">return</span> oldValue ;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 默认插入，在当前表的最后一位进行插入 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span> <span class="params">(AnyType value)</span></span>&#123;</span><br><span class="line">		add(size(),value);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 移除index的元素并且把给元素返回 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> AnyType <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">		AnyType old = mArray[index] ;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = index; i &lt; size() - <span class="number">1</span>; i++)&#123;</span><br><span class="line">			mArray[i] = mArray[i + <span class="number">1</span>] ;</span><br><span class="line">		&#125;</span><br><span class="line">		mSize -- ;</span><br><span class="line">		<span class="keyword">return</span> old ;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**给index的位置插入一个新的元素，index以后的所有元素后移一位 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> index, AnyType value)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(mArray.length == size())&#123;</span><br><span class="line">			ensureCapacity(size() * <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = mSize; i &gt; index; i-- )&#123;</span><br><span class="line">			mArray[i] = mArray[i -<span class="number">1</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		mArray[index] = value ;</span><br><span class="line">		</span><br><span class="line">		mSize ++ ;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 检查 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkIndex</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(index &lt; <span class="number">0</span> || index &gt;= size())&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> ArrayIndexOutOfBoundsException(<span class="string">"index is not true"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 扩容方法 */</span></span><br><span class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacity</span><span class="params">(<span class="keyword">int</span> newCapactity)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(newCapactity &lt; mSize)&#123;</span><br><span class="line">			<span class="keyword">return</span> 	;</span><br><span class="line">		&#125;</span><br><span class="line">		AnyType[] old = mArray ;</span><br><span class="line">		mArray = (AnyType[]) <span class="keyword">new</span> Object[newCapactity];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size(); i++)&#123;</span><br><span class="line">			mArray[i] = old[i];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Iterator&lt;AnyType&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ArrayListIterator();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * MyArrayList的迭代器。</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@author</span> pengchengliu</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayListIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">AnyType</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">int</span> mCurrent ;</span><br><span class="line">		</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> mCurrent &lt; size();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> AnyType <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> mArray[mCurrent++];</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			MyArrayList.<span class="keyword">this</span>.remove(--mCurrent) ;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/07/28/dataType-adt-01/" data-id="ck2opn4jw00290mewifoqby08" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据结构/">数据结构</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android-view-SurfaceView01" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/06/android-view-SurfaceView01/" class="article-date">
  <time datetime="2017-03-06T08:13:13.000Z" itemprop="datePublished">2017-03-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/06/android-view-SurfaceView01/">SurfaceView的简单使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="SurfaceView"><a href="#SurfaceView" class="headerlink" title="SurfaceView"></a>SurfaceView</h2><h4 id="1、SurfaceView的基本介绍"><a href="#1、SurfaceView的基本介绍" class="headerlink" title="1、SurfaceView的基本介绍"></a>1、SurfaceView的基本介绍</h4><p>SurfaceView 是继承自View的，属于View的一个小小的分枝。</p>
<ul>
<li>View 通过onDraw（）方法里面的Canvas对象去绘制自己到屏幕上面。</li>
<li>SurfaceView 并不需要实现OnDraw（）方法。那么我们的Surface是如何绘制自身的呢！其实View是在UI线程当中绘制自己，而SurfaceView是在子线程当中绘制自身。就是因为在子线程当中绘制自己所以不管绘制是多么的缓慢，还是绘制方法多么频繁的调用，其都不会阻塞UI线程。所以像播放视频时候使用的View，还是游戏所使用的View都是SurfaceView，而不是View。</li>
</ul>
<ul>
<li><p>SurfaceView是在子线程当中进行绘制，那么它是如何获取到Canvas的，如何进行绘制的？ </p>
<p>  答：在SurfaceView当中存在一个Surface，而在Surface当中持有Canvas，但是我们拿不到Surface，系统为之暴露了一个SurfaceHolder（Surface的持有者），那么我们可以通过SurfaceView获取SurfaceHolder，然后通过SurfaceHolder获取Canvas。</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SurfaceHolder holder = <span class="keyword">new</span> SurfaceView().getHolder();</span><br><span class="line">Canvas canvas = holder.getCanvas();</span><br></pre></td></tr></table></figure>
</li>
<li><p>SurfaceView的绘制时机是什么时候，我们知道View的绘制时机是在onDraw()方法里面，但是SurfaceView的绘制时机在什么时候。==</p>
<p>  答：之前说过的SurfaceHolder不仅仅能获取Canvas对象，其实SurfaceHolder还管理者SurfaceView的生命周期。同时生命周期如下所示：</p>
<ul>
<li>SurfaceCreated（）：创建相应的子线程，然后在子线程的run（）方法当中开启对SurfaceView的绘制</li>
<li>SurfaceChanged（）：相当与对SurfaceView的进行监听。</li>
<li>SurfaceDestorye（）：关闭我们子线程，以及对一些资源的回收。</li>
</ul>
</li>
</ul>
<hr>
<h4 id="2、SurfaceView的基本写法"><a href="#2、SurfaceView的基本写法" class="headerlink" title="2、SurfaceView的基本写法"></a>2、SurfaceView的基本写法</h4><p>常见的SurfaceView的写法，这里是模版代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * SurfaceView的自定义流程</span></span><br><span class="line"><span class="comment"> * Created by pengchengliu on 2017/8/25.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SurfaceDemo</span> <span class="keyword">extends</span> <span class="title">SurfaceView</span> <span class="keyword">implements</span> <span class="title">SurfaceHolder</span>.<span class="title">Callback</span>, <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SurfaceHolder mHolder ;</span><br><span class="line">    <span class="keyword">private</span> Thread mThread ;</span><br><span class="line">    <span class="keyword">private</span> Canvas mCanvas ;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isRunning ;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SurfaceDemo</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SurfaceDemo</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SurfaceDemo</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onFinishInflate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mHolder = <span class="keyword">this</span>.getHolder();</span><br><span class="line">        <span class="keyword">this</span>.setFocusable(<span class="keyword">true</span>);            <span class="comment">//设置SurfaceView为可以获取焦点。</span></span><br><span class="line">        <span class="keyword">this</span>.setFocusableInTouchMode(<span class="keyword">true</span>); <span class="comment">//设置SurfaceView可以触摸。</span></span><br><span class="line">        <span class="keyword">this</span>.setKeepScreenOn(<span class="keyword">true</span>);         <span class="comment">//设置SurfaceView的屏幕应该为保持高亮。</span></span><br><span class="line">        mHolder.addCallback(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">super</span>.onFinishInflate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建相应的子线程，然后在子线程的run（）方法当中开启对SurfaceView的绘制</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> holder 当前SurfaceView的Surface的持有者。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceCreated</span><span class="params">(SurfaceHolder holder)</span> </span>&#123;</span><br><span class="line">        mThread = <span class="keyword">new</span> Thread(<span class="keyword">this</span>);</span><br><span class="line">        isRunning = <span class="keyword">true</span> ;</span><br><span class="line">        mThread.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *：相当与对SurfaceView的进行监听。</span></span><br><span class="line"><span class="comment">     * 任何结构变更后立即调用（格式或尺寸）已经制成表面。 应该在这一点上更新表面的图像。</span></span><br><span class="line"><span class="comment">     * 这种方法总是至少被调用一次，&#123;<span class="doctag">@link</span> #surfaceCreated&#125;之后。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> holder 表面已更改的SurfaceHolder。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> format 式表面的新的PixelFormat。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> width 表面的新宽度。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> height 表面的新高度。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceChanged</span><span class="params">(SurfaceHolder holder, <span class="keyword">int</span> format, <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当SurfaceView被销毁的时候进行回调。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> holder 当前SurfaceView的Surface的持有者，也就是SurfaceHolder</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceDestroyed</span><span class="params">(SurfaceHolder holder)</span> </span>&#123;</span><br><span class="line">        isRunning = <span class="keyword">false</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (isRunning)&#123;</span><br><span class="line">            draw();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 进行绘制操作。主要思想就是得到绘制工具Canvas，然后在不必要的情况下进行Canvas的释放</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获取Canvas对象</span></span><br><span class="line">            mCanvas = mHolder.lockCanvas();</span><br><span class="line">            <span class="comment">//TODO 为什么进行判空操作呢？</span></span><br><span class="line">            <span class="comment">// 主要原因就是由于这个方法是在不断进行调用，所以当用户点击Home或者回退按键的话，当前的SurfaceView对象就会被销毁，</span></span><br><span class="line">            <span class="comment">// 相应的holder对象也会被销毁，所以在这里通过hodler获取到的canvas也就是空的。所以进行判空操作。</span></span><br><span class="line">            <span class="keyword">if</span>(mCanvas != <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="comment">//进行绘制</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//TODO 为什么进行try-catch呢？</span></span><br><span class="line">            <span class="comment">// 因为就是当前页面如果被销毁掉，也就是说当前的SurfaceView已经被销毁，但是线程不会很快就被销毁，所以在这个地方就会抛出各种各样的异常。</span></span><br><span class="line">            <span class="comment">// 在这里是try-catch，就是防止上述情况下写出来的。</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(mCanvas != <span class="keyword">null</span>)&#123;</span><br><span class="line">                mHolder.unlockCanvasAndPost(mCanvas);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/06/android-view-SurfaceView01/" data-id="ck2opn4ij00060mewd9iif5i8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/控件/">控件</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android-view-textview" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/03/android-view-textview/" class="article-date">
  <time datetime="2017-03-03T08:06:27.000Z" itemprop="datePublished">2017-03-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/03/android-view-textview/">Android,TextView优雅显示长文本、富文本</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Android提供了TextView这个类作为Android开发当中展示文字的工作，最近笔者在做类似于一个展示类型的APP，发现TextView这个类真的有点力不从心，好多的功能都让笔者特别头疼，于是就有了今天这篇技术博客。</p>
<p>原生的APi当中提供了TextView这个控件供开发者使用，一般需求都不在话下，可以设置显示文本的字体大小，字体颜色以及字体的显示格式，如：密码格式、数字格式等等。但是在千变万化的开发当中，还是不能满足开发者的需求，比如控制下拉的长文本，以及富文本。我们先来看几种需求。</p>
<p><img src="/2017/03/03/android-view-textview/01.png" alt="效果图01"></p>
<p><img src="/2017/03/03/android-view-textview/02.png" alt="效果图02"></p>
<p>上面看到了几点需求，还有好多，笔者相信各位看客心中都懂，所以就不展示太多了，我们今天要做到就是通过几种方式来优化我们TextView，好吧，我们开始。</p>
<hr>
<h2 id="1、TextView实现长文本的分段展示。"><a href="#1、TextView实现长文本的分段展示。" class="headerlink" title="1、TextView实现长文本的分段展示。"></a>1、TextView实现长文本的分段展示。</h2><p>长文本：这个没什么好解释的，就是比较长的文本。直接显示就OK，但是我们知道Android当中的屏幕尺寸是有限的，我们要在有限的屏幕内合理的显示很多的内容，当然这个是侧滑菜单栏出现的原因。我们要让TextView通过用户的交互来显示合理的内容，比如在用户并不对该文本关系的前提，显示重要的前几行就OK ，如果用户想看文本内容，用户可以通过点击当前的TextView进行显示其与的内容，根据这个简单的需求，我们来对TextView进行定制。</p>
<p>首先我们先计划一下我们怎么对当前的TextView进行定制呢！</p>
<ul>
<li>1、我们继承一个现有的ViewGroup，当中含有一个Button、TextView。实际让Button去控制TextView的显示方式。</li>
<li>2、我们初始化的时候可以根据TextView的长度，来决定是否显示Button，因为我们知道TextView在我们有限的空间里面可以完全显示的时候，也就不需要下拉的功能。</li>
<li>3、通过TextView可显示的行数，完全显示的行数去测量TextView的高度。</li>
<li>4、通过Button的点击去切换可显示的行数、完全显示的行数</li>
<li>5、加入动画，笔者这里加入的属性动画</li>
<li>6、解决不友好的BUG，类似于ViewGroup改变，而当ViewGroup改变动画结束，TextView才完全显示，这里会贴图给看客展示。</li>
<li>7、添加回调定制完成，效果图展示</li>
</ul>
<h3 id="1、继承ViewGroup开始定制"><a href="#1、继承ViewGroup开始定制" class="headerlink" title="1、继承ViewGroup开始定制"></a>1、继承ViewGroup开始定制</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用于显示长文本，可以展开的TextView</span></span><br><span class="line"><span class="comment"> * Created by suansuan on 2017/9/18.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PullDownTextView</span> <span class="keyword">extends</span> <span class="title">LinearLayout</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> TextView mTextView ;</span><br><span class="line">    <span class="keyword">private</span> ImageButton mImageButton;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们这里选择的是LinearLayout，原因就是我们TextView和Button排列方式是线性布局。</p>
<h3 id="2、初始化"><a href="#2、初始化" class="headerlink" title="2、初始化"></a>2、初始化</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PullDownTextView</span> <span class="keyword">extends</span> <span class="title">LinearLayout</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span></span>&#123;</span><br><span class="line">	<span class="comment">//是否处于展开状态。默认为隐藏</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> isPull  ;           </span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> TextView mTextView ;</span><br><span class="line">    <span class="keyword">private</span> ImageButton mImageButton;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** ImageButton切换的两种图片 */</span></span><br><span class="line">    <span class="keyword">private</span> Drawable mPullDownDrawable ;</span><br><span class="line">    <span class="keyword">private</span> Drawable mUpDownDrawable ;</span><br><span class="line"></span><br><span class="line">	 <span class="comment">/** 初始化PullDownTextView */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initPullDownTextView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mPullDownDrawable = getDrawable(R.drawable.ic_pull_small_light);</span><br><span class="line">        mUpDownDrawable = getDrawable(R.drawable.ic_not_small_light);</span><br><span class="line">        setOrientation(LinearLayout.VERTICAL);</span><br><span class="line">        <span class="comment">//默认隐藏</span></span><br><span class="line">        setVisibility(View.GONE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 当加载完XML布局时回调 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onFinishInflate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onFinishInflate();</span><br><span class="line">        initPullDownTextView();</span><br><span class="line">        mTextView = (TextView) <span class="keyword">this</span>.getChildAt(<span class="number">0</span>);</span><br><span class="line">        mImageButton = (ImageButton) <span class="keyword">this</span>.getChildAt(<span class="number">1</span>);</span><br><span class="line">        mImageButton.setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        mImageButton.setImageDrawable(isPull ? mUpDownDrawable : mPullDownDrawable);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	 <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrientation</span><span class="params">(<span class="keyword">int</span> orientation)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(orientation == LinearLayout.HORIZONTAL)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"参数错误：当前控件，不支持水平"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">super</span>.setOrientation(orientation);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们对当前的ViewGroup进行初始化设置。对Button的图片进行初始化,以及事件的初始化</p>
<h3 id="3、测量"><a href="#3、测量" class="headerlink" title="3、测量"></a>3、测量</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PullDownTextView</span> <span class="keyword">extends</span> <span class="title">LinearLayout</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span></span>&#123;</span><br><span class="line">	<span class="comment">/** 位置大小相关属性 */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mTextViewPullHeight ;   <span class="comment">//textView显示全部也就是下拉状态的高度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mTextViewNotPullHeight ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isPull  ;           <span class="comment">//是否处于展开状态。默认为隐藏</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isReLayout ;        <span class="comment">//当前布局是否重新绘制。</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isAnimator ;        <span class="comment">//是否处于动画当中</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isMaxHeightMeasure;     <span class="comment">//是否进行TextView最大行数的测量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isMinHeightMeasure;     <span class="comment">//是否进行TexView可见行数的测量</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TextView mTextView ;</span><br><span class="line">    <span class="keyword">private</span> ImageButton mImageButton;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** ImageButton切换的两种图片 */</span></span><br><span class="line">    <span class="keyword">private</span> Drawable mPullDownDrawable ;</span><br><span class="line">    <span class="keyword">private</span> Drawable mUpDownDrawable ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mTextVisibilityCount = <span class="number">3</span>;  <span class="comment">//隐藏时 TextView可以显示的最大的行数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mAnimatorDuration = <span class="number">500</span> ;</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/** 测量方发，测量自己的宽高，测量孩子的宽高 */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//没有内容的时候，</span></span><br><span class="line">        <span class="keyword">if</span>(!isReLayout || getVisibility() == View.GONE)&#123;</span><br><span class="line">            <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//有内容，但是内容比较短的时候，正常显示TextView，但是相应的隐藏ImageButton</span></span><br><span class="line">        <span class="keyword">if</span>(mTextView.getLineCount() &lt;= mTextVisibilityCount)&#123;</span><br><span class="line">            mTextView.setVisibility(View.VISIBLE);</span><br><span class="line">            <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//有内容，并且显示的内容比较长的时候，这里我们显示TextView、ImageButton。</span></span><br><span class="line">        mImageButton.setVisibility(View.VISIBLE);</span><br><span class="line">        <span class="keyword">if</span>(!isMaxHeightMeasure &amp;&amp; mTextViewPullHeight == <span class="number">0</span>)&#123;</span><br><span class="line">            mTextView.setMaxLines(Integer.MAX_VALUE);</span><br><span class="line">            <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">            mTextViewPullHeight = mTextView.getMeasuredHeight() ;</span><br><span class="line">            isMaxHeightMeasure = <span class="keyword">true</span> ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!isMinHeightMeasure &amp;&amp; mTextViewNotPullHeight == <span class="number">0</span>)&#123;</span><br><span class="line">            mTextView.setMaxLines(mTextVisibilityCount);</span><br><span class="line">            <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">            mTextViewNotPullHeight = mTextView.getMeasuredHeight();</span><br><span class="line">            isMinHeightMeasure = <span class="keyword">true</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这里测量为什么只测量一次呢，因为后续我们会通过属性动画去改变TextView的高度，而我们改变后，我们获取就会导致我们获取到的高度不是定值，而是改变后的值。测量这里我们主要分为三种情况，上述代码当中注释也说的很清楚</p>
<ul>
<li>1、没有内容的时候，</li>
<li>2、有内容，但是内容比较短的时候，正常显示TextView，但是相应的隐藏ImageButton</li>
<li>3、有内容，并且显示的内容比较长的时候，这里我们显示TextView、ImageButton。</li>
</ul>
<h3 id="4、点击事件"><a href="#4、点击事件" class="headerlink" title="4、点击事件"></a>4、点击事件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(isAnimator)&#123;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(isPull)&#123;</span><br><span class="line">            startAnimator(mTextView, mTextViewPullHeight, mTextViewNotPullHeight);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            startAnimator(mTextView, mTextViewNotPullHeight, mTextViewPullHeight);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//下拉，或者上拉的时候的回调</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.mOnTextViewPullListener != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">this</span>.mOnTextViewPullListener.textViewPull(mTextView, isPull);</span><br><span class="line">        &#125;</span><br><span class="line">        isPull = !isPull ;</span><br><span class="line">        mImageButton.setImageDrawable(isPull ? mUpDownDrawable : mPullDownDrawable);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>根据用户点击状态去切换Button的图标，还有根据刚刚测量的高度进行开启动画</p>
<h3 id="5、开启动画"><a href="#5、开启动画" class="headerlink" title="5、开启动画"></a>5、开启动画</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 开始动画</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startAnimator</span><span class="params">(<span class="keyword">final</span> TextView view, <span class="keyword">int</span> startHeight, <span class="keyword">int</span> endHeight)</span></span>&#123;</span><br><span class="line">       ValueAnimator valueAnimator = ValueAnimator.ofInt(startHeight , endHeight ).setDuration(mAnimatorDuration);</span><br><span class="line">       valueAnimator.addListener(<span class="keyword">new</span> Animator.AnimatorListener() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationStart</span><span class="params">(Animator animation)</span> </span>&#123;&#125;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animation)</span> </span>&#123;</span><br><span class="line">               isAnimator = <span class="keyword">false</span> ;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationCancel</span><span class="params">(Animator animation)</span> </span>&#123;&#125;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationRepeat</span><span class="params">(Animator animation)</span> </span>&#123;&#125;</span><br><span class="line">       &#125;);</span><br><span class="line">       valueAnimator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</span><br><span class="line">               <span class="keyword">int</span> animatedValue = (<span class="keyword">int</span>) animation.getAnimatedValue();</span><br><span class="line">               ViewGroup.LayoutParams params = view.getLayoutParams();</span><br><span class="line">               params.height = animatedValue ;</span><br><span class="line">               <span class="comment">//这句，让TextView文本的高度随TextView高度进行变化</span></span><br><span class="line">               view.setMaxHeight(animatedValue);</span><br><span class="line">               view.setLayoutParams(params);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">       isAnimator = <span class="keyword">true</span> ;</span><br><span class="line">       valueAnimator.start();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>这个地方有一个坑，笔者也是想了很久，才弄明白的，说不太清楚，看下效果图吧。为了各位看客能很清楚的BUG，笔者在这里加入不同的背景。</p>
<p><img src="/2017/03/03/android-view-textview/03.gif" alt=""></p>
<p>这种效果就是在刚刚开始动画的时候，应该加入</p>
<ul>
<li>view.setMaxHeight(animatedValue);</li>
</ul>
<h3 id="6、回调接口"><a href="#6、回调接口" class="headerlink" title="6、回调接口"></a>6、回调接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** TextView展开回调 */</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OnTextViewPullListener</span></span>&#123;</span><br><span class="line">     <span class="function"><span class="keyword">void</span> <span class="title">textViewPull</span><span class="params">(TextView textView, <span class="keyword">boolean</span> isPull)</span> </span>;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnTextViewPullListener</span><span class="params">(OnTextViewPullListener listener)</span></span>&#123;</span><br><span class="line">     <span class="keyword">this</span>.mOnTextViewPullListener = listener ;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="7、在MainActivity当中使用"><a href="#7、在MainActivity当中使用" class="headerlink" title="7、在MainActivity当中使用"></a>7、在MainActivity当中使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        PullDownTextView text1 = (PullDownTextView)findViewById(R.id.expand_text_view);</span><br><span class="line">        text1.setText(getString(R.string.long_text1));</span><br><span class="line"></span><br><span class="line">        PullDownTextView text2 = (PullDownTextView)findViewById(R.id.expand1_text_view);</span><br><span class="line">        text2.setText(getString(R.string.long_text1));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里没有什么好说的，相信各位看客都懂。这就是大体的流程，回调接口就是在onClick事件回调的，上述代码也有说明。到这里就差不多了，源码在文章末尾给出，看一下我们的效果吧</p>
<p><img src="/2017/03/03/android-view-textview/04.gif" alt=""></p>
<hr>
<h2 id="2、TextView显示富文本"><a href="#2、TextView显示富文本" class="headerlink" title="2、TextView显示富文本"></a>2、TextView显示富文本</h2><p>我们在开始编码之前，我们先来了解一下什么是富文本，<br>富文本（Rich Text Format）：这个有些开发者比较陌生，那么什么是富文本呢？其实就是一段带有自己的格式的文本。这么说有点抽象，我们来举个例子，其实就是我们常用的Word编辑器所写的文本，每一个字都是带有格式的。我们看下面的一个例子就理解了什么是富文本。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hello!</span><br><span class="line">This is some bold text.</span><br></pre></td></tr></table></figure>
<p>  仔细观察，上述的一段文字是带有格式。这就是我们常见的富文本。现在我们看富文本的相应代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;\rtf1\ansi</span><br><span class="line">Hello!\par</span><br><span class="line">This is some &#123;\b bold&#125; text.\par</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述的富文本格式代码，貌似存在一定的规则可寻。什么规则呢，这里大体的描述一下，因为笔者这里语法也没有太多的深入，反斜线（\）标着这个RTE(富文本)控制的开始。（\par）表示开始新的一行，有点类似于HTML当中的标签了。(\b)将文字粗体显示。({})大括号定义了一个群组，上述例子中使用了一个群组来限制代码\b的作用范围。合法的RTF文档是一个以代码\rtf开始的群组。</p>
<p>了解了基本的什么是富文本之后，我们开始思考在本文开后的图1里面效果，如果让大家在Wold编辑器当中编写，会非常简单。当然Google也考虑到了这一种情况，所以我们不需要定制View就可以达到这种效果，Google为我们提供一个类用来封装我们带有格式的富文本，然后丢给TextView进行显示就OK，</p>
<h3 id="1、Google提供富文本封装类Spannable"><a href="#1、Google提供富文本封装类Spannable" class="headerlink" title="1、Google提供富文本封装类Spannable"></a>1、Google提供富文本封装类Spannable</h3><p>Spannable是一个接口，有两个实现类分别是<strong>SpannableString</strong>和<strong>SpannableStringBuilder</strong>，我们知道我们以后要使用的话，肯定就是这里面的这两个类啦。那么这两个类有什么区别呢，其实和我们早前学过的String，和StringBuilder是一样的，一个为定长字符串，一个为可变字符串的区别，可以根据看客自己的需求去选择</p>
<p>Spannable里面定义了两个方法，和一个静态工厂，通过静态工厂拿到Spannable默认实现类是SpannableString。具体代码如下所示：<br>Spannable.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">static</span> Spannable.Factory sInstance = <span class="keyword">new</span> Spannable.Factory();</span><br><span class="line"></span><br><span class="line">       <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * Returns the standard Spannable Factory.</span></span><br><span class="line"><span class="comment">        */</span> </span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">static</span> Spannable.<span class="function">Factory <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">           <span class="keyword">return</span> sInstance;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * Returns a new SpannableString from the specified CharSequence.</span></span><br><span class="line"><span class="comment">        * You can override this to provide a different kind of Spannable.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> Spannable <span class="title">newSpannable</span><span class="params">(CharSequence source)</span> </span>&#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">new</span> SpannableString(source);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>Spannable里面定义了两个方法，分别是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSpan</span><span class="params">(Object what, <span class="keyword">int</span> start, <span class="keyword">int</span> end, <span class="keyword">int</span> flags)</span></span>;</span><br><span class="line">&gt;  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeSpan</span><span class="params">(Object what)</span></span>;</span><br></pre></td></tr></table></figure>
<p>这里有几个参数，需要说一下，</p>
<ul>
<li>what :  样式</li>
<li>start : 该样式作用范围的起始位置</li>
<li>end : 该样式作用范围的结束位置</li>
<li>flags : 模式，</li>
</ul>
<p>最后一个参数的模式，相对的有点抽象，其实看客可以理解成为枚举，也就是说模式是系统为我们定义好的，让我去选择使用就OK了。在系统当中由Spanned给出。</p>
<ul>
<li>Spanned.SPAN_INCLUSIVE_INCLUSIVE    起始结束都包括</li>
<li>Spanned.SPAN_EXCLUSIVE_INCLUSIVE    起始不包括，结束包括</li>
<li>Spanned.SPAN_INCLUSIVE_EXCLUSIVE    起始包括，结束不包括</li>
<li>Spanned.SPAN_EXCLUSIVE_EXCLUSIVE    起始结束都不包括</li>
</ul>
<h4 id="1-1、获取Spannable实例"><a href="#1-1、获取Spannable实例" class="headerlink" title="1.1、获取Spannable实例"></a>1.1、获取Spannable实例</h4><p>我们刚刚看过源码，知道了Spannable内部又一个静态的工厂类，那我们就使用这个类来获取实例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; Spannable spannable = Spannable.Factory.getInstance().newSpannable(string);</span><br></pre></td></tr></table></figure>
<h4 id="1-2、Google为我们提供的样式"><a href="#1-2、Google为我们提供的样式" class="headerlink" title="1.2、Google为我们提供的样式"></a>1.2、Google为我们提供的样式</h4><p>其实这里的样式是特别的多的，Google主要按照分类，分成了两大类，分别是字体的样式，和段落的样式。笔者在这里找几个常用的到的进行说明，其他的请各位看客自行去了解CharacterStyle， ParagraphStyle的实现子类，好找出看客所需要的样式。</p>
<h4 id="1-3、颜色相关"><a href="#1-3、颜色相关" class="headerlink" title="1.3、颜色相关"></a>1.3、颜色相关</h4><p>颜色相关主要分为一个字体的颜色（ForegroundColorSpan），一个背景的颜色（BackgroundColorSpan）。</p>
<p><img src="/2017/03/03/android-view-textview/05.png" alt=""></p>
<p>在这里我专门给测试TextView加入了背景和字体，我们发现，在背景方面，Span只能作用于Text的绘制区域。在字体颜色方面Span是优于我们设置的字体颜色的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment">  * 颜色相关</span></span><br><span class="line"><span class="comment">  * BackgroundColorSpan ： 背景颜色样式</span></span><br><span class="line"><span class="comment">  * ForegroundColorSpan ： 字体颜色</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">colorSpan</span><span class="params">()</span></span>&#123;</span><br><span class="line">     Spannable spannable = Spannable.Factory.getInstance().newSpannable(text);</span><br><span class="line">     BackgroundColorSpan backgroundColorSpan = <span class="keyword">new</span> BackgroundColorSpan(Color.parseColor(<span class="string">"#FF0000"</span>));</span><br><span class="line">     spannable.setSpan(backgroundColorSpan, <span class="number">0</span>, <span class="number">9</span>, Spanned.SPAN_INCLUSIVE_INCLUSIVE);</span><br><span class="line">     mTextView.setText(spannable);</span><br><span class="line"></span><br><span class="line">     Spannable spannable1 = Spannable.Factory.getInstance().newSpannable(text);</span><br><span class="line">     ForegroundColorSpan foregroundColorSpan = <span class="keyword">new</span> ForegroundColorSpan(Color.parseColor(<span class="string">"#FF0000"</span>));</span><br><span class="line">     spannable1.setSpan(foregroundColorSpan, <span class="number">0</span>, <span class="number">9</span>, Spanned.SPAN_INCLUSIVE_INCLUSIVE);</span><br><span class="line">     mTextView1.setText(spannable1);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-4、大小位置相关"><a href="#1-4、大小位置相关" class="headerlink" title="1.4、大小位置相关"></a>1.4、大小位置相关</h4><p>大小方面主要是RelativeSizeSpan，构造时传入一个数值来说明比较当前字体大小的变化，大于0为变大，小于0为变小<br>位置方面主要是上移（SuperscriptSpan），下移（SubscriptSpan），移动完成以后大小是不会变化的，上移距离为当前文本高度的一半，下一距离也是当前文本的一半。</p>
<p><img src="/2017/03/03/android-view-textview/06.png" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 大小相关</span></span><br><span class="line"><span class="comment">     * RelativeSizeSpan ：显示大小</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 位置相关</span></span><br><span class="line"><span class="comment">     * SuperscriptSpan ：上移</span></span><br><span class="line"><span class="comment">     * SubscriptSpan ： 下移</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sizeSpan</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Spannable spannable = Spannable.Factory.getInstance().newSpannable(text);</span><br><span class="line">        RelativeSizeSpan sizeSpanBig = <span class="keyword">new</span> RelativeSizeSpan(<span class="number">1.4f</span>);</span><br><span class="line">        RelativeSizeSpan sizeSpanSmall = <span class="keyword">new</span> RelativeSizeSpan(<span class="number">0.6f</span>);</span><br><span class="line">        spannable.setSpan(sizeSpanSmall, <span class="number">0</span>, <span class="number">9</span>, Spanned.SPAN_INCLUSIVE_INCLUSIVE);</span><br><span class="line">        spannable.setSpan(sizeSpanBig, <span class="number">11</span>, spannable.length(), Spanned.SPAN_INCLUSIVE_INCLUSIVE);</span><br><span class="line">        mTextView.setText(spannable);</span><br><span class="line"></span><br><span class="line">        Spannable SuperscriptSpanAble = Spannable.Factory.getInstance().newSpannable(text);</span><br><span class="line">        SuperscriptSpan sizeSpan = <span class="keyword">new</span> SuperscriptSpan();</span><br><span class="line">        SuperscriptSpanAble.setSpan(sizeSpan, <span class="number">12</span>, spannable.length(), Spanned.SPAN_INCLUSIVE_INCLUSIVE);</span><br><span class="line">        mTextView1.setText(SuperscriptSpanAble);</span><br><span class="line"></span><br><span class="line">        Spannable SubscriptSpanAble = Spannable.Factory.getInstance().newSpannable(text);</span><br><span class="line">        SubscriptSpan SubscriptSpan = <span class="keyword">new</span> SubscriptSpan();</span><br><span class="line">        SubscriptSpanAble.setSpan(SubscriptSpan, <span class="number">12</span>, spannable.length(), Spanned.SPAN_INCLUSIVE_INCLUSIVE);</span><br><span class="line">        mTextView2.setText(SubscriptSpanAble);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-5、常见样式相关"><a href="#1-5、常见样式相关" class="headerlink" title="1.5、常见样式相关"></a>1.5、常见样式相关</h4><p>常见样式有下划线，删除线，textStyle（粗体、斜体）。</p>
<p><img src="/2017/03/03/android-view-textview/07.png" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment">    * 样式相关：</span></span><br><span class="line"><span class="comment">    * StrikethroughSpan ： 删除线</span></span><br><span class="line"><span class="comment">    * UnderlineSpan ： 下划线</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * StyleSpan ： 一般样式</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">styleSpan</span><span class="params">()</span></span>&#123;</span><br><span class="line">       Spannable spannable = Spannable.Factory.getInstance().newSpannable(text);</span><br><span class="line">       StrikethroughSpan strikethroughSpan = <span class="keyword">new</span> StrikethroughSpan();</span><br><span class="line">       spannable.setSpan(strikethroughSpan, <span class="number">0</span>, <span class="number">9</span>, Spanned.SPAN_INCLUSIVE_INCLUSIVE);</span><br><span class="line">       mTextView.setText(spannable);</span><br><span class="line"></span><br><span class="line">       Spannable underlineSpanAble = Spannable.Factory.getInstance().newSpannable(text);</span><br><span class="line">       UnderlineSpan sizeSpan = <span class="keyword">new</span> UnderlineSpan();</span><br><span class="line">       underlineSpanAble.setSpan(sizeSpan, <span class="number">11</span>, spannable.length(), Spanned.SPAN_INCLUSIVE_INCLUSIVE);</span><br><span class="line">       mTextView1.setText(underlineSpanAble);</span><br><span class="line"></span><br><span class="line">       Spannable styleSpan = Spannable.Factory.getInstance().newSpannable(text);</span><br><span class="line">       StyleSpan styleSpan_Bold = <span class="keyword">new</span> StyleSpan(Typeface.BOLD);</span><br><span class="line">       StyleSpan styleSpan_Italic = <span class="keyword">new</span> StyleSpan(Typeface.ITALIC);</span><br><span class="line">       styleSpan.setSpan(styleSpan_Bold, <span class="number">0</span>, <span class="number">9</span>, Spanned.SPAN_INCLUSIVE_INCLUSIVE);</span><br><span class="line">       styleSpan.setSpan(styleSpan_Italic, <span class="number">11</span>, spannable.length(), Spanned.SPAN_INCLUSIVE_INCLUSIVE);</span><br><span class="line">       mTextView2.setText(styleSpan);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-6、跳转相关"><a href="#1-6、跳转相关" class="headerlink" title="1.6、跳转相关"></a>1.6、跳转相关</h4><p>常见的跳转相关有，点击事件，超链接。其实超链接的实现就是点击事件，只不过点击以后由当前手机的默认浏览器去打开。</p>
<p><img src="/2017/03/03/android-view-textview/08.gif" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ClickableSpan : 可点击的文字</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clickSpan</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Spannable spannable = Spannable.Factory.getInstance().newSpannable(text);</span><br><span class="line">        spannable.setSpan(<span class="keyword">new</span> ClickableSpan() &#123;</span><br><span class="line">                              <span class="meta">@Override</span></span><br><span class="line">                              <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View widget)</span> </span>&#123;</span><br><span class="line">                                  Toast.makeText(RichTextActivity.<span class="keyword">this</span>, <span class="string">"点击测试"</span>, Toast.LENGTH_LONG).show();</span><br><span class="line">                              &#125;</span><br><span class="line">                          &#125;,</span><br><span class="line">                <span class="number">9</span>, spannable.length(), Spanned.SPAN_INCLUSIVE_EXCLUSIVE);</span><br><span class="line">        mTextView.setMovementMethod(LinkMovementMethod.getInstance());</span><br><span class="line">        mTextView.setText(spannable);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Spannable spannableUrl = Spannable.Factory.getInstance().newSpannable(text);</span><br><span class="line">        URLSpan urlSpan = <span class="keyword">new</span> URLSpan(<span class="string">"http://blog.csdn.net/lpc_java?viewmode=list"</span>);</span><br><span class="line">        spannableUrl.setSpan(urlSpan, <span class="number">9</span>, spannable.length(), Spanned.SPAN_INCLUSIVE_INCLUSIVE);</span><br><span class="line">        mTextView1.setText(spannableUrl);</span><br><span class="line">        mTextView1.setMovementMethod(LinkMovementMethod.getInstance());</span><br><span class="line"></span><br><span class="line">        mTextView2.setVisibility(View.GONE);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：mTextView1.setMovementMethod(LinkMovementMethod.getInstance());必须设置TextView的MovementMethod才有点击效果</strong></p>
<h4 id="1-7、图片相关"><a href="#1-7、图片相关" class="headerlink" title="1.7、图片相关"></a>1.7、图片相关</h4><p>在文字当中使用图片，其实这个我们可以联想一下社交软件当中的聊天表情。</p>
<p><img src="/2017/03/03/android-view-textview/09.png" alt=""></p>
<p>在这里我们发现，是图片去替代了我们原有的文字，看客们在这里注意一下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 图片相关</span></span><br><span class="line"><span class="comment">     * ImageSpan</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">imageSpan</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Spannable spannableImgae = Spannable.Factory.getInstance().newSpannable(text);</span><br><span class="line">        Drawable image = <span class="keyword">this</span>.getResources().getDrawable(R.mipmap.star);</span><br><span class="line">        image.setBounds(<span class="number">0</span>,<span class="number">0</span>,<span class="number">60</span>,<span class="number">60</span>);</span><br><span class="line"></span><br><span class="line">        ImageSpan imageSpan = <span class="keyword">new</span> ImageSpan(image);</span><br><span class="line">        spannableImgae.setSpan(imageSpan, spannableImgae.length()-<span class="number">2</span>, spannableImgae.length(), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line">        mTextView.setText(spannableImgae);</span><br><span class="line"></span><br><span class="line">        mTextView1.setVisibility(View.GONE);</span><br><span class="line">        mTextView2.setVisibility(View.GONE);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>好了基本的几种在这里都已经说完</p>
<hr>
<h3 id="2-、其他方式实现富文本显示"><a href="#2-、其他方式实现富文本显示" class="headerlink" title="2 、其他方式实现富文本显示"></a>2 、其他方式实现富文本显示</h3><p>HTML,也可以实现上述的功能，就是把含有HTML标签的语句直接在TextView当中进行显示，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">html</span><span class="params">()</span></span>&#123;</span><br><span class="line">     String html = <span class="string">"测 &lt;br/&gt; 试 &lt;br/&gt; 文 &lt;br/&gt; 字 &lt;br/&gt;"</span> ;</span><br><span class="line">     mTextView.setText(Html.fromHtml(html));</span><br><span class="line"></span><br><span class="line">     String html1 = <span class="string">"&lt;h1&gt;标题&lt;/h1&gt;"</span> ;</span><br><span class="line">     mTextView1.setText(Html.fromHtml(html1));</span><br><span class="line"></span><br><span class="line">     String html2 = <span class="string">"&lt;font color ='#FF0000'&gt;测试文字&lt;/font&gt;"</span> ;</span><br><span class="line">     mTextView2.setText(Html.fromHtml(html2));</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2017/03/03/android-view-textview/10.png" alt=""></p>
<p>但是TextView对HTML的支持不是很全，下面就把TextView对HTML的支持列举一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">a href=&quot;...&quot;&gt;  定义链接内容</span><br><span class="line">b&gt;  定义粗体文字   b 是blod的缩写</span><br><span class="line">big&gt;  定义大字体的文字</span><br><span class="line">blockquote&gt;  引用块标签 </span><br><span class="line">属性:</span><br><span class="line">Common  -- 一般属性</span><br><span class="line">cite  -- 被引用内容的URI</span><br><span class="line">br&gt;   定义换行</span><br><span class="line">cite&gt;   表示引用的URI</span><br><span class="line">dfn&gt;   定义标签  dfn 是defining instance的缩写</span><br><span class="line">div align=&quot;...&quot;&gt;</span><br><span class="line">em&gt;  强调标签  em 是emphasis的缩写</span><br><span class="line">font size=&quot;...&quot; color=&quot;...&quot; face=&quot;...&quot;&gt;</span><br><span class="line">h1&gt;</span><br><span class="line">h2&gt;</span><br><span class="line">h3&gt;</span><br><span class="line">h4&gt;</span><br><span class="line">h5&gt;</span><br><span class="line">h6&gt;</span><br><span class="line">i&gt;   定义斜体文字</span><br><span class="line">img src=&quot;...&quot;&gt;</span><br><span class="line">p&gt;     段落标签,里面可以加入文字,列表,表格等</span><br><span class="line">small&gt;  定义小字体的文字</span><br><span class="line">strike&gt;   定义删除线样式的文字   不符合标准网页设计的理念,不赞成使用.   strike是strikethrough的缩写</span><br><span class="line">strong&gt;   重点强调标签</span><br><span class="line">sub&gt;   下标标签   sub 是subscript的缩写</span><br><span class="line">sup&gt;   上标标签   sup 是superscript的缩写</span><br><span class="line">tt&gt;   定义monospaced字体的文字  不赞成使用.  此标签对中文没意义  tt是teletype or monospaced text style的意思</span><br><span class="line">u&gt;   定义带有下划线的文字  u是underlined text style的意思</span><br></pre></td></tr></table></figure>
<p>笔者在这里把第一个 &lt; 取消啦 因为格式会乱，相信各位看客也能理解</p>
<h2 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h2><p>在此 算是结束啦 在这里附上源码链接，<br><a href="https://github.com/myLiupengcheng/PullDownTextView" target="_blank" rel="noopener">源码下载</a></p>
<p>参考文献<br><a href="https://developer.android.com/reference/android/text/Spannable.html" target="_blank" rel="noopener">https://developer.android.com/reference/android/text/Spannable.html</a><br><a href="https://developer.android.com/reference/android/text/style/CharacterStyle.html" target="_blank" rel="noopener">https://developer.android.com/reference/android/text/style/CharacterStyle.html</a><br><a href="https://developer.android.com/reference/android/text/style/ParagraphStyle.html" target="_blank" rel="noopener">https://developer.android.com/reference/android/text/style/ParagraphStyle.html</a><br><a href="https://github.com/Manabu-GT/ExpandableTextView" target="_blank" rel="noopener">https://github.com/Manabu-GT/ExpandableTextView</a></p>
<p><a href="http://www.jianshu.com/p/84067ad289d2" target="_blank" rel="noopener">http://www.jianshu.com/p/84067ad289d2</a><br><a href="http://www.jianshu.com/p/aa53ee98d954" target="_blank" rel="noopener">http://www.jianshu.com/p/aa53ee98d954</a><br><a href="http://2960629.blog.51cto.com/2950629/751360" target="_blank" rel="noopener">http://2960629.blog.51cto.com/2950629/751360</a><br><a href="https://juejin.im/entry/5729d28f1ea49300606854c9" target="_blank" rel="noopener">https://juejin.im/entry/5729d28f1ea49300606854c9</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/03/android-view-textview/" data-id="ck2opn4kt00370mewetf57jv5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/控件/">控件</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android-view-webView01" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/02/android-view-webView01/" class="article-date">
  <time datetime="2017-03-02T08:06:27.000Z" itemprop="datePublished">2017-03-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/02/android-view-webView01/">webView的简单使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>###</p>
<p>是基于Android使用了WebKit内核的浏览器框架，和其他组件没有什么区别，主要作用就是加载一些基于HTML页面的基本信息</p>
<h4 id="为什么使用WebView"><a href="#为什么使用WebView" class="headerlink" title="为什么使用WebView"></a>为什么使用WebView</h4><h5 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h5><ul>
<li>1、兼容已有的项目  例如淘宝</li>
<li>2、可以动态更新  BUG的处理</li>
</ul>
<p>基于以上好处，人们开始思考是否可以通过WebView去替代原有的Native原生开发。于是FaceBook去研究通过WebView去代替原有的Native开发，但是好景不长，facebook发现了WebView不是想象当中的那么好用，发现了如下缺点。</p>
<h5 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a>缺点：</h5><ul>
<li>1、使用webView的App统一耗电量都比较庞大</li>
<li>2、使用WebView的APP的加载速度也比较卡，</li>
<li>3、由于耗电量比较大导致手机容特别容易发热</li>
</ul>
<hr>
<h3 id="WebView基本去使用"><a href="#WebView基本去使用" class="headerlink" title="WebView基本去使用"></a>WebView基本去使用</h3><p>其实Google把相应的方式都封装在相应的WebKit内核当中所以对于客户端的我们来说我们只需要创建WebView的对象，通过该对象的loadUrl（String url）方法去加载即可。</p>
<p>1、在XMl布局文件当中引入WebView</p>
<p>activity_main.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">WebView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/webView"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、在MainActivity当中对WebView控件进行设置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> WebView mWebView;</span><br><span class="line"><span class="keyword">private</span> String mUrl = <span class="string">"http://www.baidu.com"</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">    initView();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化控件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    mWebView = (WebView) findViewById(R.id.webView);</span><br><span class="line">    mWebView.loadUrl(mUrl);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果就是当我们的应用程序跑起来以后我们的WebView回去通过浏览器去加载我们的网页，所以我们去对WebView进行设置防止通过浏览器去进行加载</p>
<p>这个时候我们就需要自己去定义一个WebViewClient</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> mWebView.setWebViewClient(<span class="keyword">new</span> WebViewClient()&#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 覆盖原有的加载方式</span></span><br><span class="line"><span class="comment">             * 如果没有给WebView设置WebViewClient，默认情况下WebView会要求Activity Manager选择URL的正确处理程序（浏览器）</span></span><br><span class="line"><span class="comment">             * 如果给WebView设置WebViewClient，</span></span><br><span class="line"><span class="comment">             * 注意：使用POST“方法”的请求不会调用此方法。</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> view ： WebView</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> url ：请求地址</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@return</span> ：返回true，表示主机应用程序处理url，而return false则表示当前WebView处理URL。</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line"><span class="comment">//            @Override</span></span><br><span class="line"><span class="comment">//            public boolean shouldOverrideUrlLoading(WebView view, WebResourceRequest request) &#123;</span></span><br><span class="line"><span class="comment">//                view.loadUrl(request.getUrl().toString());</span></span><br><span class="line"><span class="comment">//                return super.shouldOverrideUrlLoading(view, request);</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> </span>&#123;</span><br><span class="line">                view.loadUrl(url);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.shouldOverrideUrlLoading(view, url);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="WebView自定义Title"><a href="#WebView自定义Title" class="headerlink" title="WebView自定义Title"></a>WebView自定义Title</h3><p>我们手机在显示WebView的时候会在标题的位置去显示当前加载的网页的地址之类的信息。</p>
<p>1、我们去修改XML布局，添加要显示地址的View</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/back"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"返回"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/title"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_centerInParent</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/refresh"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_alignParentRight</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"刷新"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">WebView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/webView"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、对WebView控件进行设置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> pengchengliu.imooc.webview;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.graphics.Bitmap;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.webkit.WebChromeClient;</span><br><span class="line"><span class="keyword">import</span> android.webkit.WebView;</span><br><span class="line"><span class="keyword">import</span> android.webkit.WebViewClient;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String TAG = <span class="string">"WebViewTag"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> WebView mWebView;</span><br><span class="line">    Button mBackButton, mRefreshButton;</span><br><span class="line">    <span class="keyword">private</span> TextView mTitleTextView;</span><br><span class="line">    String mUrl = <span class="string">"https://www.baidu.com"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        Log.i(TAG ,<span class="string">"Activity创建，"</span> + <span class="string">"线程Id为"</span> + Thread.currentThread().getId());</span><br><span class="line">        initView();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化控件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        findView();</span><br><span class="line">        mWebView.setWebViewClient(<span class="keyword">new</span> WebViewClient()&#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 页面可以试加载的时候进行回调。</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageStarted</span><span class="params">(WebView view, String url, Bitmap favicon)</span> </span>&#123;</span><br><span class="line">                Log.i(TAG ,<span class="string">"页面开始加载，"</span> + <span class="string">"线程Id为"</span> + Thread.currentThread().getId());</span><br><span class="line">                <span class="keyword">super</span>.onPageStarted(view, url, favicon);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 页面用户可见的时候进行回调</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageCommitVisible</span><span class="params">(WebView view, String url)</span> </span>&#123;</span><br><span class="line">                Log.i(TAG ,<span class="string">"页面开始加载，"</span> + <span class="string">"线程Id为"</span> + Thread.currentThread().getId());</span><br><span class="line">                <span class="keyword">super</span>.onPageCommitVisible(view, url);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 页面加载完成的时候进行回调</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageFinished</span><span class="params">(WebView view, String url)</span> </span>&#123;</span><br><span class="line">                Log.i(TAG ,<span class="string">"页面加载完成，"</span> + <span class="string">"线程Id为"</span> + Thread.currentThread().getId());</span><br><span class="line">                <span class="keyword">super</span>.onPageFinished(view, url);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 覆盖原有的加载方式</span></span><br><span class="line"><span class="comment">             * 如果没有给WebView设置WebViewClient，默认情况下WebView会要求Activity Manager选择URL的正确处理程序（浏览器）</span></span><br><span class="line"><span class="comment">             * 如果给WebView设置WebViewClient，</span></span><br><span class="line"><span class="comment">             * 注意：使用POST“方法”的请求不会调用此方法。</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> view ： WebView</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> url ：请求地址</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@return</span> ：返回true，表示主机应用程序处理url，而return false则表示当前WebView处理URL。</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line"><span class="comment">//            @Override</span></span><br><span class="line"><span class="comment">//            public boolean shouldOverrideUrlLoading(WebView view, WebResourceRequest request) &#123;</span></span><br><span class="line"><span class="comment">//                view.loadUrl(request.getUrl().toString());</span></span><br><span class="line"><span class="comment">//                return super.shouldOverrideUrlLoading(view, request);</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> </span>&#123;</span><br><span class="line">                view.loadUrl(url);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.shouldOverrideUrlLoading(view, url);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        mWebView.setWebChromeClient(<span class="keyword">new</span> WebChromeClient()&#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 通知主机应用程序更改文档标题。</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> view 启动回调的WebView。</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> title 包含文档的新标题的字符串。</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedTitle</span><span class="params">(WebView view, String title)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//在主线程当中，可以直接更新UI</span></span><br><span class="line">                mTitleTextView.setText(title);</span><br><span class="line">                <span class="keyword">super</span>.onReceivedTitle(view, title);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        mWebView.loadUrl(mUrl);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过ID查找View</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">findView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mWebView = (WebView) findViewById(R.id.webView);</span><br><span class="line">        mBackButton = (Button) findViewById(R.id.back);</span><br><span class="line">        mRefreshButton = (Button) findViewById(R.id.refresh);</span><br><span class="line">        mTitleTextView = (TextView) findViewById(R.id.title);</span><br><span class="line">        MyListener myListener = <span class="keyword">new</span> MyListener();</span><br><span class="line">        mBackButton.setOnClickListener(myListener);</span><br><span class="line">        mRefreshButton.setOnClickListener(myListener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 按钮监听事件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyListener</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">switch</span> (v.getId())&#123;</span><br><span class="line">                <span class="keyword">case</span> R.id.back:</span><br><span class="line">                    <span class="comment">//可以通过这个方法去重新加载</span></span><br><span class="line">                    mWebView.goBack();</span><br><span class="line">                    Log.i(TAG, mWebView.getUrl());</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> R.id.refresh:</span><br><span class="line">                    mWebView.reload();</span><br><span class="line">                    <span class="comment">//mWebView.goForward();//前进</span></span><br><span class="line">                    <span class="comment">//mWebView.reload();  //刷新</span></span><br><span class="line">                    Log.i(TAG, mWebView.getUrl());</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="使用WebView去下载文件"><a href="#使用WebView去下载文件" class="headerlink" title="使用WebView去下载文件"></a>使用WebView去下载文件</h3><p>在下载之前必须要获取到文件的地址，需要DownloadListener接口的实现类，重写他的方法，而下载的具体url遍会出现在它的参数当中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * WebView下载的监听器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">WebViewDownload</span> <span class="keyword">implements</span> <span class="title">DownloadListener</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过WebView去下载文件时所需要的监听器</span></span><br><span class="line"><span class="comment">     * 通知主机应用程序应该下载文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url应该下载的内容的完整网址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userAgent要用于下载的用户代理。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentDisposition Content-disposition http header，if当下。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mimetype服务器报告的内容的mimetype</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentLength服务器报告的文件大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDownloadStart</span><span class="params">(String url, String userAgent, String contentDisposition, String mimetype, <span class="keyword">long</span> contentLength)</span> </span>&#123;</span><br><span class="line">        Log.i(<span class="string">"haha"</span>, <span class="string">"这是一个下载地址, url ------ &gt; "</span> + url);</span><br><span class="line">        <span class="keyword">if</span>(!url.endsWith(<span class="string">".apk"</span>))&#123;</span><br><span class="line">            Log.i(<span class="string">"haha"</span>, <span class="string">"下载文件不是apk文件"</span>);</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">new</span> DownloadThread(url).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>主要就是两种方式，</p>
<h5 id="1、通过WebView获取将要下载的文件地址，然后通过Intent将要下载的Uri地址传过去，让系统自己为我们下载。"><a href="#1、通过WebView获取将要下载的文件地址，然后通过Intent将要下载的Uri地址传过去，让系统自己为我们下载。" class="headerlink" title="1、通过WebView获取将要下载的文件地址，然后通过Intent将要下载的Uri地址传过去，让系统自己为我们下载。"></a>1、通过WebView获取将要下载的文件地址，然后通过Intent将要下载的Uri地址传过去，让系统自己为我们下载。</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Uri uri = Uri.parse(url);</span><br><span class="line">Intent intent = <span class="keyword">new</span> Intent(Intent.ACTION_VIEW, uri);</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure>
<h5 id="2、通过WebView获取将要下载的文件地址，然后自己新建一个线程去进行下载。"><a href="#2、通过WebView获取将要下载的文件地址，然后自己新建一个线程去进行下载。" class="headerlink" title="2、通过WebView获取将要下载的文件地址，然后自己新建一个线程去进行下载。"></a>2、通过WebView获取将要下载的文件地址，然后自己新建一个线程去进行下载。</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String url ;</span><br><span class="line"></span><br><span class="line">    DownloadThread(String url)&#123;</span><br><span class="line">        <span class="keyword">this</span>.url = url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Log.i(<span class="string">"haha"</span>, <span class="string">"开始下载"</span>);</span><br><span class="line">            URL url = <span class="keyword">new</span> URL(<span class="keyword">this</span>.url);</span><br><span class="line">            HttpURLConnection connect = (HttpURLConnection) url.openConnection();</span><br><span class="line">            connect.setDoInput(<span class="keyword">true</span>);</span><br><span class="line">            connect.setDoOutput(<span class="keyword">true</span>);</span><br><span class="line">            InputStream inputStream = connect.getInputStream();</span><br><span class="line">            <span class="keyword">if</span>(!Environment.getExternalStorageState().equals(Environment.MEDIA_MOUNTED))&#123;</span><br><span class="line">                Log.e(<span class="string">"haha"</span>, <span class="string">"不存在SD卡，或者外部存储空间不足"</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            File descFile = Environment.getExternalStorageDirectory();</span><br><span class="line">            File srcFile = <span class="keyword">new</span> File(descFile, <span class="string">"temp.apk"</span>);</span><br><span class="line">            OutputStream outputStream = <span class="keyword">new</span> FileOutputStream(srcFile);</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">6</span> * <span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">int</span> len ;</span><br><span class="line">            <span class="keyword">while</span>((len = inputStream.read(bytes)) != -<span class="number">1</span>)&#123;</span><br><span class="line">                outputStream.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">                Log.i(<span class="string">"haha"</span>, <span class="string">"0,~~~"</span> + len);</span><br><span class="line">            &#125;</span><br><span class="line">            Log.i(<span class="string">"haha"</span>, <span class="string">"下载成功"</span>);</span><br><span class="line">        &#125;  <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            Log.i(<span class="string">"haha"</span>, <span class="string">"下载失败"</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="WebView对错误页面的处理"><a href="#WebView对错误页面的处理" class="headerlink" title="WebView对错误页面的处理"></a>WebView对错误页面的处理</h3><p>在手机没有网络的情况下，WebView会默认给我们展示一个断网页面，但是对于一个商业项目来说，展示这个页面略显粗糙，我们如何自定义错误页面呢？有以下两种方法</p>
<ul>
<li>1、还在本地错误页面，但是还属于HTML页面</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedError</span><span class="params">(WebView view, WebResourceRequest request, WebResourceError error)</span> </span>&#123;</span><br><span class="line">           <span class="comment">//加载本地资源</span></span><br><span class="line">           mWebView.loadData(file:<span class="comment">//xxx.xxx.xxx);</span></span><br><span class="line">           <span class="keyword">super</span>.onReceivedError(view, request, error);</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>2、加载一个本地的Native页面，在相应的WebViewClient内部重写监听WebView加载错误的回调，然后在错误回调当中去做相应的处理。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mWebView.setWebViewClient(<span class="keyword">new</span> WebViewClient()&#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 当WebView出现错误的时候进行回调。一般用来进行错误页面的重写，</span></span><br><span class="line"><span class="comment">             * 向主机应用程序报告Web资源加载错误。 这些错误通常表示无法连接到服务器。 请注意，与回拨版本不同的是，</span></span><br><span class="line"><span class="comment">             * 新版本将被调用任何资源（iframe，image等），而不仅仅是为主页面。 因此，建议在此回调中执行最低要求的工作。</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> view 启动回调的WebView。</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> request 请求发起请求。</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> error 错误有关错误的信息。</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedError</span><span class="params">(WebView view, WebResourceRequest request, WebResourceError error)</span> </span>&#123;</span><br><span class="line">                Log.i(<span class="string">"xixi"</span> ,<span class="string">"onReceivedError，"</span>);</span><br><span class="line">                mErrorTextView .setText(<span class="string">"404有错误"</span>);</span><br><span class="line">                mWebView.setVisibility(View.GONE);</span><br><span class="line">                <span class="keyword">super</span>.onReceivedError(view, request, error);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="WebView如何同步Cookie问题"><a href="#WebView如何同步Cookie问题" class="headerlink" title="WebView如何同步Cookie问题"></a>WebView如何同步Cookie问题</h3><p>开发过程中如果我们已经让用户登陆过了，在另外的页面是WebView，在刷到最新的WebView的时候会提示用户重新登录，但是如果我们把登录信息保存在Cookie当中，在刷WebView的时候一起传递给服务器，这样遍不会提示用户重新登录了。</p>
<p>这种问题就是客户端和服务器去同步Cookie问题。</p>
<p>流程就是：客户端先去登录，登录以后可以拿到相应的Cookie信息，当我们去第二次进行登陆的时候，拿着我们第一次登录Cookie信息，去设置相应的Cookie，已达到免登录的状态</p>
<p>问题 ： 如何通过JavaAPI去进行POST请求，然后根据相应的POST请求拿到相应的Cookie，然后如何通过设置Cookie给WebView进行相应的设置，以至于达到免登录的状态</p>
<p>如何进行POST请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">CookieStore cookieStore = <span class="keyword">new</span> BasicCookieStore();</span><br><span class="line">CloseableHttpClient client = HttpClientBuilder.create().setDefaultCookieStore(cookieStore).build();</span><br><span class="line">HttpPost httpPost = <span class="keyword">new</span> HttpPost(requestUrl);</span><br><span class="line"></span><br><span class="line">List&lt;NameValuePair&gt; params = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">NameValuePair name = <span class="keyword">new</span> BasicNameValuePair(<span class="string">""</span>,<span class="string">""</span>);</span><br><span class="line">NameValuePair password = <span class="keyword">new</span> BasicNameValuePair(<span class="string">""</span>,<span class="string">""</span>);</span><br><span class="line">params.add(name);params.add(password);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(params.size() &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">UrlEncodedFormEntity entity = <span class="keyword">new</span> UrlEncodedFormEntity(params, charset);</span><br><span class="line">httpPost.setEntity(entity);</span><br><span class="line">CloseableHttpResponse execute = client.execute(httpPost);</span><br></pre></td></tr></table></figure>
<p>如何获取Cookie</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (execute.getStatusLine().getStatusCode() == <span class="number">200</span>)&#123;</span><br><span class="line">    List&lt;Cookie&gt; cookies = cookieStore.getCookies();</span><br><span class="line">    <span class="keyword">for</span> (Cookie tempCookie : cookies) &#123;</span><br><span class="line">        Log.i(<span class="string">"cookies"</span>, tempCookie.getName() + <span class="string">": "</span> + tempCookie.getValue() );</span><br><span class="line">        <span class="comment">//使用Handler</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如何给WebView设置Cookie</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Handler mHandler = <span class="keyword">new</span> Handler()&#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">          CookieSyncManager.createInstance(MainActivity.<span class="keyword">this</span>);</span><br><span class="line">          CookieManager manager = CookieManager.getInstance();</span><br><span class="line">          manager.setAcceptCookie(<span class="keyword">true</span>);</span><br><span class="line">          manager.setCookie(mUrl, msg.obj.toString());</span><br><span class="line">          CookieSyncManager.getInstance().sync();</span><br><span class="line"></span><br><span class="line">          mWebView.loadUrl(mUrl);</span><br><span class="line">          <span class="keyword">super</span>.handleMessage(msg);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="WebView和JS混淆回调"><a href="#WebView和JS混淆回调" class="headerlink" title="WebView和JS混淆回调"></a>WebView和JS混淆回调</h4><p>首先我们应该明白，在正常的情况下WebView和JS是可以相互调用的通过@JavaScriptIntface注解，但是在我们的apk上线的时候我们需要给我们的apk打入一个replase包，让我们的apk当中的代码混淆，这样就会使我们原有的JS调不到我们的android端的接口。</p>
<p>解决方案：就是在打入混淆的时候，对我们要给Js回调的类和方法进行保护，这样当前类就不能混淆了。</p>
<p>在当前项目里面的proguard.cfg文件当中加入如下代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-keep public class com.example.webview_01.WebHost&#123;</span><br><span class="line">    public &lt;methods&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所涉及到的知识点：</p>
<ul>
<li>1、如何对一个project的apk打入replase包，使得当前项目apk混淆<br><a href="http://www.cnblogs.com/bugly/p/7085469.html" target="_blank" rel="noopener">http://www.cnblogs.com/bugly/p/7085469.html</a></li>
<li>2、如何通过Java代码给JS暴露回调方法。</li>
</ul>
<p>WebHost.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 当前类为暴露给JS用户的接口</span></span><br><span class="line"><span class="comment"> * Created by pengchengliu on 2017/8/13.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebHost</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Context mContext;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WebHost</span><span class="params">(Context context)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mContext = context;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callJs</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Toast.makeText(mContext, <span class="string">"12334"</span>, Toast.LENGTH_LONG).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MainActivity.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Java 暴露给 Js 回调接口</span><br><span class="line"> */</span><br><span class="line">@SuppressLint(&quot;AddJavascriptInterface&quot;)</span><br><span class="line">private void setWebViewJavaScriptInterface() &#123;</span><br><span class="line">    WebSettings settings = mWebView.getSettings();</span><br><span class="line">    settings.setJavaScriptEnabled(true);</span><br><span class="line">    mWebView.addJavascriptInterface(new WebHost(MainActivity.this),&quot;callJs&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="WebView导致的远程注入的问题"><a href="#WebView导致的远程注入的问题" class="headerlink" title="WebView导致的远程注入的问题"></a>WebView导致的远程注入的问题</h3><p>在android本地和js交互的途中会出现种种的注入问题，大体的流程就是我们把客户端的对象暴露给了服务器，服务器当中可以拿到我们暴露给它的对象，拿到这个对象，服务器就可以拿到我们本地的Runtime对象，就哭执行种种命令来获取我们本地的信息。Google也是意识到这样的危险性，所以在版本4.2之前就已经被修复，浏览器厂商也是做了相应的BUG修复，但是在开发者做WebView的时候，需要注意。</p>
<p>解决办法：尽可能少的去做Java和JS之间的交互，最好的就是通过自定义协议来处理相应的问题。</p>
<hr>
<h3 id="WebView自定义协议拦截问题"><a href="#WebView自定义协议拦截问题" class="headerlink" title="WebView自定义协议拦截问题"></a>WebView自定义协议拦截问题</h3><p>就是客户端人员和Web前端人员进行商议得到一个协议，然后就是通过Url上面带有不同的参数在Android里面的回调根据不同的参数进行不同的参数，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 覆盖原有的加载方式</span></span><br><span class="line"><span class="comment"> * 如果没有给WebView设置WebViewClient，默认情况下WebView会要求Activity Manager选择URL的正确处理程序（浏览器）</span></span><br><span class="line"><span class="comment"> * 如果给WebView设置WebViewClient，</span></span><br><span class="line"><span class="comment"> * 注意：使用POST“方法”的请求不会调用此方法。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> view ： WebView</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> url ：请求地址</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> ：返回true，表示主机应用程序处理url，而return false则表示当前WebView处理URL。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//xxxxx就是约定的协议</span></span><br><span class="line">    <span class="keyword">if</span>(url.endsWith(<span class="string">"xxxxxxx"</span>))&#123;</span><br><span class="line">        <span class="comment">//做相应的操作</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>；</span><br><span class="line">    &#125;</span><br><span class="line">    view.loadUrl(url);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.shouldOverrideUrlLoading(view, url);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/02/android-view-webView01/" data-id="ck2opn4kv00390mew61uoh88e" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/控件/">控件</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-protocol-http03" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/12/09/protocol-http03/" class="article-date">
  <time datetime="2016-12-09T07:54:38.000Z" itemprop="datePublished">2016-12-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/协议/">协议</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/12/09/protocol-http03/">Http03 - Http状态码</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="Http的状态码表示客户端请求服务器的返回结果，标记服务器端的处理是否正常，通知客户端出现错误的情况，"><a href="#Http的状态码表示客户端请求服务器的返回结果，标记服务器端的处理是否正常，通知客户端出现错误的情况，" class="headerlink" title="Http的状态码表示客户端请求服务器的返回结果，标记服务器端的处理是否正常，通知客户端出现错误的情况，"></a>Http的状态码表示客户端请求服务器的返回结果，标记服务器端的处理是否正常，通知客户端出现错误的情况，</h4><hr>
<h3 id="学习目标"><a href="#学习目标" class="headerlink" title="学习目标"></a>学习目标</h3><ul>
<li>状态码的类别定义</li>
<li>2XX成功</li>
<li>3XX重定向</li>
<li>4XX客户端错误</li>
<li>5XX服务器错误</li>
<li>状态码和状况不一致</li>
</ul>
<hr>
<h2 id="状态码的类别定义"><a href="#状态码的类别定义" class="headerlink" title="状态码的类别定义"></a>状态码的类别定义</h2><p>状态码如 200 OK 以3位数字和原因短句组成，接下来我们就来看看14种常用的状态码</p>
<blockquote>
<p>补充：在RFC2616中定义的Http状态码就达到40多种，再加上WebDAV，就达到60多种。</p>
</blockquote>
<hr>
<h2 id="2XX-成功"><a href="#2XX-成功" class="headerlink" title="2XX 成功"></a>2XX 成功</h2><ul>
<li><h4 id="200-ok"><a href="#200-ok" class="headerlink" title="200 ok"></a>200 ok</h4><p>  表示从从客户端发来的请求已经被正常处理了</p>
</li>
<li><h4 id="204-No-Content"><a href="#204-No-Content" class="headerlink" title="204 No Content"></a>204 No Content</h4><p>  请求处理成功，但是没有资源可返回</p>
</li>
<li><h4 id="206-Partial-Content"><a href="#206-Partial-Content" class="headerlink" title="206 Partial Content"></a>206 Partial Content</h4><p>  客户端对服务器端进行一部分资源请求的时候，返回，并且客户端的请求处理成功</p>
</li>
</ul>
<hr>
<h2 id="3XX-重定向"><a href="#3XX-重定向" class="headerlink" title="3XX 重定向"></a>3XX 重定向</h2><blockquote>
<h4 id="响应结果表明浏览器需要执行某些特殊的处以正确处理请求"><a href="#响应结果表明浏览器需要执行某些特殊的处以正确处理请求" class="headerlink" title="响应结果表明浏览器需要执行某些特殊的处以正确处理请求"></a>响应结果表明浏览器需要执行某些特殊的处以正确处理请求</h4></blockquote>
<ul>
<li><h4 id="301-Moved-Permanently"><a href="#301-Moved-Permanently" class="headerlink" title="301 Moved Permanently"></a>301 Moved Permanently</h4><p>  永久性重定向，该状态码已被分配了新的URI，以后应使用资源现在所指的URI。</p>
</li>
<li><h4 id="302-Found"><a href="#302-Found" class="headerlink" title="302 Found"></a>302 Found</h4><p>  临时重定向。该状态码表示请求资源已被分配了新的URI，希望用户（本次）能使用新的URI访问</p>
</li>
</ul>
<hr>
<h2 id="4XX-客户端错误"><a href="#4XX-客户端错误" class="headerlink" title="4XX 客户端错误"></a>4XX 客户端错误</h2><blockquote>
<h4 id="表示客户端是发生错误的原因所在"><a href="#表示客户端是发生错误的原因所在" class="headerlink" title="表示客户端是发生错误的原因所在"></a>表示客户端是发生错误的原因所在</h4></blockquote>
<ul>
<li><h4 id="400-Bad-Request"><a href="#400-Bad-Request" class="headerlink" title="400 Bad Request"></a>400 Bad Request</h4><p>  表示请求报文中存在语法错误。当错误发生的时候，需要修改请求的内容后再次发送请求。另外浏览器方面会像对待200 OK 一样对待该状态码</p>
</li>
<li><h4 id="401-Unauthorized"><a href="#401-Unauthorized" class="headerlink" title="401 Unauthorized"></a>401 Unauthorized</h4><p>  表示发送的请求需要Http认证(BASIC认证、DIGEST认证)的认证信息。若之前已经进行过1次认证，则表示用户认证失败</p>
<p>  返回含有401的响应必须包含一个适用于请求资源WWW-Authenticate首部用以质问用户信息。当浏览器第一次收到401响应，会默认弹出认证用的对话窗口</p>
</li>
<li><h4 id="403-Forbidden"><a href="#403-Forbidden" class="headerlink" title="403 Forbidden"></a>403 Forbidden</h4><p>  表示请求资源的访问被服务器拒绝。服务器没有必要给出拒绝的详细理由，但如果想作说明的话，可以在实体的主体部分对原因进行描述，这样就能让用户看到了</p>
<p>  未获得文件系统的访问授权，访问权限出现某些问题(从未授权的发送源IP地址试图访问)等列举的情况都可能发生403的原因</p>
</li>
<li><h4 id="404-No-Found"><a href="#404-No-Found" class="headerlink" title="404 No Found"></a>404 No Found</h4><p>  表示客户端请求的资源在服务器端找不到，或者在拒绝客户端请求访问，并且不想给出说明理由的时候使用该状态码！</p>
</li>
</ul>
<hr>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/12/09/protocol-http03/" data-id="ck2opn4ix000l0mewr9kmt6e5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/http/">http</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/协议/">协议</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
  </nav>
</section>
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <a href="/" class="logo">刘鹏程</a>
      &copy; 2019 刘鹏程<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    

<script src="/js/jquery.min.js"></script>
<script src="/js/jquery.scrollLoading.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>