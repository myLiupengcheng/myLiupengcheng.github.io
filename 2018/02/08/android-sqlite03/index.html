<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Android数据库（3）、Android对SQLite数据库的支持 | 刘鹏程</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Android官方默认的数据库就是SQLite数据库，并且相应的Android API 也对SQLite数据做了一定的支持，下面主要通过四个方面来了解一下，具体在Android的程序代码当中如何使用相应的数据库。 一、创建数据库，（SQLiteOpenHelper）Android系统当中，数据库其实就是一个文件系统的文件，不过这个文件是以DB结尾的文件。创建数据库，主要分为两种，就是使用默认的SQ">
<meta name="keywords" content="数据库">
<meta property="og:type" content="article">
<meta property="og:title" content="Android数据库（3）、Android对SQLite数据库的支持">
<meta property="og:url" content="http://yoursite.com/2018/02/08/android-sqlite03/index.html">
<meta property="og:site_name" content="刘鹏程">
<meta property="og:description" content="Android官方默认的数据库就是SQLite数据库，并且相应的Android API 也对SQLite数据做了一定的支持，下面主要通过四个方面来了解一下，具体在Android的程序代码当中如何使用相应的数据库。 一、创建数据库，（SQLiteOpenHelper）Android系统当中，数据库其实就是一个文件系统的文件，不过这个文件是以DB结尾的文件。创建数据库，主要分为两种，就是使用默认的SQ">
<meta property="og:locale" content="中文">
<meta property="og:updated_time" content="2018-07-21T12:45:14.037Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android数据库（3）、Android对SQLite数据库的支持">
<meta name="twitter:description" content="Android官方默认的数据库就是SQLite数据库，并且相应的Android API 也对SQLite数据做了一定的支持，下面主要通过四个方面来了解一下，具体在Android的程序代码当中如何使用相应的数据库。 一、创建数据库，（SQLiteOpenHelper）Android系统当中，数据库其实就是一个文件系统的文件，不过这个文件是以DB结尾的文件。创建数据库，主要分为两种，就是使用默认的SQ">
  
  
    <link rel="icon" href="/favicon.png">
  
  <!-- <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'> -->
  <!-- <link href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css"> -->
  <link href="//fonts.useso.com/css?family=Source+Code+Pro:400,700" rel="stylesheet" type="text/css">
  <link href='//fonts.useso.com/css?family=Open+Sans:300,600' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/css/style.css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <a href="/" class="logo">刘鹏程</a>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about/index.html">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
        </div>
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
        
        
          <a id="nav-github-link" class="nav-icon" href="https://github.com/ppoffice/hexo-theme-alex" title="Fork me on GitHub"></a>
        
      </nav>
    </div>
  </div>
</header>
      <nav id="mobile-nav" class="off">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about/index.html" class="mobile-nav-link">About</a>
  
  <div id="search-form-wrap-mobile">
    <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
  </div>
</nav>
      <div class="outer">
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JVM/">JVM</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/协议/">协议</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/并发/">并发</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构/">数据结构</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/06/15/thread-tools-delayQueue/">线程延时队列DelayQueue</a>
          </li>
        
          <li>
            <a href="/2018/06/15/JVM-outofMemroyError-02/">JVM学习2 - OutOfMemroyError***</a>
          </li>
        
          <li>
            <a href="/2018/06/03/JVM-memory-01/">JVM学习1 - 内存区域</a>
          </li>
        
          <li>
            <a href="/2018/05/29/thread-tools-CyclicBarrier/">线程同步工具类CyclicBarrier</a>
          </li>
        
          <li>
            <a href="/2018/05/29/thread-tools-CountDownLatch/">线程同步工具类CountDownLatch</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/">JVM</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OutOfMemroy/">OutOfMemroy</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/关于博主/">关于博主</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/协议/">协议</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/并发/">并发</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/控件/">控件</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/绘图技巧/">绘图技巧</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JVM/" style="font-size: 13.33px;">JVM</a> <a href="/tags/OutOfMemroy/" style="font-size: 10px;">OutOfMemroy</a> <a href="/tags/http/" style="font-size: 16.67px;">http</a> <a href="/tags/关于博主/" style="font-size: 10px;">关于博主</a> <a href="/tags/协议/" style="font-size: 16.67px;">协议</a> <a href="/tags/并发/" style="font-size: 20px;">并发</a> <a href="/tags/控件/" style="font-size: 16.67px;">控件</a> <a href="/tags/数据库/" style="font-size: 16.67px;">数据库</a> <a href="/tags/数据结构/" style="font-size: 13.33px;">数据结构</a> <a href="/tags/算法/" style="font-size: 13.33px;">算法</a> <a href="/tags/绘图技巧/" style="font-size: 16.67px;">绘图技巧</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">links</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://hexo.io">Hexo</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
        <section id="main"><article id="post-android-sqlite03" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/08/android-sqlite03/" class="article-date">
  <time datetime="2018-02-08T11:35:01.000Z" itemprop="datePublished">2018-02-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Android数据库（3）、Android对SQLite数据库的支持
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Android官方默认的数据库就是SQLite数据库，并且相应的Android API 也对SQLite数据做了一定的支持，下面主要通过四个方面来了解一下，具体在Android的程序代码当中如何使用相应的数据库。</p>
<h3 id="一、创建数据库，（SQLiteOpenHelper）"><a href="#一、创建数据库，（SQLiteOpenHelper）" class="headerlink" title="一、创建数据库，（SQLiteOpenHelper）"></a>一、创建数据库，（SQLiteOpenHelper）</h3><p>Android系统当中，数据库其实就是一个文件系统的文件，不过这个文件是以DB结尾的文件。创建数据库，主要分为两种，就是使用默认的SQLiteOpenHelper来创建属于当前应用程序的沙盒数据库，什么是沙盒数据库呢，就是默认的db文件在/data/data当中，第二种创建数据库就是在SD卡当中创建数据库。下面通过两个示例来了解一下。</p>
<h4 id="1、使用默认的SQLiteOpenHelper创建沙盒数据库。"><a href="#1、使用默认的SQLiteOpenHelper创建沙盒数据库。" class="headerlink" title="1、使用默认的SQLiteOpenHelper创建沙盒数据库。"></a>1、使用默认的SQLiteOpenHelper创建沙盒数据库。</h4><p>使用这种方式，主要就是让数据库当中的数据只给当前的应用来使用，当然通过ContentProvider属于另当别论了，想要创建一个数据库，很简单，我们只需要创建一个类，让这个来继承相应的SQLiteOpenHelper即可，重写相应的方法，来让Android来进行回调，完成一个数据库的创建，下面就是示例代码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.database.sqlite.SQLiteDatabase;</span><br><span class="line"><span class="keyword">import</span> android.database.sqlite.SQLiteOpenHelper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建数据库</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> pengchengliu</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KeyValueDataHelper</span> <span class="keyword">extends</span> <span class="title">SQLiteOpenHelper</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DB_NAME = <span class="string">"test.db"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DB_VERSION = <span class="number">1</span> ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DB_INIT_TABLE = <span class="string">"CREATE TABLE test(id INTEGER "</span> +</span><br><span class="line">            <span class="string">"PRIMARY KEY NOT NULL,key TEXT,value TEXT)"</span> ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建相应的数据库，</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context：底层需要通过Context拿到相应的沙盒文件路径，以及通过Context来打开或者创建数据库</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *                到相应的沙盒文件路径</span></span><br><span class="line"><span class="comment">     *                final String path = mContext.getDatabasePath(mName).getPath();</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *                通过Context来打开或者创建数据库</span></span><br><span class="line"><span class="comment">     *                db = mContext.openOrCreateDatabase(mName, mEnableWriteAheadLogging ?</span></span><br><span class="line"><span class="comment">     *                Context.MODE_ENABLE_WRITE_AHEAD_LOGGING : 0,</span></span><br><span class="line"><span class="comment">     *                mFactory, mErrorHandler);</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">KeyValueDataHelper</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//CursorFactory:</span></span><br><span class="line">        <span class="comment">//String name, 数据库文件的名字</span></span><br><span class="line">        <span class="comment">//CursorFactory factory, Cursor工厂，查询时返回自定义的Cursor对象</span></span><br><span class="line">        <span class="comment">//int version：当前数据库的版本,通过该标示来判断数据库的降级以及升级操作</span></span><br><span class="line">        <span class="keyword">super</span>(context, DB_NAME, <span class="keyword">null</span>, DB_VERSION);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据库刚刚建立的时候进行初始化工作，在我们日常开发当中常常使用这个方法来创建我们需要表结构，以及一些常用的</span></span><br><span class="line"><span class="comment">     * 初始化工作。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> db ：底层刚刚创建好的DataBase数据库操作对象，通过该对象我们就可以创建表结构。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 回调时机：</span></span><br><span class="line"><span class="comment">     * SQLiteOpenHelper#getDatabaseLocked()&#123;</span></span><br><span class="line"><span class="comment">     *  try &#123;</span></span><br><span class="line"><span class="comment">     *      if (version == 0) &#123;</span></span><br><span class="line"><span class="comment">     *          onCreate(db);</span></span><br><span class="line"><span class="comment">     *      &#125; else &#123;</span></span><br><span class="line"><span class="comment">     *          if (version &gt; mNewVersion) &#123;</span></span><br><span class="line"><span class="comment">     *          onDowngrade(db, version, mNewVersion);</span></span><br><span class="line"><span class="comment">     *      &#125; else &#123;</span></span><br><span class="line"><span class="comment">     *          onUpgrade(db, version, mNewVersion);</span></span><br><span class="line"><span class="comment">     *      &#125;</span></span><br><span class="line"><span class="comment">     *  &#125;</span></span><br><span class="line"><span class="comment">     *  &#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(SQLiteDatabase db)</span> </span>&#123;</span><br><span class="line">        db.execSQL(DB_INIT_TABLE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据库刚刚建立的时候进行初始化工作，在我们日常开发当中常常使用这个方法来配置我们的数据库，</span></span><br><span class="line"><span class="comment">     * 比如打开我们数据的关系完整性等，具体常用配置，如下所示。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> db:底层刚刚创建好的DataBase数据库操作对象，通过该对象我们就可以通过这个对象来配置我们的数据库</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * pragma auto_vacuum = 0|1;  没有数据有效，有数据无效，顾应该在创建表之前</span></span><br><span class="line"><span class="comment">     * pragma cache_size=9000；default_cache_size</span></span><br><span class="line"><span class="comment">     * pragma page_size = bytes;</span></span><br><span class="line"><span class="comment">     * pragma synchronous = Full/Normal/off</span></span><br><span class="line"><span class="comment">     * pragma temp_store = Memory/File/Default</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 注意：这个方法会在，我们SQLiteOpenHelper#onCreate回调之前进行回调，</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 回调时机</span></span><br><span class="line"><span class="comment">     * SQLiteOpenHelper#getDatabaseLocked()&#123;</span></span><br><span class="line"><span class="comment">     *              onConfigure(db);</span></span><br><span class="line"><span class="comment">     *              final int version = db.getVersion();</span></span><br><span class="line"><span class="comment">     *              if (version != mNewVersion) &#123;</span></span><br><span class="line"><span class="comment">     *                  if (db.isReadOnly()) &#123;</span></span><br><span class="line"><span class="comment">     *                      throw new SQLiteException("Can't upgrade read-only database from version " +</span></span><br><span class="line"><span class="comment">     *                      db.getVersion() + " to " + mNewVersion + ": " + mName);</span></span><br><span class="line"><span class="comment">     *                  &#125;</span></span><br><span class="line"><span class="comment">     *                  db.beginTransaction();</span></span><br><span class="line"><span class="comment">     *                  if (version == 0) &#123;</span></span><br><span class="line"><span class="comment">     *                  onCreate(db);</span></span><br><span class="line"><span class="comment">     *                  &#125; else &#123;</span></span><br><span class="line"><span class="comment">     *                      if (version &gt; mNewVersion) &#123;</span></span><br><span class="line"><span class="comment">     *                          onDowngrade(db, version, mNewVersion);</span></span><br><span class="line"><span class="comment">     *                          onUpgrade(db, version, mNewVersion);</span></span><br><span class="line"><span class="comment">     *                      &#125;</span></span><br><span class="line"><span class="comment">     *                  &#125;</span></span><br><span class="line"><span class="comment">     *                  db.setVersion(mNewVersion);</span></span><br><span class="line"><span class="comment">     *                  db.setTransactionSuccessful();</span></span><br><span class="line"><span class="comment">     *                  &#125; finally &#123;</span></span><br><span class="line"><span class="comment">     *                      db.endTransaction();</span></span><br><span class="line"><span class="comment">     *                  &#125;</span></span><br><span class="line"><span class="comment">     *              onOpen(db);</span></span><br><span class="line"><span class="comment">     * &#125;</span></span><br><span class="line"><span class="comment">     * 默认不会对数据库做任何配置。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onConfigure</span><span class="params">(SQLiteDatabase db)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onConfigure(db);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据库版本升级的时候，我们就可以使用这个方法来维护我们的数据库，让其变为更加强大的存在。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> db ：底层创建好的DataBase数据库操作对象，通过该对象我们就可以在版本变动的时候，维护我们的数据了</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 回调时机：</span></span><br><span class="line"><span class="comment">     * SQLiteOpenHelper#getDatabaseLocked()&#123;</span></span><br><span class="line"><span class="comment">     *  try &#123;</span></span><br><span class="line"><span class="comment">     *      if (version == 0) &#123;</span></span><br><span class="line"><span class="comment">     *          onCreate(db);</span></span><br><span class="line"><span class="comment">     *      &#125; else &#123;</span></span><br><span class="line"><span class="comment">     *          if (version &gt; mNewVersion) &#123;</span></span><br><span class="line"><span class="comment">     *          onDowngrade(db, version, mNewVersion);</span></span><br><span class="line"><span class="comment">     *      &#125; else &#123;</span></span><br><span class="line"><span class="comment">     *          onUpgrade(db, version, mNewVersion);</span></span><br><span class="line"><span class="comment">     *      &#125;</span></span><br><span class="line"><span class="comment">     *  &#125;</span></span><br><span class="line"><span class="comment">     *  &#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUpgrade</span><span class="params">(SQLiteDatabase db, <span class="keyword">int</span> oldVersion, <span class="keyword">int</span> newVersion)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据库版本降级的时候，会进行回调，注意，这个方法不是空实现，这个方法的实现如下所示：</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * public void onDowngrade(SQLiteDatabase db, int oldVersion, int newVersion) &#123;</span></span><br><span class="line"><span class="comment">     *      throw new SQLiteException("Can't downgrade database from version " +</span></span><br><span class="line"><span class="comment">     *      oldVersion + " to " + newVersion);</span></span><br><span class="line"><span class="comment">     * &#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 这也是为什么我们数据降级的时候，会报错的主要原因，如果要解决上述这个问题，那么我们需要重写这个方法，让其空实现即可</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> db ：底层创建好的DataBase数据库操作对象，通过该对象我们就可以在版本变动的时候，维护我们的数据了</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 回调时机：</span></span><br><span class="line"><span class="comment">     * SQLiteOpenHelper#getDatabaseLocked()&#123;</span></span><br><span class="line"><span class="comment">     *  try &#123;</span></span><br><span class="line"><span class="comment">     *      if (version == 0) &#123;</span></span><br><span class="line"><span class="comment">     *          onCreate(db);</span></span><br><span class="line"><span class="comment">     *      &#125; else &#123;</span></span><br><span class="line"><span class="comment">     *          if (version &gt; mNewVersion) &#123;</span></span><br><span class="line"><span class="comment">     *          onDowngrade(db, version, mNewVersion);</span></span><br><span class="line"><span class="comment">     *      &#125; else &#123;</span></span><br><span class="line"><span class="comment">     *          onUpgrade(db, version, mNewVersion);</span></span><br><span class="line"><span class="comment">     *      &#125;</span></span><br><span class="line"><span class="comment">     *  &#125;</span></span><br><span class="line"><span class="comment">     *  &#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDowngrade</span><span class="params">(SQLiteDatabase db, <span class="keyword">int</span> oldVersion, <span class="keyword">int</span> newVersion)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDowngrade(db, oldVersion, newVersion);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取数据库的名字。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 数据库的名字，其值就是我们在SQLiteOpenHelper构造函数当中传入的Name的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDatabaseName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getDatabaseName();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取可读的数据库操作对象SQLiteDatabase，其底层是通过一个getDatabaseLocked方法来实现的</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 数据库操作对象SQLiteDatabase</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SQLiteDatabase <span class="title">getReadableDatabase</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//getDatabaseLocked</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getReadableDatabase();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取可写的数据库操作对象SQLiteDatabase，其底层是通过一个getDatabaseLocked方法来实现的</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 数据库操作对象SQLiteDatabase</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SQLiteDatabase <span class="title">getWritableDatabase</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//getDatabaseLocked</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getWritableDatabase();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启用或禁用数据库的预写日志记录的使用。</span></span><br><span class="line"><span class="comment">     * 预写日志记录不能与只读数据库一起使用，如果数据库以只读方式打开，则忽略此标志。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> enabled，启用预写式日志记录，true为启用，false为被禁用。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 注意：其底层是通过</span></span><br><span class="line"><span class="comment">     *               Database.enableWriteAheadLogging();</span></span><br><span class="line"><span class="comment">     *               Database.disableWriteAheadLogging();来实现的。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWriteAheadLoggingEnabled</span><span class="params">(<span class="keyword">boolean</span> enabled)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.setWriteAheadLoggingEnabled(enabled);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码当中，应该注意的东西都使用注释的形式，进行了相应的标注，这里还有两个比较容易混淆的两个概念，和一个关于初始化SQLiteOpenHelper的相应问题，需要我们具体的进行讨论。</p>
<h5 id="1-1、getReadableDatabase-方法和getWritableDatabase-的区别究竟是什么？"><a href="#1-1、getReadableDatabase-方法和getWritableDatabase-的区别究竟是什么？" class="headerlink" title="1.1、getReadableDatabase()方法和getWritableDatabase()的区别究竟是什么？"></a>1.1、getReadableDatabase()方法和getWritableDatabase()的区别究竟是什么？</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//SQLiteDatabaseHelper#getDatabaseLocked(boolean writable)</span></span><br><span class="line"><span class="keyword">if</span> (db != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (writable &amp;&amp; db.isReadOnly()) &#123;</span><br><span class="line">        db.reopenReadWrite();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (mName == <span class="keyword">null</span>) &#123;</span><br><span class="line">    db = SQLiteDatabase.create(<span class="keyword">null</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (DEBUG_STRICT_READONLY &amp;&amp; !writable) &#123;</span><br><span class="line">            <span class="keyword">final</span> String path = mContext.getDatabasePath(mName).getPath();</span><br><span class="line">            db = SQLiteDatabase.openDatabase(path, mFactory,</span><br><span class="line">                    SQLiteDatabase.OPEN_READONLY, mErrorHandler);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            db = mContext.openOrCreateDatabase(mName, mEnableWriteAheadLogging ?</span><br><span class="line">                    Context.MODE_ENABLE_WRITE_AHEAD_LOGGING : <span class="number">0</span>,</span><br><span class="line">                    mFactory, mErrorHandler);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLiteException ex) &#123;</span><br><span class="line">        <span class="keyword">if</span> (writable) &#123;</span><br><span class="line">            <span class="keyword">throw</span> ex;</span><br><span class="line">        &#125;</span><br><span class="line">        Log.e(TAG, <span class="string">"Couldn't open "</span> + mName</span><br><span class="line">                + <span class="string">" for writing (will try read-only):"</span>, ex);</span><br><span class="line">        <span class="keyword">final</span> String path = mContext.getDatabasePath(mName).getPath();</span><br><span class="line">        db = SQLiteDatabase.openDatabase(path, mFactory,</span><br><span class="line">                SQLiteDatabase.OPEN_READONLY, mErrorHandler);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//SQLiteDatabaseHelper#openDatabase</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SQLiteDatabase <span class="title">openDatabase</span><span class="params">(String path, CursorFactory factory, <span class="keyword">int</span> flags,</span></span></span><br><span class="line"><span class="function"><span class="params">        DatabaseErrorHandler errorHandler)</span> </span>&#123;</span><br><span class="line">    SQLiteDatabase db = <span class="keyword">new</span> SQLiteDatabase(path, flags, factory, errorHandler);</span><br><span class="line">    db.open();</span><br><span class="line">    <span class="keyword">return</span> db;</span><br></pre></td></tr></table></figure>
<p>在源码当中找到了，上述一段代码。可以大体看一下，上述代码用语言总结一下就是</p>
<ul>
<li>getWritableDatabase()和getReadableDatabase()方法都可以获取一个用于操作数据库的SQLiteDatabase实例。但是getWritableDatabase()方法以读写方式打开数据库，一旦数据库的磁盘空间满了，数据库就只能读而不能写，getWritableDatabase()打开数据库就会出错。getReadableDatabase()方法先以读写方式打开数据库，倘若使用如果数据库的磁盘空间满了，就会打开失败，当打开失败后会继续尝试以只读方式打开数据库。</li>
</ul>
<p>一般情况下两者返回情况都是相同的，唯一的区别是：在数据库仅开放只读权限或磁盘已满时，getReadableDatabase只会返回一个只读的数据库对象。</p>
<h5 id="1-2、SQLiteOpenHelper的初始化，做了哪些重量级的操作，真正的初始化工作，是在什么地方开始做的。"><a href="#1-2、SQLiteOpenHelper的初始化，做了哪些重量级的操作，真正的初始化工作，是在什么地方开始做的。" class="headerlink" title="1.2、SQLiteOpenHelper的初始化，做了哪些重量级的操作，真正的初始化工作，是在什么地方开始做的。"></a>1.2、SQLiteOpenHelper的初始化，做了哪些重量级的操作，真正的初始化工作，是在什么地方开始做的。</h5><p>通过研究SQLiteOpenHelper的源码，我们发现正常去和数据库建立连接不是在new SQLiteOpenHelper的时候触发的，真正触发的点就是getWritableDatabase()和getReadableDatabase()，所以在使用的时候，切记UI线程当中最好不要去调用getReadableDatabase/getWritableDatabase这两个方法，这只是为了我们程序的稳定性来说的。</p>
<h4 id="2、在文件系统的SD当中创建数据库。"><a href="#2、在文件系统的SD当中创建数据库。" class="headerlink" title="2、在文件系统的SD当中创建数据库。"></a>2、在文件系统的SD当中创建数据库。</h4><p>通过研究和仿照SQLiteOpenHelper，可以提取到精髓的地方，那就是可以使用Google的方式，在SD卡当中创建一个数据库，首先说说在什么情况下，需要在SD卡上面创建我们的数据库，也就是说在SD卡上面创建数据库的优点是什么？</p>
<h5 id="2-1、当系统卸载我们的应用的时候，当我们重新安装应用的时候，数据不会丢失。"><a href="#2-1、当系统卸载我们的应用的时候，当我们重新安装应用的时候，数据不会丢失。" class="headerlink" title="2.1、当系统卸载我们的应用的时候，当我们重新安装应用的时候，数据不会丢失。"></a>2.1、当系统卸载我们的应用的时候，当我们重新安装应用的时候，数据不会丢失。</h5><h5 id="2-2、方便备份、恢复。"><a href="#2-2、方便备份、恢复。" class="headerlink" title="2.2、方便备份、恢复。"></a>2.2、方便备份、恢复。</h5><p>当然缺点也是有的，数据库不安全等。笔者这里以技术的角度来说明，如何在SD卡上面创建我们的数据，但是不代表笔者赞同这一种做法，这种做法会很严重的破坏Android的生态，对于用户来说，安装了应用，在卸载了应用以后，数据没有清干净，这就代表着，应用程序不是以一个完整沙盒的模式呈现给操作系统，操作系统也不方便管理应用程序，</p>
<p>笔者在这里的建议就是，最好使用Google原生提供的目录来存储哪些需要存储的数据。给出以下目录，供各位参考</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获得缓存文件路径，磁盘空间不足或清除缓存时数据会被删掉，一般存放一些临时文件</span></span><br><span class="line"><span class="comment">// /data/data/&lt;application package&gt;/cache目录</span></span><br><span class="line">File cacheDir = getCacheDir();</span><br><span class="line">Log.d(<span class="string">"TAG"</span>, <span class="string">"getCacheDir() : "</span> + cacheDir.getAbsolutePath());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获得文件存放路径，一般存放一些需要长期保留的文件</span></span><br><span class="line"><span class="comment">// /data/data/&lt;application package&gt;/files目录</span></span><br><span class="line">File fileDir = getFilesDir();</span><br><span class="line">Log.d(<span class="string">"TAG"</span>, <span class="string">"getFilesDir() : "</span> + fileDir.getAbsolutePath());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这是一个可以存放你自己应用程序自定义的文件，你可以通过该方法返回的File实例来创建或者访问这个目录</span></span><br><span class="line"><span class="comment">// /data/data/&lt;application package&gt;/</span></span><br><span class="line">File dir = getDir(<span class="string">"fileName"</span>, MODE_PRIVATE);</span><br><span class="line">Log.d(<span class="string">"TAG"</span>, <span class="string">"getDir() : "</span> + dir.getAbsolutePath());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取应用程序外部存储的缓存目录路径</span></span><br><span class="line"><span class="comment">// SDCard/Android/data/&lt;application package&gt;/cache目录</span></span><br><span class="line">File externalCacheDir = getExternalCacheDir();</span><br><span class="line">Log.d(<span class="string">"TAG"</span>, <span class="string">"getExternalCacheDir() : "</span> + externalCacheDir.getAbsolutePath());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取应用程序外部存储的某一类型的文件目录，</span></span><br><span class="line"><span class="comment">// SDCard/Android/data/&lt;application package&gt;/files目录</span></span><br><span class="line"><span class="comment">// 这里的类型有</span></span><br><span class="line"><span class="comment">// Environment.DIRECTORY_MUSIC音乐</span></span><br><span class="line"><span class="comment">// Environment.DIRECTORY_PODCASTS 音频</span></span><br><span class="line"><span class="comment">// Environment.DIRECTORY_RINGTONES 铃声</span></span><br><span class="line"><span class="comment">// Environment.DIRECTORY_ALARMS 闹铃</span></span><br><span class="line"><span class="comment">// Environment.DIRECTORY_NOTIFICATIONS 通知铃声</span></span><br><span class="line"><span class="comment">// Environment.DIRECTORY_PICTURES 图片</span></span><br><span class="line"><span class="comment">// Environment.DIRECTORY_MOVIES 视频</span></span><br><span class="line">File externalFilesDir = getExternalFilesDir(Environment.DIRECTORY_MUSIC);</span><br><span class="line">Log.d(<span class="string">"TAG"</span>, <span class="string">"getExternalFilesDir() : "</span> + externalFilesDir.getAbsolutePath());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取应用的外部存储的缓存目录</span></span><br><span class="line">File[] externalCacheDirs = getExternalCacheDirs();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; externalCacheDirs.length; i++) &#123;</span><br><span class="line">    Log.d(<span class="string">"TAG"</span>, <span class="string">"getExternalCacheDirs() "</span> + i + <span class="string">" : "</span> + externalCacheDirs[i].getAbsolutePath());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取应用的外部存储的某一类型的文件目录</span></span><br><span class="line">File[] externalFilesDirs = getExternalFilesDirs(Environment.DIRECTORY_MUSIC);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; externalFilesDirs.length; i++) &#123;</span><br><span class="line">    Log.d(<span class="string">"TAG"</span>, <span class="string">"getExternalFilesDirs() "</span> + i + <span class="string">" : "</span> + externalFilesDirs[i].getAbsolutePath());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取应用的外部媒体文件目录</span></span><br><span class="line">File[] externalMediaDirs = getExternalMediaDirs();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; externalMediaDirs.length; i++) &#123;</span><br><span class="line">    Log.d(<span class="string">"TAG"</span>, <span class="string">"getExternalMediaDirs() "</span> + i + <span class="string">" : "</span> + externalMediaDirs[i].getAbsolutePath());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获得应用程序指定数据库的绝对路径</span></span><br><span class="line"><span class="comment">// /data/data/&lt;application package&gt;/database/database.db目录</span></span><br><span class="line">File databasePath = getDatabasePath(<span class="string">"database.db"</span>);</span><br></pre></td></tr></table></figure>
<p>SD卡创建数据库的具体思路是：  通过android的SQLiteOpenHelper类的源码，可以看到SQLiteOpenHelper类的getWritableDatabase这个接口实际上调用的是Context的openOrCreateDatabase方法，而这个方法是不支持带路径的数据库名称的，也就是说，用这个方法创建的数据库只能放在/data/data/包名称/ 目录下；要想在SD卡上创建数据库，我们可以调用SQLiteDatabase类的openOrCreateDatabase方法，这个方法是支持带路径的数据库名称的。 </p>
<p>下面来看一则示例，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.database.sqlite.SQLiteDatabase;</span><br><span class="line"><span class="keyword">import</span> android.os.Environment;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * SD卡创建数据库，SQLiteDatabase类的openOrCreateDatabase支持带参数，所以选择该方法</span></span><br><span class="line"><span class="comment"> * Created by pengchengliu on 2018/3/24.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseSDManager</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DATABASE_FILE_DIRECTORY = <span class="string">"/dateBase"</span> ;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DATABASE_PATH = Environment.getExternalStorageDirectory().getPath() +</span><br><span class="line">            File.separator + DatabaseSDManager.class.getPackage().getName() + DATABASE_FILE_DIRECTORY;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String mDataBaseName ;</span><br><span class="line">    <span class="keyword">private</span> SQLiteDatabase.CursorFactory mFactory ;</span><br><span class="line">    <span class="keyword">private</span> SQLiteDatabase mSQLiteDatabase ;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DatabaseSDManager</span><span class="params">(String dtaBaseName)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(dtaBaseName,<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DatabaseSDManager</span><span class="params">(String dataBaseName, SQLiteDatabase.CursorFactory factory )</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mDataBaseName = dataBaseName ;</span><br><span class="line">        <span class="keyword">this</span>.mFactory = factory ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> SQLiteDatabase <span class="title">getDataBase</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mSQLiteDatabase == <span class="keyword">null</span>)&#123;</span><br><span class="line">            mSQLiteDatabase = SQLiteDatabase.</span><br><span class="line">                    openOrCreateDatabase(initDatabaseFilePath(), <span class="keyword">this</span>.mFactory);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mSQLiteDatabase;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化DataBase的文件目录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> File <span class="title">initDatabaseFilePath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> sdIsExist = Environment.MEDIA_MOUNTED.equals(Environment.getExternalStorageState());</span><br><span class="line">        <span class="keyword">if</span>(!sdIsExist)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"SD is not Find, Please check Sd state"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        File dirfile = <span class="keyword">new</span> File(DATABASE_PATH + File.separator);</span><br><span class="line">        <span class="keyword">if</span>(!dirfile.exists())&#123;</span><br><span class="line">            <span class="keyword">if</span>(!dirfile.mkdirs())&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"create file is fail"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> isCreateDbFileSuccess = <span class="keyword">false</span> ;</span><br><span class="line"></span><br><span class="line">        File dbFile = <span class="keyword">new</span> File(dirfile, <span class="keyword">this</span>.mDataBaseName);</span><br><span class="line">        <span class="keyword">if</span>(!dbFile.exists())&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                isCreateDbFileSuccess = dbFile.createNewFile();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            isCreateDbFileSuccess = <span class="keyword">true</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> isCreateDbFileSuccess ? dbFile : <span class="keyword">null</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mSQLiteDatabase != <span class="keyword">null</span>)&#123;</span><br><span class="line">            mSQLiteDatabase.close();</span><br><span class="line">            mSQLiteDatabase = <span class="keyword">null</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述的Demo当中，我们没有加入Version的维护，只是一个简单的小例子，如果在开发工作当中，必定会加入版本的维护，具体代码如何实现，可以具体参考SQLiteOpenHelper的实现，</p>
<p>还有一种实现方式便是我们自定义Context来实现，我们通过源码知道，我们使用SQLiteOpenHelper的时候，具体的路径是写死的，我们可以自定义Context来实现我们的这个功能，具体的源码实现如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.content.ContextWrapper;</span><br><span class="line"><span class="keyword">import</span> android.database.DatabaseErrorHandler;</span><br><span class="line"><span class="keyword">import</span> android.database.sqlite.SQLiteDatabase;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Created by pengchengliu on 2018/3/25.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataBaseContext</span> <span class="keyword">extends</span> <span class="title">ContextWrapper</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 构造函数</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> base 上下文环境</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DataBaseContext</span><span class="params">(Context base)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(base);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得数据库路径，如果不存在，则创建对象对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> File <span class="title">getDatabasePath</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//判断是否存在sd卡</span></span><br><span class="line">        <span class="keyword">boolean</span> sdExist = android.os.Environment.MEDIA_MOUNTED.equals(android.os.Environment.getExternalStorageState());</span><br><span class="line">        <span class="keyword">if</span> (!sdExist) &#123;<span class="comment">//如果不存在,</span></span><br><span class="line">            Log.e(<span class="string">"SD卡管理："</span>, <span class="string">"SD卡不存在，请加载SD卡"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="comment">//如果存在</span></span><br><span class="line">            <span class="comment">//获取sd卡路径</span></span><br><span class="line">            String dbDir = android.os.Environment.getExternalStorageDirectory().toString();</span><br><span class="line">            dbDir += <span class="string">"/scexam"</span>;<span class="comment">//数据库所在目录</span></span><br><span class="line">            String dbPath = dbDir + <span class="string">"/"</span> + name;<span class="comment">//数据库路径</span></span><br><span class="line">            <span class="comment">//判断目录是否存在，不存在则创建该目录</span></span><br><span class="line">            File dirFile = <span class="keyword">new</span> File(dbDir);</span><br><span class="line">            <span class="keyword">if</span> (!dirFile.exists())</span><br><span class="line">                dirFile.mkdirs();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//数据库文件是否创建成功</span></span><br><span class="line">            <span class="keyword">boolean</span> isFileCreateSuccess = <span class="keyword">false</span>;</span><br><span class="line">            <span class="comment">//判断文件是否存在，不存在则创建该文件</span></span><br><span class="line">            File dbFile = <span class="keyword">new</span> File(dbPath);</span><br><span class="line">            <span class="keyword">if</span> (!dbFile.exists()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    isFileCreateSuccess = dbFile.createNewFile();<span class="comment">//创建文件</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span></span><br><span class="line">                isFileCreateSuccess = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//返回数据库文件对象</span></span><br><span class="line">            <span class="keyword">if</span> (isFileCreateSuccess)</span><br><span class="line">                <span class="keyword">return</span> dbFile;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重载这个方法，是用来打开SD卡上的数据库的，android 2.3及以下会调用这个方法。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mode</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> factory</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SQLiteDatabase <span class="title">openOrCreateDatabase</span><span class="params">(String name, <span class="keyword">int</span> mode,</span></span></span><br><span class="line"><span class="function"><span class="params">                                               SQLiteDatabase.CursorFactory factory)</span> </span>&#123;</span><br><span class="line">        SQLiteDatabase result = SQLiteDatabase.openOrCreateDatabase(getDatabasePath(name), <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Android 4.0会调用此方法获取数据库。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mode</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> factory</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> errorHandler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> android.content.ContextWrapper#openOrCreateDatabase(java.lang.String, int,</span></span><br><span class="line"><span class="comment">     * android.database.sqlite.SQLiteDatabase.CursorFactory,</span></span><br><span class="line"><span class="comment">     * android.database.DatabaseErrorHandler)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SQLiteDatabase <span class="title">openOrCreateDatabase</span><span class="params">(String name, <span class="keyword">int</span> mode, SQLiteDatabase.CursorFactory factory,</span></span></span><br><span class="line"><span class="function"><span class="params">                                               DatabaseErrorHandler errorHandler)</span> </span>&#123;</span><br><span class="line">        SQLiteDatabase result = SQLiteDatabase.openOrCreateDatabase(getDatabasePath(name), <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，我们使用的时候只要按照，最初的时候就OK。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.database.sqlite.SQLiteDatabase;</span><br><span class="line"><span class="keyword">import</span> android.database.sqlite.SQLiteOpenHelper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * DataBase helper class</span></span><br><span class="line"><span class="comment"> * Created by pengchengliu on 2018/3/25.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DbOpenHelper</span> <span class="keyword">extends</span> <span class="title">SQLiteOpenHelper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DB_NAME = <span class="string">"test.db"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> VERSION = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DbOpenHelper</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context <span class="keyword">instanceof</span> DataBaseContext ? context : <span class="keyword">new</span> DataBaseContext(context),</span><br><span class="line">                DB_NAME, <span class="keyword">null</span>, VERSION);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(SQLiteDatabase db)</span> </span>&#123;<span class="comment">//It will be called when the database was created first</span></span><br><span class="line">        db.execSQL(<span class="string">"CREATE TABLE IF NOT EXISTS exam_type (id integer primary key autoincrement, type_name varchar(100), type_id INTEGER)"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  <span class="comment">// It'll be called when the database was updated</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUpgrade</span><span class="params">(SQLiteDatabase db, <span class="keyword">int</span> oldVersion, <span class="keyword">int</span> newVersion)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>到此，关于数据库的创建的所有知识都梳理了一遍。</p>
<h3 id="二、管理数据库"><a href="#二、管理数据库" class="headerlink" title="二、管理数据库"></a>二、管理数据库</h3><p>据Google官方所说，一个打开数据库的连接，将会占用1kb的内存，在内存受限的移动设备来说，这1kb足够引起我们的注意，现在来讨论一下，如何管理一个数据库的生命周期，这里笔者给出两种管理策略，这两种策略也是我们日常开发当中常常使用的，具体的策略如下所示：</p>
<h4 id="1、让应用程序来一直持有相应的数据库连接的引用，也就是一直持有SQLitDatabase这个类的引用。"><a href="#1、让应用程序来一直持有相应的数据库连接的引用，也就是一直持有SQLitDatabase这个类的引用。" class="headerlink" title="1、让应用程序来一直持有相应的数据库连接的引用，也就是一直持有SQLitDatabase这个类的引用。"></a>1、让应用程序来一直持有相应的数据库连接的引用，也就是一直持有SQLitDatabase这个类的引用。</h4><p>这种方式很简单，就是申明一个成员变量来保持当前数据库引用。如果我们这样做了，其实就代表着这一块的内存，我们无法回收，并且无法重用。这里需要注意的是，当我们的应用程序至于后台，并且在手机内存不足的情况下回收内存的时候，如果我们没有显示的关闭和数据库的连接，那么应用程序将会报错。所以在使用这一种的策略的时候，一定要注意关于db的关闭问题。</p>
<p>其次还有一个需要我们注意的是在Activity当中持有一个数据库的连接的时候，必要的是在Actiivty销毁的时候，关闭该连接，其实如果我们的应用程序当中存在大量的数据访问工作，我们需要在Application当中去持有这个连接引用，好方便在多个Actiivty，Service当中去获取这个引用，具体实现如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.app.Application;</span><br><span class="line"><span class="keyword">import</span> android.database.sqlite.SQLiteDatabase;</span><br><span class="line"><span class="keyword">import</span> android.database.sqlite.SQLiteOpenHelper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> suansuan.com.contentprovider.sql.KeyValueDataHelper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 管理数据库的引用</span></span><br><span class="line"><span class="comment"> * Created by pengchengliu on 2018/3/25.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplication</span> <span class="keyword">extends</span> <span class="title">Application</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> SQLiteOpenHelper mDbHelper ;</span><br><span class="line">    <span class="keyword">private</span> Thread mUiThread ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        </span><br><span class="line">        mDbHelper = <span class="keyword">new</span> KeyValueDataHelper(<span class="keyword">this</span>);</span><br><span class="line">        mUiThread = Thread.currentThread() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> SQLiteDatabase <span class="title">getSQLiteDatabase</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(Thread.currentThread().equals(mUiThread))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Database opened on main Thread"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//根据自己的具体需求，确定使用可写数据库还是可读数据库。具体区别，可以参考上述章节内容</span></span><br><span class="line">        <span class="keyword">return</span> mDbHelper.getWritableDatabase();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2、需要连接的时候再获取。"><a href="#2、需要连接的时候再获取。" class="headerlink" title="2、需要连接的时候再获取。"></a>2、需要连接的时候再获取。</h4><p>使用这种策略，必须要清楚当前应用程序当中有哪些对象获取了数据库的连接，关于Java的垃圾回收机制，我们知道当一个对象只有不被任何对象引用的时候，才会被回收，因此，如果我们关闭数据库而没有释放所有对它的引用，将是毫无用处的，因为除非释放最后一个引用，否则该对象不能被回收。我们知道SQLiteOpenHelper、SQLiteQuery、SQLiteCursor保存着数据库的引用，所以在不用的时候，记得回收。</p>
<h3 id="三、操作数据库"><a href="#三、操作数据库" class="headerlink" title="三、操作数据库"></a>三、操作数据库</h3><h4 id="1、基本SQL语句的嵌入"><a href="#1、基本SQL语句的嵌入" class="headerlink" title="1、基本SQL语句的嵌入"></a>1、基本SQL语句的嵌入</h4><p>Android，当中提供了SQLiteDatebase这个类来操作数据库，这个类提供了一个最基本的和数据库交互的方法，那就是execSQL这个方法，通过这个最基本的方法，我们就可以去操作数据库，可以使用这个方法去创建表结构等，但是使用这种方法，有很多的确定，下列就来描述一下，对开发人员来说很不要的缺点。</p>
<ul>
<li>A、在SQLite数据库当中有一部分的命令不是直接解释给SQL的，而是面向SQLite的，我们称这些为元命令，使用execSQL方法的第一个缺点就是不能执行所谓的元命令。常见元命令有以下这几种</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.nullvalue STRING    在 NULL 值的地方输出 STRING 字符串。</span><br><span class="line">.output FILENAME    发送输出到 FILENAME 文件。</span><br><span class="line">.output stdout    发送输出到屏幕。</span><br><span class="line">.print STRING...    逐字地输出 STRING 字符串。</span><br><span class="line">.prompt MAIN CONTINUE    替换标准提示符。</span><br><span class="line">.quit    退出 SQLite 提示符。</span><br><span class="line">.read FILENAME    执行 FILENAME 文件中的 SQL。</span><br><span class="line">.schema ?TABLE?    显示 <span class="keyword">CREATE</span> 语句。如果指定了 <span class="keyword">TABLE</span> 表，则只显示匹配 <span class="keyword">LIKE</span> 模式的 <span class="keyword">TABLE</span> 表。</span><br><span class="line">.separator <span class="keyword">STRING</span>    改变输出模式和 .import 所使用的分隔符。</span><br><span class="line">.show    显示各种设置的当前值。</span><br><span class="line">.stats <span class="keyword">ON</span>|<span class="keyword">OFF</span>    开启或关闭统计。</span><br><span class="line">.tables ?PATTERN?    列出匹配 <span class="keyword">LIKE</span> 模式的表的名称。</span><br><span class="line">.timeout MS    尝试打开锁定的表 MS 毫秒。</span><br><span class="line">.width <span class="keyword">NUM</span> <span class="keyword">NUM</span>    为 <span class="string">"column"</span> 模式设置列宽度。</span><br><span class="line">.timer <span class="keyword">ON</span>|<span class="keyword">OFF</span>    开启或关闭 CPU 定时器。</span><br></pre></td></tr></table></figure>
<ul>
<li><p>B、不能打包多条SQL语句，按照规定在使用方法execSQL这个方法的时候，按理应该只有一条语句。如果我们非要插入多条语句，并且使用分号隔开，那么以第一个分号结尾以后的语句将被忽略。</p>
</li>
<li><p>C、不能使用query相关的语句，execSQL这个方法是没有返回值的，所以涉及到查询语句将不能被使用。并且当我们使用execSQL这个方法查询时候，会抛出异常，提示要使用别的方法。这里会出现一个rawSQL的方法，其实这个方法也属于低级的方法。</p>
</li>
</ul>
<p>一般来说，execSQL、rawSQL这两个方法来说就像是一起冷兵器，开发人员很少使用，最多execSQL用来创建表结构，触发器结构，而rawSQL开发人员基本就没有用过。不是作为编程执行SQL的一般性工具，相反，它们应该是用作访问不常用的SQL的最后手段，</p>
<p>为了替代应用程序代码中嵌入未经检查、非类型化的SQL字符串，Android SQLite API把SQL语义放入到API方法当中，主要分为四类，删除、更新、插入、查询。</p>
<h4 id="2、删除"><a href="#2、删除" class="headerlink" title="2、删除"></a>2、删除</h4><h5 id="2-1、对外提供接口"><a href="#2-1、对外提供接口" class="headerlink" title="2.1、对外提供接口"></a>2.1、对外提供接口</h5><p>通过观察SQLiteDatabase的API，我们不难发现有一个方法，是删除表里面的数据的，如下所示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除数据库表当中的一条数据，</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> table ：要操作的表名字</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> whereClause ：where条件语句，其中的值可以使用占位符来代替</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> whereArgs ： 对前面占位的实体值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> ： 该操作对一个表结构来说影响了几行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">delete</span><span class="params">(String table, String whereClause, String[] whereArgs)</span> </span>&#123;</span><br><span class="line">    acquireReference();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        SQLiteStatement statement =  <span class="keyword">new</span> SQLiteStatement(<span class="keyword">this</span>, <span class="string">"DELETE FROM "</span> + table +</span><br><span class="line">                (!TextUtils.isEmpty(whereClause) ? <span class="string">" WHERE "</span> + whereClause : <span class="string">""</span>), whereArgs);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> statement.executeUpdateDelete();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            statement.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        releaseReference();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过源码，我们不难看出，这里SQLiteDatabase把相应的操作是委托给了SQLiteStatement，让其进行了相应的删除操作，并且相应的SQL语句也是在这里拼接的。具体内部是如何实现的，不是本章的内容。如果感兴趣可以给下层追一下。</p>
<h4 id="3、更新"><a href="#3、更新" class="headerlink" title="3、更新"></a>3、更新</h4><p>实现更新操作的Android API这一次列操作也是比较少的，包括两个常用方法update、updateWithOnConflict，这两个的具体实现如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(String table, ContentValues values, String whereClause, String[] whereArgs)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> updateWithOnConflict(table, values, whereClause, whereArgs, CONFLICT_NONE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 数据库表字段的更新操作</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> table ： 要操作的表名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> values ： 要修改的值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> whereClause ： where的查询条件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> whereArgs ： 前面查询条件的替换值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> conflictAlgorithm 当破坏主键或者其他字段，所采取的措施，有以下取值</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      CONFLICT_FAIL ：当一个发生违反约束的情况，命令将以返回码中止 SQLITE_CONSTRAINT。</span></span><br><span class="line"><span class="comment"> *      CONFLICT_IGNORE ：当一个约束int违例发生，包含约束的一行 不会插入或更改违规。</span></span><br><span class="line"><span class="comment"> *      CONFLICT_NONE ：U如果没有指定冲突行为，请参阅以下内容。</span></span><br><span class="line"><span class="comment"> *      CONFLICT_REPLACE ：当发生UNIQUE约束冲突时，他预先存在的行是 导致在插入或更新之前删除约束条件 当前行。</span></span><br><span class="line"><span class="comment"> *      CONFLICT_ROLLBACK ：发生约束冲突时，会立即发生ROLLBACK 结束当前交易，该命令将以一个返回码中止 SQLITE_CONSTRAINT。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 影响的行数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateWithOnConflict</span><span class="params">(String table, ContentValues values,</span></span></span><br><span class="line"><span class="function"><span class="params">        String whereClause, String[] whereArgs, <span class="keyword">int</span> conflictAlgorithm)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (values == <span class="keyword">null</span> || values.size() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Empty values"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    acquireReference();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        StringBuilder sql = <span class="keyword">new</span> StringBuilder(<span class="number">120</span>);</span><br><span class="line">        sql.append(<span class="string">"UPDATE "</span>);</span><br><span class="line">        sql.append(CONFLICT_VALUES[conflictAlgorithm]);</span><br><span class="line">        sql.append(table);</span><br><span class="line">        sql.append(<span class="string">" SET "</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// move all bind args to one array</span></span><br><span class="line">        <span class="keyword">int</span> setValuesSize = values.size();</span><br><span class="line">        <span class="keyword">int</span> bindArgsSize = (whereArgs == <span class="keyword">null</span>) ? setValuesSize : (setValuesSize + whereArgs.length);</span><br><span class="line">        Object[] bindArgs = <span class="keyword">new</span> Object[bindArgsSize];</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (String colName : values.keySet()) &#123;</span><br><span class="line">            sql.append((i &gt; <span class="number">0</span>) ? <span class="string">","</span> : <span class="string">""</span>);</span><br><span class="line">            sql.append(colName);</span><br><span class="line">            bindArgs[i++] = values.get(colName);</span><br><span class="line">            sql.append(<span class="string">"=?"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (whereArgs != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (i = setValuesSize; i &lt; bindArgsSize; i++) &#123;</span><br><span class="line">                bindArgs[i] = whereArgs[i - setValuesSize];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!TextUtils.isEmpty(whereClause)) &#123;</span><br><span class="line">            sql.append(<span class="string">" WHERE "</span>);</span><br><span class="line">            sql.append(whereClause);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        SQLiteStatement statement = <span class="keyword">new</span> SQLiteStatement(<span class="keyword">this</span>, sql.toString(), bindArgs);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> statement.executeUpdateDelete();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            statement.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        releaseReference();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看出这里，update属于updateWithOnConflict的子集，上述做了两件事，和上述的删除操作类似，拼接SQL语句，创建一个SQLiteStatement，最后通过statement去执行相应的操作，这里说一下这两个更新方法的区别是什么？</p>
<p>updateWithOnConflict方法含义呢，就是在如果修改中破坏了相应的主键约束，或者说是一定的约束条件，不仅仅是主键约束，需要底层需要如何处理，也就是当发生破坏表字段的约束的时候，需要数据库底层去准备哪些策略，具体策略，可以参考上述代码的注释</p>
<p>ContentValuesd，Android SQLite官方所引入的新的一种数据结构，当我们去修改，或者插入的时候，通过构造着一种数据结构，来整理数据，以便高效的插入。其实它的内部的实现就是一个简单的HashMap&lt;K,V&gt;，那么仔细想一下，为什么不直接使用Map就可以插入，还要多封装一种数据结构呢，其实很简单，只是为了适配相应的SQLite数据库，因为数据库是弱类型的，所以需要这种数据结构，我们看几个它的方法，相信各位看客就明白为什么需要它的原因了，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ContentValues</span> <span class="keyword">implements</span> <span class="title">Parcelable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"ContentValues"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Holds the actual values */</span></span><br><span class="line">    <span class="keyword">private</span> HashMap&lt;String, Object&gt; mValues;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Adds a value to the set.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key the name of the value to put</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value the data for the value to put</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String key, Short value)</span> </span>&#123;</span><br><span class="line">        mValues.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Adds a value to the set.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key the name of the value to put</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value the data for the value to put</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String key, Integer value)</span> </span>&#123;</span><br><span class="line">        mValues.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Adds a value to the set.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key the name of the value to put</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value the data for the value to put</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String key, Long value)</span> </span>&#123;</span><br><span class="line">        mValues.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">….</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Gets a value and converts it to a String.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key the value to get</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the String for the value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAsString</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        Object value = mValues.get(key);</span><br><span class="line">        <span class="keyword">return</span> value != <span class="keyword">null</span> ? value.toString() : <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Gets a value and converts it to a Long.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key the value to get</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the Long value, or &#123;<span class="doctag">@code</span> null&#125; if the value is missing or cannot be converted</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getAsLong</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        Object value = mValues.get(key);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> value != <span class="keyword">null</span> ? ((Number) value).longValue() : <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassCastException e) &#123;</span><br><span class="line">            <span class="keyword">if</span> (value <span class="keyword">instanceof</span> CharSequence) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> Long.valueOf(value.toString());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (NumberFormatException e2) &#123;</span><br><span class="line">                    Log.e(TAG, <span class="string">"Cannot parse Long value for "</span> + value + <span class="string">" at key "</span> + key);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Log.e(TAG, <span class="string">"Cannot cast value for "</span> + key + <span class="string">" to a Long: "</span> + value, e);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Gets a value and converts it to an Integer.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key the value to get</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the Integer value, or &#123;<span class="doctag">@code</span> null&#125; if the value is missing or cannot be converted</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAsInteger</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        Object value = mValues.get(key);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> value != <span class="keyword">null</span> ? ((Number) value).intValue() : <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassCastException e) &#123;</span><br><span class="line">            <span class="keyword">if</span> (value <span class="keyword">instanceof</span> CharSequence) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> Integer.valueOf(value.toString());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (NumberFormatException e2) &#123;</span><br><span class="line">                    Log.e(TAG, <span class="string">"Cannot parse Integer value for "</span> + value + <span class="string">" at key "</span> + key);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Log.e(TAG, <span class="string">"Cannot cast value for "</span> + key + <span class="string">" to a Integer: "</span> + value, e);    </span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4、插入"><a href="#4、插入" class="headerlink" title="4、插入"></a>4、插入</h4><p>插入系列的方法个更新系列的方法几乎相同，但是我们需要注意一点比较重要的就是插入方法可以捕获SQLite的异常，通过insertOrThrow这个方法。还有一个方法就是replace这个方法，其实这个方法很危险，为什么说这个方法危险呢，主要就是它的功能导致的，它的功能为插入一条数据转化为使用OR_EREPLACE_ONCONFLICT算法，已解决违反约束的行为，如果插入数据没有造成冲突，replace方法将插入一个新行，如果造成了冲突，现有行将被替代为新的值。下面看看这三个方法在底层如何实现的，相信大家也就懂了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">insert</span><span class="params">(String table, String nullColumnHack, ContentValues values)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> insertWithOnConflict(table, nullColumnHack, values, CONFLICT_NONE);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        Log.e(TAG, <span class="string">"Error inserting "</span> + values, e);</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">insertOrThrow</span><span class="params">(String table, String nullColumnHack, ContentValues values)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> insertWithOnConflict(table, nullColumnHack, values, CONFLICT_NONE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">replace</span><span class="params">(String table, String nullColumnHack, ContentValues initialValues)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> insertWithOnConflict(table, nullColumnHack, initialValues,</span><br><span class="line">                CONFLICT_REPLACE);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        Log.e(TAG, <span class="string">"Error inserting "</span> + initialValues, e);</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">replaceOrThrow</span><span class="params">(String table, String nullColumnHack,</span></span></span><br><span class="line"><span class="function"><span class="params">        ContentValues initialValues)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> insertWithOnConflict(table, nullColumnHack, initialValues,</span><br><span class="line">            CONFLICT_REPLACE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">insertWithOnConflict</span><span class="params">(String table, String nullColumnHack,</span></span></span><br><span class="line"><span class="function"><span class="params">        ContentValues initialValues, <span class="keyword">int</span> conflictAlgorithm)</span> </span>&#123;</span><br><span class="line">    acquireReference();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        StringBuilder sql = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        sql.append(<span class="string">"INSERT"</span>);</span><br><span class="line">        sql.append(CONFLICT_VALUES[conflictAlgorithm]);</span><br><span class="line">        sql.append(<span class="string">" INTO "</span>);</span><br><span class="line">        sql.append(table);</span><br><span class="line">        sql.append(<span class="string">'('</span>);</span><br><span class="line"></span><br><span class="line">        Object[] bindArgs = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> size = (initialValues != <span class="keyword">null</span> &amp;&amp; initialValues.size() &gt; <span class="number">0</span>)</span><br><span class="line">                ? initialValues.size() : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            bindArgs = <span class="keyword">new</span> Object[size];</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (String colName : initialValues.keySet()) &#123;</span><br><span class="line">                sql.append((i &gt; <span class="number">0</span>) ? <span class="string">","</span> : <span class="string">""</span>);</span><br><span class="line">                sql.append(colName);</span><br><span class="line">                bindArgs[i++] = initialValues.get(colName);</span><br><span class="line">            &#125;</span><br><span class="line">            sql.append(<span class="string">')'</span>);</span><br><span class="line">            sql.append(<span class="string">" VALUES ("</span>);</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">                sql.append((i &gt; <span class="number">0</span>) ? <span class="string">",?"</span> : <span class="string">"?"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sql.append(nullColumnHack + <span class="string">") VALUES (NULL"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        sql.append(<span class="string">')'</span>);</span><br><span class="line"></span><br><span class="line">        SQLiteStatement statement = <span class="keyword">new</span> SQLiteStatement(<span class="keyword">this</span>, sql.toString(), bindArgs);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> statement.executeInsert();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            statement.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        releaseReference();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5、查询</p>
<p>6、事物</p>
<p>7、批处理</p>
<p>这里还有三点，这个我们后面会说到</p>
<h3 id="四、应用程序中的使用"><a href="#四、应用程序中的使用" class="headerlink" title="四、应用程序中的使用"></a>四、应用程序中的使用</h3><h4 id="1、数据库在应用程序中所处的地位"><a href="#1、数据库在应用程序中所处的地位" class="headerlink" title="1、数据库在应用程序中所处的地位"></a>1、数据库在应用程序中所处的地位</h4><p>整个开发当中，数据无时无刻都起着很重要的作用，说白的了，程序就是操作数据的指令集而已，MVC，MVP等设计模式，也是将展示和数据分离，在Android当中已是如此，其实在很久以前，分层设计能很好的体现出数据源与视图的关系，熟悉J2EE开发人员应该清楚，程序的底层数据设计DAO，数据操作对象是以何种身份呈现说出来的，这种设计其实在Android当中也是适用的。统一数据源，通过特定的接口统一暴露给上层，然后通过相关的Adapter去设置数据。</p>
<p>网络数据的时候，由于是通过网络拿数据，很多开发者遍忽略了DAO，其实可以理解为网络数据，就是数据库在远端的情况，并且在很多的大型商业项目当中，也是通过ContentProvider去维护网络数据的，这个后面部分笔者应该也会提到，当我们去查找，或者删除的时候去触发远端数据的同步过程，</p>
<p>下面详细的讨论一下，数据库在Android应用程序当中所处的位置。</p>
<h5 id="1-1、UI与DB"><a href="#1-1、UI与DB" class="headerlink" title="1.1、UI与DB"></a>1.1、UI与DB</h5><p>UI和DB就是MVP，MVC，MVVP这些设计模式当中提到的很重要的两个关键点，视图与数据源，Android当中的DB一般都会嵌入到ContentProvider当中使用，而相应的视图则有Activity来代替，而相应的中间交互对象则就是接口层CRUD和cursor，通常称之为REST-like模型，但是由于Android当中特殊的线程规定，主线程不能做耗时操作等，所以在从数据源当中拿去Corsur就有点曲折了。</p>
<h5 id="1-2、Cursor与CursorFactory"><a href="#1-2、Cursor与CursorFactory" class="headerlink" title="1.2、Cursor与CursorFactory"></a>1.2、Cursor与CursorFactory</h5><p>Cursor就是我们从数据库当中查询到的数据集合，是一种二维形式的数据结构，有点类似于二维数组，包括行和列，还存在一个指向当前行的指针，该指针介于-1到getCount之间，</p>
<p><a href="https://blog.csdn.net/italywj222/article/details/50418577" target="_blank" rel="noopener">https://blog.csdn.net/italywj222/article/details/50418577</a><br><a href="https://blog.csdn.net/howlaa/article/details/46707159" target="_blank" rel="noopener">https://blog.csdn.net/howlaa/article/details/46707159</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/02/08/android-sqlite03/" data-id="cjk6acige003dmceww1vwfe1e" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库/">数据库</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/05/09/thread-base-01/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          线程基础（前篇）
        
      </div>
    </a>
  
  
    <a href="/2018/02/06/android-sqlite02/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Android数据库（2）、SQLite数据库常用的数据结构</div>
    </a>
  
</nav>

  
</article>

</section>
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <a href="/" class="logo">刘鹏程</a>
      &copy; 2018 刘鹏程<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    

<script src="/js/jquery.min.js"></script>
<script src="/js/jquery.scrollLoading.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>